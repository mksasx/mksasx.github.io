<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£ | AustinMa&#39;s Blog</title>
<meta name="keywords" content="ç¼–è¯‘æœŸæœ«æ€»ç»“, Compiler">
<meta name="description" content="è¿™æ˜¯æˆ‘çš„ç¼–è¯‘è¯¾ç¨‹æœŸæœ«æ€»ç»“æ–‡æ¡£">
<meta name="author" content="
ä½œè€…:&nbsp;AustinMa">
<link rel="canonical" href="https://mksasx.github.io/posts/tech/compile/summary/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8d8b767ac9b1d8bce25f548e0a8aeaef8929f1e46f3e5b25efa3ff8f103cf9da.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://mksasx.github.io/img/1.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://mksasx.github.io/img/1.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://mksasx.github.io/img/1.jpg">
<link rel="apple-touch-icon" href="https://mksasx.github.io/img/1.jpg">
<link rel="mask-icon" href="https://mksasx.github.io/img/1.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£" />
<meta property="og:description" content="è¿™æ˜¯æˆ‘çš„ç¼–è¯‘è¯¾ç¨‹æœŸæœ«æ€»ç»“æ–‡æ¡£" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mksasx.github.io/posts/tech/compile/summary/" />
<meta property="og:image" content="https://mksasx.github.io/posts/tech/os/great.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-30T12:31:30&#43;08:00" />
<meta property="article:modified_time" content="2022-12-30T12:31:30&#43;08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://mksasx.github.io/posts/tech/os/great.png" />
<meta name="twitter:title" content="ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£"/>
<meta name="twitter:description" content="è¿™æ˜¯æˆ‘çš„ç¼–è¯‘è¯¾ç¨‹æœŸæœ«æ€»ç»“æ–‡æ¡£"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://mksasx.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
      "item": "https://mksasx.github.io/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "âš›ï¸ ç¼–è¯‘",
      "item": "https://mksasx.github.io/posts/tech/compile/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£",
      "item": "https://mksasx.github.io/posts/tech/compile/summary/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£",
  "name": "ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£",
  "description": "è¿™æ˜¯æˆ‘çš„ç¼–è¯‘è¯¾ç¨‹æœŸæœ«æ€»ç»“æ–‡æ¡£",
  "keywords": [
    "ç¼–è¯‘æœŸæœ«æ€»ç»“", "Compiler"
  ],
  "articleBody": "ç¼–è¯‘è®¾è®¡æ–‡æ¡£ å§“åï¼šé©¬æ³½è¿œ\nå­¦å·ï¼š20373793\nä¸€. å‚è€ƒç¼–è¯‘å™¨ä»‹ç» Pcodeä»£ç ç”Ÿæˆéƒ¨åˆ†ï¼ˆåŒ…æ‹¬Pcodeä»£ç æ‰§è¡Œï¼‰éƒ¨åˆ†å‚è€ƒäº†ã€Šè‡ªå·±åŠ¨æ‰‹å†™ç¼–è¯‘å™¨ã€‹ã€‚\nå…¶ä½™éƒ¨åˆ†å‚è€ƒäº†å¾€å¹´çš„ç¼–è¯‘æŒ‡å¯¼æ–‡æ¡£ï¼ŒåŒ…æ‹¬ä¸€äº›å¾€å±Šå­¦é•¿çš„ç¼–è¯‘å™¨è®¾è®¡æ¶æ„\näºŒ. ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡ æ€»ä½“ç»“æ„ æˆ‘çš„ç¼–è¯‘å™¨æ€»ä½“ç»“æ„æŒ‰ç…§ç¼–è¯‘çš„é¡ºåºï¼Œå³è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä»£ç ç”Ÿæˆï¼Œåˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ã€‚\næœ‰å‡ ä¸ªç±»ç”¨æ¥å®šä¹‰åŸºæœ¬çš„ä¸€äº›éœ€è¦ç”¨åˆ°çš„å˜é‡ï¼Œæ¯”å¦‚**TokenWordç±»å¯¹åº”ç€å•è¯ç±»**ï¼Œå…¶å±æ€§åŒ…æ‹¬å•è¯å†…å®¹ï¼Œç±»åˆ«ç ï¼Œæ‰€åœ¨è¡Œæ•°ã€‚ç±»ä¼¼çš„ï¼Œè¿˜æœ‰**Symbolç±»å¯¹åº”ç€ç¬¦å·ç±»**,Expressionsç±»å¯¹åº”ç€è¡¨è¾¾å¼ç±»,ç”¨äºè¡¨ç¤ºä¸€ä¸ªå…·æœ‰å¤šä¸ªè¡¨è¾¾å¼çš„å¤§è¡¨è¾¾å¼ï¼Œä»¥åŠ**SymbolTableç±»å¯¹åº”ç€ç¬¦å·è¡¨ç±»**ï¼ŒFuncç±»å¯¹åº”ç€å‡½æ•°ç±»ï¼Œè¿˜æœ‰**Errorç±»**ã€‚\nå¦å¤–çš„å‡ ä¸ªç±»ï¼Œåˆ™æ˜¯åˆ†åˆ«å¯¹åº”ç€ç›¸åº”çš„å‡ ä¸ªç¼–è¯‘å™¨æ‰§è¡Œè¿‡ç¨‹ï¼ŒLexicalAanlysisç±»å¯¹åº”è¯æ³•åˆ†æï¼ŒGrammarAanlysisç±»ç»¼åˆäº†è¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æã€é”™è¯¯å¤„ç†ï¼Œä»¥åŠç”Ÿæˆä¸­é—´ä»£ç ï¼ˆPcodeç ï¼‰\nè€Œå¯¹äºPcodeçš„å®šä¹‰ï¼Œæ‰§è¡Œåˆ™æ˜¯å•ç‹¬è®¾ç½®äº†ä¸€ä¸ªæ–‡ä»¶åŒ…**PcodeGeneration,å…¶ä¸­åŒ…å«å¯¹Pcodeçš„Functionã€Executeï¼Œretinfoï¼Œvariety**ä»¥åŠå…¶æœ¬èº«ã€‚\nCompilerç±»å¯¹åº”ç€ç¼–è¯‘å™¨çš„æ€»å…¥å£ã€‚åœ¨å…¶ä¸­ï¼Œä¾æ¬¡è°ƒç”¨**LexicalAanlysisï¼ŒGrammarAanlysisï¼ŒPcodeExecutorç±»ï¼Œå³å¯å®Œæˆè¯æ³•åˆ†æåˆ°è¯­æ³•åˆ†æåˆ°è¯­ä¹‰åˆ†æåˆ°ä»£ç ç”Ÿæˆçš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå½¢æˆäº†ç±»ä¼¼ä¸€ä¸ªå•å‘é“¾**ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ã€‚\næ–‡ä»¶ç»„ç»‡ src â”‚ Compiler.java #å…¥å£ç¨‹åº â”‚ Error.java #é”™è¯¯ç±» â”‚ Expressions.java #è¡¨è¾¾å¼ç±» â”‚ Func.java #å‡½æ•°ç±» â”‚ GrammarAnalysis.java #è¯­æ³•åˆ†æã€é”™è¯¯å¤„ç†ã€ä»£ç ç”Ÿæˆç±» â”‚ lexicalAnalysis.java #è¯æ³•åˆ†æç±» â”‚ Symbol.java #ç¬¦å·ç±» â”‚ SymbolTable.java #ç¬¦å·è¡¨ç±» â”‚ TokenWord.java #å•è¯ç±» â””â”€PcodeGeneration Function.java #Pcodeä¸­çš„å‡½æ•°ç±» LabelCreator.java #æ ‡ç­¾åˆ¶é€  Pcode.java #Pcodeä»£ç ç±» PcodeExecutor.java #Pcodeè¿è¡Œè™šæ‹Ÿæœºç±» PcodeKey.java #æšä¸¾Pcodeä¸­çš„å…³é”®è¯ RetInfo.java #è¿”å›ä¿¡æ¯ç±» Variety.java #å˜é‡ç±» ç±»å›¾ ä¸‰. è¯æ³•åˆ†æè®¾è®¡ 1 æ€»è¿° è¯æ³•åˆ†æçš„æ€»ä»»åŠ¡æ˜¯ä»æºç¨‹åºä¸­è¯†åˆ«å‡ºå•è¯ï¼Œè®°å½•å•è¯ç±»åˆ«å’Œå•è¯å€¼ã€‚åœ¨è¯æ³•åˆ†æçš„è®¾è®¡ä¸­ç»™äº†ä¸€å¼ è¡¨ï¼Œå…¶ä¸­æœ‰ä¸‰é¡¹æ˜¯åŠ ç²—è¯´æ˜çš„ï¼Œåˆ†åˆ«æ˜¯ å˜é‡åï¼ˆIdentï¼‰ï¼Œæ•´å¸¸æ•°ï¼ˆIntConstï¼‰ å’Œ æ ¼å¼å­—ç¬¦ä¸²ï¼ˆFormatStringï¼‰ è€Œå‰©ä¸‹éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ ç‰¹æ®Šå­—ç¬¦ã€‚\nè¯æ³•åˆ†æçš„ä½œä¸šæœ¬è´¨ä¸Šå°±æ˜¯æŠŠæ–‡ä»¶è½¬æ¢æˆä¸€ä¸ªä¸ªçš„è¯ï¼Œåœ¨ä¹‹åçš„æ–‡ç« ä¸­æˆ‘ä»¬ç§°ä¹‹ä¸º TokenWordã€‚ç„¶åå†æŠŠåˆ†å‡ºæ¥çš„**TokenWord**è¿›è¡Œç±»åˆ«çš„åˆ¤æ–­ï¼Œæœ€åè¾“å‡ºã€‚\n2 å®ç° 2.1 æ–‡ä»¶è¯»å†™ InputStreamReader Reader = new InputStreamReader(new FileInputStream(\"testfile.txt\"), \"UTF-8\"); BufferedReader bufferedReader = new BufferedReader(Reader); OutputStreamWriter Writer = new OutputStreamWriter(new FileOutputStream(\"output.txt\"), \"UTF-8\"); BufferedWriter bufferedWriter = new BufferedWriter(Writer); åˆ©ç”¨bufferedReaderé€è¡Œè¯»å…¥æ–‡ä»¶ï¼Œæ³¨æ„éœ€è¦æ‰‹åŠ¨åŠ å…¥æ¢è¡Œç¬¦ï¼ˆæœ€åæ·»åŠ çš„ä¸€ä¸ªè¦åˆ æ‰ï¼‰\nwhile ((line = bufferedReader.readLine()) != null) { str.append(line).append(\"\\n\"); } str.delete(str.length() - 1, str.length()); å°†lexicalAnalysisä¸­åˆ†æå¾—åˆ°çš„tokenWordså†™å‡º\nfor(TokenWord tokenWord :lexicalAnalysis.tokenWords) { bufferedWriter.write(tokenWord.getClassCode()+\" \"+ tokenWord.getToken()+\"\\n\"); } 2.2 è¯æ³•åˆ†æè¿‡ç¨‹ å‡†å¤‡å·¥ä½œ æ ‡è¯†ç¬¦å®šä¹‰é‡‡ç”¨enumæšä¸¾ClassCodeçš„æ–¹æ³•\npublic static enum ClassCode { IDENFR, INTCON, STRCON, ...... åŒæ—¶é‡‡ç”¨HashMapæ„é€ ä¸€äº›ç‰¹å®šæ ‡è¯†ç¬¦çš„å¯¹åº”å…³ç³»\npublic static HashMap\u003cString, String\u003e ResCode = new HashMap\u003cString, String\u003e(); public static boolean hasResCode(String token) { return ResCode.containsKey(token); } static { ResCode.put(\"main\", \"MAINTK\"); ResCode.put(\"const\", \"CONSTTK\"); ...... å…·ä½“åˆ†æ æ€»ä½“é‡‡å–é€ä¸ªå­—ç¬¦è¯»å…¥çš„æ–¹å¼ï¼ŒåŒæ—¶ä¸€äº›ç‰¹å®šå­—ç¬¦é‡‡å–é¢„è¯»å–æ¥åˆ¤æ–­ã€‚\né€ä¸ªå­—ç¬¦è¯»å…¥ public void getCh() { ch = allFile.charAt(cursor); cursor++; } è·³è¿‡æ¢è¡Œã€ç©ºæ ¼ã€\\tã€\\r while (ch == '\\n' || ch == ' ' || ch == '\\t' || ch == '\\r') { if (ch == '\\n' || ch == '\\r') { LineNum++; } if (cursor \u003c= allFile.length() - 1) { getCh(); } } æ ‡è¯†ç¬¦ å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´ï¼Œå…ˆä»ResCodeçœ‹æ˜¯å¦æ˜¯ä¿ç•™å­—,å¦åˆ™æŒ‰ç…§IDNEFRå¤„ç†\nif (isLetter(ch) || ch == '_') { while (isLetter(ch) || isDigit_with_0(ch) || ch == '_') { Token.append(ch); if (cursor \u003c= allFile.length() - 1) { getCh(); } } //reback if (cursor \u003e 0) { cursor--; } if (hasResCode(Token.toString())) { classCode = ClassCode.valueOf(ResCode.get(Token.toString())); tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } else { classCode = ClassCode.IDENFR; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } INTCON å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯0\nif (isDigit_with_0(ch)) { if (ch == '0') { Token.append(ch); } else { while (isDigit_with_0(ch)) { Token.append(ch); getCh(); } if (cursor \u003e 0) { cursor--; } classCode = ClassCode.INTCON; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } } å­—ç¬¦ä¸² é‡åˆ°\"å¼€å§‹ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª\"\nif (ch == '\"') { Token.append(ch); if (cursor \u003c= allFile.length() - 1) { getCh(); } while (cursor \u003c= allFile.length() - 1 \u0026\u0026 ch != '\"') { Token.append(ch); getCh(); } Token.append(ch); classCode = ClassCode.STRCON; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„TokenWord æ¯”å¦‚[ï¼Œ]ï¼Œ+ï¼Œ\u0026\u0026ç­‰ï¼Œç›´æ¥è¯»å°±å¯ä»¥\nå¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„TokenWord æ¯”å¦‚\u003e=ï¼Œ!=ä¹‹ç±»çš„\né‡‡ç”¨é¢„è¯»\nif (ch == '=') { Token.append(ch); if (cursor \u003c= allFile.length() - 1) { getCh(); if (ch == '=') { Token.append(ch); classCode = ClassCode.EQL; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } else { classCode = ClassCode.ASSIGN; if (cursor \u003e 0) { cursor--; } tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } } else { classCode = ClassCode.ASSIGN; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } } æ³¨é‡Š é‡åˆ°/çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨é¢„è¯»\n//ï¼šå¹¶ä¸”ä¸€ç›´è¯»åˆ°é‡åˆ°æ¢è¡Œç¬¦\n/*ï¼šåˆ©ç”¨BackStr = allFile.substring(cursor);æå–å‡ºç¬¬ä¸€ä¸ª*åé¢çš„å­—ç¬¦ä¸²BackStrï¼›ç„¶ååˆ¤æ–­å…¶ä¸­æœ‰æ²¡æœ‰*/ï¼Œè‹¥æ˜¯æ²¡æœ‰ï¼Œå°±å°†åé¢çš„å†…å®¹å…¨éƒ¨æ³¨é‡Šæ‰ï¼Œè‹¥æ˜¯æœ‰å°±å°†cursorç§»åŠ¨åˆ°å…¶åé¢ï¼Œä½†æ˜¯æ³¨æ„è¦é‡åˆ°æ¢è¡Œç¬¦æ—¶åŠ è¡Œæ•°ã€‚\nå¦åˆ™/ï¼šç›´æ¥æŒ‰ç…§DIVè¾“å‡º\nif (ch == '/') { Token.append(ch); if (cursor \u003c= allFile.length() - 1) { getCh(); if (ch == '/') { if (cursor \u003c= allFile.length() - 1) { getCh(); } while (ch != '\\n') { if (cursor \u003c= allFile.length() - 1) getCh(); else { noteFlag = true; break; } } if (!noteFlag) { LineNum++; } noteFlag = false; return -2; } else if (ch == '*') { String BackStr; boolean flagnote; int cursortmp = cursor; BackStr = allFile.substring(cursor); if (!BackStr.contains(\"*/\")) { cursor = allFile.length(); return -2; } else { cursor = cursor + BackStr.indexOf(\"*/\") + 2; int originLength = allFile.substring(cursortmp, cursor).length(); int replaceLength = allFile.substring(cursortmp, cursor).replace(\"\\n\", \"\").length(); LineNum += originLength - replaceLength; return -2; } } else { classCode = ClassCode.DIV; if (cursor \u003e 0) { cursor--; } tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } } else { classCode = ClassCode.DIV; tokenWords.add(new TokenWord(classCode.toString(),Token.toString(),LineNum)); } } å››. è¯­æ³•åˆ†æè®¾è®¡ 1 æ€»è¿° åœ¨è¯­æ³•åˆ†æé˜¶æ®µï¼Œæ ¹æ®è¯æ³•åˆ†æç¨‹åºè¯†åˆ«å‡ºçš„Tokenå•è¯ï¼Œæ ¹æ®SysYè¯­æ³•è§„åˆ™è¯†åˆ«å‡ºå„ç§è¯­æ³•å…ƒç´ ã€‚é‡‡ç”¨é€’å½’ä¸‹é™æ³•å¯¹è¯­æ³•ä¸­å®šä¹‰çš„è¯­æ³•æˆåˆ†è¿›è¡Œåˆ†æã€‚æ³¨æ„è¦æ¶ˆé™¤å·¦é€’å½’ï¼Œä»¥åŠé¢å¯¹å¯èƒ½çš„å›æº¯é—®é¢˜è¿›è¡Œé¢„è¯»ã€‚\nä»**CompUnit**å¼€å§‹é€å±‚å¾€ä¸‹è¿›è¡Œåˆ†æã€‚\n2 å…·ä½“å®ç° è®¾ç½®getWordMove(),getNowWord(),getNextWord(),getThirdWord()å·¥å…·å‡½æ•°ç”¨äºè¯»å…¥tokenWord,åŒæ—¶è®¾ç½®GrammarString,curTokenWordç­‰å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨è·å¾—çš„è¯­æ³•åˆ†ææˆåˆ†ï¼Œä»¥åŠå½“å‰æ‰€è¯»åˆ°çš„tokenWordã€‚\nå¯¹äºæ™®é€šçš„è¯­æ³•æˆåˆ†ï¼Œæˆ‘é€ä¸ªè¯»å…¥tokenWordï¼Œç„¶åå¯¹å…¶è¿›è¡Œå¸¸è§„çš„åˆ†æã€‚\nå¯¹äºè¡¨è¾¾å¼Expressionï¼Œæˆ‘é¦–å…ˆæ‰«æå‡ºæ•´ä¸ªçš„Expression,ç„¶åå¯¹äºå…·æœ‰å·¦é€’å½’æ€§çš„è¯­æ³•è§„åˆ™ï¼Œå†ä¾æ®ç‰¹å®šçš„åˆ†éš”ç¬¦ï¼Œå¯¹æ•´ä¸ªå¤§çš„Expressionè¿›è¡Œåˆ†å‰²æˆè‹¥å¹²ä¸ªè¾ƒçŸ­çš„Expressionï¼Œç„¶åä¾æ¬¡è°ƒç”¨å¯¹åº”å­è¡¨è¾¾å¼çš„åˆ†ææ–¹æ³•ï¼Œè¿›è¡Œé€’å½’ä¸‹é™æ³•è¿›è¡Œåˆ†æã€‚\næ„å»ºäº†ä¸€ä¸ªæ–°çš„Expressionsç±»ï¼Œç”¨äºå­˜æ”¾åˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼,å…¶ä¸­è®°å½•æœ‰åˆ†éš”ç¬¦ï¼Œåˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼\npublic class Expressions { private ArrayList\u003cTokenWord\u003e symbols; private ArrayList\u003cArrayList\u003cTokenWord\u003e\u003e expressions; public ArrayList\u003cArrayList\u003cTokenWord\u003e\u003e getExpressions() { return expressions; } public ArrayList\u003cTokenWord\u003e getSymbols() { return symbols; } public Expressions(ArrayList\u003cTokenWord\u003e symbols, ArrayList\u003cArrayList\u003cTokenWord\u003e\u003e expressions) { this.symbols = symbols; this.expressions = expressions; } } 2.1 è·å–è¡¨è¾¾å¼â€“getExpression é€šè¿‡ä¸€äº›ç‰¹å®šçš„åˆ¤æ–­æ¡ä»¶ï¼Œç»“åˆå½“å‰å­—ç¬¦ä»¥åŠå‰ä¸€ä¸ªå­—ç¬¦çš„å€¼è¿›è¡Œåˆ¤æ–­ï¼Œä»¥åŠæ˜¯å¦ä½äºå‡½æ•°çš„åˆ¤æ–­ç­‰ï¼Œè¿›è¡Œè¡¨è¾¾å¼çš„è·å–ï¼ˆåç»­æ”¹å†™çš„æ—¶å€™æ¯”è¾ƒç¹çï¼‰\npublic ArrayList\u003cTokenWord\u003e getExpression() { TokenWord preWord = null; TokenWord word = getNowWord(); ArrayList\u003cTokenWord\u003e exp = new ArrayList\u003c\u003e(); boolean inFunc = false; int FuncFlag = 0; int FlagSmall = 0; int FlagBig = 0; while (true) { if (word.ClassCodeOf(\"SEMICN\") || word.ClassCodeOf(\"ASSIGN\") || word.ClassCodeOf(\"RBRACE\") || word.ClassCodeOfTrueStmt()) { break; } //ä¸åœ¨å‡½æ•°å£°æ˜æˆ–è€…å¼•ç”¨å†…ï¼Œä¸”é‡åˆ°',' if (word.ClassCodeOf(\"COMMA\") \u0026\u0026 !inFunc) { break; } //å•è¯ä¸åœ¨è¡¨è¾¾å¼å†… if (preWord != null) { if ((preWord.ClassCodeOf(\"INTCON\") || preWord.ClassCodeOf(\"IDENFR\")) \u0026\u0026 (word.ClassCodeOf(\"INTCON\") || word.ClassCodeOf(\"IDENFR\"))) { break; } if ((preWord.ClassCodeOf(\"RPARENT\") || preWord.ClassCodeOf(\"RBRACK\")) \u0026\u0026 (word.ClassCodeOf(\"INTCON\") || word.ClassCodeOf(\"IDENFR\"))) { break; } if (FlagSmall == 0 \u0026\u0026 FlagBig == 0) { if (preWord.ClassCodeOf(\"INTCON\") \u0026\u0026 word.ClassCodeOf(\"LBRACK\")) { break; } if (preWord.ClassCodeOf(\"INTCON\") \u0026\u0026 word.ClassCodeOf(\"LBRACE\")) { break; } } } if (word.ClassCodeOfNotInExp()) { break; } //åœ¨å‡½æ•°å†…éƒ¨ if (word.ClassCodeOf(\"IDENFR\")) { if (getNextWord().ClassCodeOf(\"LPARENT\")) { inFunc = true; } } //(),[]è¯†åˆ« if (word.ClassCodeOf(\"LPARENT\")) { FlagSmall++; if (inFunc) { FuncFlag++; } } if (word.ClassCodeOf(\"RPARENT\")) { FlagSmall--; if (inFunc) { FuncFlag--; if (FuncFlag == 0) { inFunc = false; } } } switch (word.getClassCode()) { case \"LBRACK\": FlagBig++; break; case \"RBRACK\": FlagBig--; break; } if (FlagSmall \u003c 0) { break; } if (FlagBig \u003c 0) { break; } curTokenWord = tokenWords.get(cursor); cursor++; exp.add(curTokenWord); preWord = word; word = getNowWord(); } return exp; } 2.2 é€’å½’ä¸‹é™ å¯¹äºä¸€æ¡è¯­æ³•æ¨å¯¼è§„åˆ™ï¼Œè‹¥å…¶æ¨å¯¼å‡ºçš„å¼å­ä¸­å«æœ‰$V_{N}$,é‚£ä¹ˆè€ƒè™‘é‡‡ç”¨é€’å½’ä¸‹é™åˆ†ææ³•\nåœ¨æˆ‘çš„å®ç°ä¸­ï¼Œæˆ‘æ¯è¯»ä¸€ä¸ªtokenWordï¼Œæ£€æŸ¥å®ƒå±äºå“ªä¸€ä¸ª$V_{N}$ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªç›¸åº”çš„åˆ†æå‡½æ•°ã€‚\nä¾‹å¦‚CompUnit:\nCompUnit â†’ {Decl} {FuncDef} MainFuncDef // 1.æ˜¯å¦å­˜åœ¨Decl 2.æ˜¯å¦å­˜åœ¨ FuncDef å…·ä½“å®ç°ï¼š\npublic void analyseCompUnit() { TokenWord word = getNowWord(); while (word.ClassCodeOf(\"CONSTTK\") || (word.ClassCodeOf(\"INTTK\") \u0026\u0026 getNextWord().ClassCodeOf(\"IDENFR\") \u0026\u0026 !getThirdWord().ClassCodeOf(\"LPARENT\"))) { analyseDecl(); word = getNowWord(); } while (word.ClassCodeOf(\"VOIDTK\") || ((word.ClassCodeOf(\"INTTK\") \u0026\u0026 !getNextWord().ClassCodeOf(\"MAINTK\")))) { analyseFuncDef(); word = getNowWord(); } if (word.ClassCodeOf(\"INTTK\") \u0026\u0026 getNextWord().ClassCodeOf(\"MAINTK\")) { analyseMainFuncDef(); } else { Error(); } GrammarString.add(\"\"); } åˆæ¯”å¦‚Stmt\nè¯­å¥ Stmt â†’ LVal '=' Exp ';' // æ¯ç§ç±»å‹çš„è¯­å¥éƒ½è¦è¦†ç›– | [Exp] ';' //æœ‰æ— Expä¸¤ç§æƒ…å†µ | Block | 'if' '(' Cond ')' Stmt [ 'else' Stmt ] // 1.æœ‰else 2.æ— else | 'while' '(' Cond ')' Stmt | 'break' ';' | 'continue' ';' | 'return' [Exp] ';' // 1.æœ‰Exp 2.æ— Exp | LVal '=' 'getint''('')'';' | 'printf''('FormatString{','Exp}')'';' // 1.æœ‰Exp 2.æ— Exp å…·ä½“å®ç°ï¼š\npublic void analyseStmt() { TokenWord word = getNowWord(); if (word.ClassCodeOf(\"IDENFR\")) { ArrayList\u003cTokenWord\u003e exp = getExpression(); if (!getNowWord().ClassCodeOf(\"SEMICN\")) { analyseLVal(exp); getWordMove();//= if (getNowWord().ClassCodeOf(\"GETINTTK\")) { getWordMove();//getint getWordMove();//( getWordMove();//) getWordMove();//; } else { analyseExp(getExpression());// getWordMove(); //; } } else { analyseExp(exp); getWordMove();//; } } else if (word.ClassCodeOfBeginOfExp()) { analyseExp(getExpression()); getWordMove();//; } else if (word.ClassCodeOf(\"LBRACE\")) { analyseBlock(); } else if (word.ClassCodeOf(\"IFTK\")) { getWordMove();//if getWordMove();//( analyseCond(); getWordMove();//) analyseStmt(); word = getNowWord(); if (word.ClassCodeOf(\"ELSETK\")) { getWordMove(); //else analyseStmt(); } } else if (word.ClassCodeOf(\"WHILETK\")) { getWordMove();//while getWordMove();//( analyseCond(); getWordMove();//) analyseStmt(); } else if (word.ClassCodeOf(\"BREAKTK\")) { getWordMove();//break getWordMove();//; } else if (word.ClassCodeOf(\"CONTINUETK\")) { getWordMove();//continue getWordMove();//; } else if (word.ClassCodeOf(\"RETURNTK\")) { getWordMove();//return word = getNowWord(); if (word.ClassCodeOfBeginOfExp()) { analyseExp(getExpression()); } getWordMove();//; } else if (word.ClassCodeOf(\"PRINTFTK\")) { getWordMove();//printf getWordMove();//( getWordMove();//STRCON word = getNowWord(); while (word.ClassCodeOf(\"COMMA\")) { getWordMove();//, analyseExp(getExpression()); word = getNowWord(); } getWordMove();//) getWordMove();//; } else if (word.ClassCodeOf(\"SEMICN\")) { getWordMove();//; } GrammarString.add(\"\"); } åœ¨ä»¥ä¸Šçš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯\nä¸€äº›è¯­æ³•æˆåˆ†å†…éƒ¨åˆ†æè¿‡ç¨‹çš„ç»†èŠ‚æ€§æ³¨æ„ï¼ˆæ‹¬å·åŒ¹é…ç­‰é—®é¢˜ï¼‰ é¢å¯¹$V_{N}$ï¼Œéœ€è¦getNowWord()é¢„è¯»ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥åŠ å…¥GrammarStringä¸­ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­å±äºå“ªä¸ª$V_{N}$ 2.3 å·¦é€’å½’æ¶ˆé™¤ é‡‡ç”¨è½¬æ¢ä¸ºBNFèŒƒå¼çš„æ–¹æ³•æ¶ˆé™¤å·¦é€’å½’\nä¾‹å¦‚åŠ å‡è¡¨è¾¾å¼\nAddExp â†’ MulExp | AddExp ('+' | 'âˆ’') MulExp // 1.MulExp 2.+ éœ€è¦†ç›– 3.- éœ€è¦†ç›– æ”¹å†™ä¸º\nAddExp â†’ MulExp ('+' | 'âˆ’') MulExp ('+' | 'âˆ’') MulExp ... æ”¹å†™å®Œä»¥åï¼Œæ„é€ **divideExp()**æ–¹æ³•ï¼Œå°†æ•´ä¸ªå¤§çš„è¡¨è¾¾å¼è¿›è¡Œåˆ†å‰²ï¼Œå†ä¾æ¬¡è°ƒç”¨å­ç¨‹åºè¿›è¡Œåˆ†æ\nprivate Expressions (divideExp(ArrayList exp, ArrayList symbol):\nè¾“å…¥ï¼šè¡¨è¾¾å¼exp,åˆ†éš”ç¬¦åˆ—è¡¨\nè¿”å›ï¼šåˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼ï¼Œåˆ†å‰²ç¬¦å·åˆ—è¡¨ â€”â€”â€”â€” return new Expressions(symbols, exps)\npublic Expressions divideExp(ArrayList\u003cTokenWord\u003e exp, ArrayList\u003cString\u003e symbol) { ArrayList\u003cArrayList\u003cTokenWord\u003e\u003e exps = new ArrayList\u003c\u003e(); ArrayList\u003cTokenWord\u003e tmpExp = new ArrayList\u003c\u003e(); ArrayList\u003cTokenWord\u003e symbols = new ArrayList\u003c\u003e(); boolean unaryFlag = false; int FlagSmall = 0; int FlagBig = 0; for (TokenWord word : exp) { switch (word.getClassCode()) { case \"LPARENT\": FlagSmall++; break; case \"RPARENT\": FlagSmall--; break; case \"LBRACK\": FlagBig++; break; case \"RBRACK\": FlagBig--; break; } //é‡åˆ°æŒ‡å®šåˆ†éš”ç¬¦ï¼Œå¹¶ä¸”(),[]å¾—åˆ°åŒ¹é… if (symbol.contains(word.getClassCode()) \u0026\u0026 FlagSmall == 0 \u0026\u0026 FlagBig == 0) { //å¦‚æœåˆ†éš”ç¬¦æ˜¯å•ç›®è¿ç®—ç¬¦ if (word.ClassCodeOfUnary()) { //å¦‚æœä¸Šä¸€ä¸ªwordä¸æ˜¯è¯†åˆ«ç¬¦,),],intå¸¸æ•°ï¼Œé‚£ä¹ˆä¸åœ¨æ­¤å¤„åˆ†å‰²ï¼Œä»…å°†å½“å‰wordåŠ å…¥exp if (!unaryFlag) { tmpExp.add(word); continue; } } //å¦‚æœä¸Šä¸€ä¸ªwordä¸æ˜¯è¯†åˆ«ç¬¦,),],intå¸¸æ•°ï¼Œå‘expsä¸­åŠ å…¥å½“å‰è¡¨è¾¾å¼ï¼Œå¹¶ä¸”é‡ç½®è¡¨è¾¾å¼ï¼Œå‘åˆ†éš”ç¬¦åˆ—è¡¨ä¸­åŠ å…¥å½“å‰word exps.add(tmpExp); symbols.add(word); tmpExp = new ArrayList\u003c\u003e(); } else { tmpExp.add(word); } unaryFlag = word.ClassCodeOf(\"IDENFR\") || word.ClassCodeOf(\"RPARENT\") || word.ClassCodeOf(\"INTCON\") || word.ClassCodeOf(\"RBRACK\"); } exps.add(tmpExp); return new Expressions(symbols, exps); } æœ€ç»ˆä¾‹å¦‚åŠ å‡è¡¨è¾¾å¼,åˆ†æä»£ç å¦‚ä¸‹\npublic void analyseAddExp(ArrayList\u003cTokenWord\u003e exp) { Expressions exps = divideExp(exp, new ArrayList\u003c\u003e(Arrays.asList(\"PLUS\", \"MINU\"))); int j = 0; for (ArrayList\u003cTokenWord\u003e tmpExp : exps.getExpressions()) { analyseMulExp(tmpExp); GrammarString.add(\"\"); if (j \u003c exps.getSymbols().size()) { GrammarString.add(exps.getSymbols().get(j++).toString()); } } } äº”. é”™è¯¯å¤„ç†è®¾è®¡ 1 æ€»ä½“è®¾è®¡ æ–°å®šä¹‰ç±»\nå®šä¹‰Errorç±»ï¼Œå­˜æ”¾é”™è¯¯çš„ç±»å‹ï¼Œæ‰€åœ¨è¡Œæ•° å®šä¹‰Symbolç±»ï¼Œtypeæ˜¯æŒ‡ç¬¦å·çš„ç±»å‹,ä¾‹å¦‚const,var,paraã€‚Dimensionæ˜¯ä¸€ä¸ªæ•´æ•°,æŒ‡å‡ºäº†ç¬¦å·çš„ç»´æ•°ã€‚å¦‚æœä¸º0ï¼Œåˆ™ç¬¦å·ä¸ºintã€‚å¦‚æœä¸º1ï¼Œåˆ™ç¬¦å·ä¸ºint[]ï¼›å¦‚æœä¸º2ï¼Œåˆ™ç¬¦å·ä¸ºint[][]â€¦ã€‚tokenæ˜¯æŒ‡Symbolçš„å†…å®¹ã€‚layerå°±æ˜¯è¿™ä¸ªç¬¦å·æ‰€åœ¨çš„å±‚çº§ã€‚ public Symbol(String type, int Dimension, TokenWord tokenWord, int layer) { this.type = type; this.Dimension = Dimension; this.token = tokenWord.getToken(); this.layer = layer; } å®šä¹‰SymbolTableç±»æ¥å­˜æ”¾ç¬¦å·è¡¨ï¼Œåœ¨å…¶ä¸­ç”¨HashMap mapSymbolæ¥å­˜æ”¾ç¬¦å·ï¼ŒåŒæ—¶åœ¨å…¶ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€çš„æ–¹æ³•\nå®šä¹‰Funcç±»ï¼Œåˆ†åˆ«è®°å½•å‡½æ•°åã€å‡½æ•°è¿”å›ç±»å‹ï¼ˆvoidï¼Œintï¼‰ã€ä»¥åŠå‡½æ•°çš„å‚æ•°ç±»å‹\nç”¨ArrayList TypeOfParasæ¥è®°å½•å‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œ0ã€1ã€2åˆ†åˆ«ä»£è¡¨ç€int,int[],int[][]\nType Example Integer Void ï¼ˆå‡½æ•°è¿”å›å€¼ä¸ºç©ºï¼‰ -1 Int a 0 Int[] a[] 1 Int[] [] a[] [3] 2 åœ¨GrammarAnalysisç±»ä¸­ï¼Œæˆ‘å®šä¹‰äº†å¦‚ä¸‹å‡ ä¸ªæ–°çš„å˜é‡\nprivate final ArrayList\u003cError\u003e errors = new ArrayList\u003c\u003e(); //å‡½æ•°åHashmap private final HashMap\u003cString, Func\u003e funcs = new HashMap\u003c\u003e(); //å±‚çº§layerå¯¹åº”ç¬¦å·è¡¨,æ¯å½“è¿›å…¥ä¸€ä¸ªæ–°å±‚çº§ï¼Œå°±å°†layer++ï¼Œæ–°æ„é€ ä¸€ä¸ªSymbolTables private final HashMap\u003cInteger, SymbolTable\u003e SymbolTables = new HashMap\u003c\u003e(); private int layer = -1; private boolean ReturnFlag = false;//è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦éœ€è¦è¿”å›ã€‚ private int IndexWhile = 0; //è¡¨ç¤ºå½“å‰ä»£ç å—æ˜¯å¦åœ¨whileä¸­ã€‚ æ³¨æ„ï¼š\nåœ¨AnalyseBlockä¸­å¯¹äºä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼Œä¸å‡½æ•°çš„å‚æ•°æ˜¯åŒä¸€ä¸ªLayerçš„ï¼ˆå¦åˆ™æ— æ³•åˆ¤æ–­å‡½æ•°å†…éƒ¨é‡å¤å®šä¹‰å‡½æ•°å‚æ•°ç­‰é”™è¯¯ï¼‰è€Œå¯¹äºmainå‡½æ•°ï¼Œè¿›å…¥åˆ°Blockçš„æ—¶å€™ï¼ŒLayerè¦åŠ 1ï¼ˆmainå‡½æ•°å†…éƒ¨å¯ä»¥é‡å¤å®šä¹‰å…¨å±€å˜é‡ï¼‰\nprivate boolean analyseBlock(boolean fromFunc) { ... if (!fromFunc) { IncreaseLayer(); } ... if (!fromFunc) { DecreaseLayer(); } } 2 å…·ä½“åˆ†æ Errors a æ£€æŸ¥æ ¼å¼å°±å¥½\npublic boolean IllegalFormatString() { int i = 1; while (i \u003c= content.length() - 2) { if (NormalChar(content.charAt(i))) { if (content.charAt(i) == '\\\\') { if (content.charAt(i + 1) != 'n') { return true; } } i++; } else { if (content.charAt(i) == '%' \u0026\u0026 content.charAt(i + 1) == 'd') { i++; } else { return true; } } } return false; } b c b: å¯¹äºå˜é‡ã€å‡½æ•°å‚æ•°æ¥è¯´ï¼Œæ¯æ¬¡æˆ‘å¾—åˆ°ä¸€ä¸ªIdentè¯†åˆ«ç¬¦ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„ç¬¦å·è¢«å®šä¹‰åœ¨åŒä¸€å±‚çº§ã€‚å¯¹äºå‡½æ•°æ¥è¯´ï¼Œç›´æ¥æŸ¥çœ‹funcs.containsKey(curTokenWord.getToken())ã€‚\n//åˆ¤æ–­å½“å‰åŒºå—æ˜¯å¦æœ‰å½“å‰ç¬¦å· b public boolean existSymbolInThisArea(TokenWord tokenWord) { return SymbolTables.get(layer).SymbolExist(tokenWord); } c: æ£€æŸ¥æ‰€æœ‰å±‚çº§çš„ç¬¦å·è¡¨ï¼Œæ­¤å‡½æ•°ç¬¦å·æ˜¯å¦å·²å®šä¹‰ã€‚å‡½æ•°ç›´æ¥æŸ¥çœ‹funcs\nprivate boolean hasSymbol(Word word) { for (Symbols s : symbols.values()) { if (s.hasSymbol(word)) { return true; } } return false; } d e é¦–å…ˆï¼Œä¸ºäº†è·å–æ¯ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼ˆå¯èƒ½ä¸ºè¡¨è¾¾å¼ï¼‰çš„çœŸå®ç»´æ•°ï¼Œæˆ‘åœ¨è¯­æ³•åˆ†æå™¨çš„é€’å½’ä¸‹é™è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§Exp-\u003eAdd-\u003eMul-\u003eUnary-\u003ePrimary/Func-\u003eLval/Expè¿™ä¸ªè·¯å¾„ï¼Œæ¯ä¸ªåˆ†æå‡½æ•°åˆ†åˆ«è¿”å›ç»´æ•°ï¼ˆè°ƒç”¨ä¸‹ä¸€å±‚è·å¾—ï¼‰ï¼Œç›´åˆ°Lvalã€‚\npublic int analyseExp(ArrayList\u003cTokenWord\u003e exp) { int Dimension = analyseAddExp(exp); GrammarString.add(\"\"); return Dimension; } åœ¨Lvalä¸­ï¼Œç»“æŸé€’å½’è°ƒç”¨ï¼Œè¿”å›æœ€ç»ˆç»“æœ\næ³¨æ„\nä¾‹å¦‚a[3][5],lvalå¯¹åº”a[3],é‚£ä¹ˆå®é™…æ•°ç»„ç»´æ•°æ˜¯1 è€ƒè™‘åˆ°a[b[3]]\nprivate int analyseLVal(ArrayList\u003cWord\u003e exp) { TokenWord Ident = exp.get(0); if (!existSymbol(Ident)) { Error(\"c\", Ident.getLineNum()); } GrammarString.add(Ident.toString());//Ident //è‹¥æ˜¯æ•°ç»„\tif (exp.size() \u003e 1) { ArrayList\u003cTokenWord\u003e tmpExp = new ArrayList\u003c\u003e(); int flag = 0; //é€ä¸ªæ‰«æ for (int i = 1; i \u003c exp.size(); i++) { TokenWord word = exp.get(i); if (word.ClassCodeOf(\"LBRACK\")) { if (flag == 0) { Dimension++; //a[]è¿™ç§ï¼Œè€Œä¸æ˜¯a[[]](ä¸èƒ½åŠ ç»´æ•°) } flag++; if (flag == 1) { GrammarString.add(word.toString()); tmpExp = new ArrayList\u003c\u003e(); } else { tmpExp.add(word); } } else if (word.ClassCodeOf(\"RBRACK\")) { flag--; if (flag == 0) { analyseExp(tmpExp); GrammarString.add(word.toString()); } else { tmpExp.add(word); } } else { tmpExp.add(word); } } if (flag \u003e 0) { analyseExp(tmpExp); Error(\"k\", exp.get(exp.size() - 1).getLineNum()); // not sure } } GrammarString.add(\"\"); //å¦‚ä¸Šæ³¨æ„ if (existSymbol(Ident)) { return getSymbol(Ident).getDimension() - Dimension; } else { return 0; } } å®šä¹‰checkFuncParaså‡½æ•°æ¥è¿›è¡Œå‚æ•°æ•°ç›®ï¼Œå‚æ•°ç»´æ•°åˆ¤æ–­,åœ¨åˆ†æanalyseFuncRParamsæ—¶è¿›è¡Œè°ƒç”¨\n//æ£€æŸ¥å‡½æ•°å‚æ•°åŒ¹é…é—®é¢˜ private void checkFuncParas(TokenWord funcName, ArrayList\u003cInteger\u003e standardTypeOfParas, ArrayList\u003cInteger\u003e nowTypeOfParas) { if (standardTypeOfParas.size() != nowTypeOfParas.size()) { Error(\"d\", funcName.getLineNum()); } else { for (int i = 0; i \u003c standardTypeOfParas.size(); i++) { if (!Objects.equals(standardTypeOfParas.get(i), nowTypeOfParas.get(i))) { Error(\"e\", funcName.getLineNum()); } } } } public void analyseFuncRParams(ArrayList\u003cTokenWord\u003e exp, TokenWord Ident, ArrayList\u003cInteger\u003e TypeOfParas) { ArrayList\u003cInteger\u003e nowParas = new ArrayList\u003c\u003e(); Expressions exps = divideExp(exp, new ArrayList\u003c\u003e(Collections.singletonList(\"COMMA\"))); int j = 0; for (ArrayList\u003cTokenWord\u003e tmpExp : exps.getExpressions()) { int Dimension = analyseExp(tmpExp); nowParas.add(Dimension); if (j \u003c exps.getSymbols().size()) { GrammarString.add(exps.getSymbols().get(j++).toString()); } } if (TypeOfParas != null) { checkFuncParas(Ident, TypeOfParas, nowParas); } GrammarString.add(\"\"); } ç„¶ååœ¨analyseFuncRParamsæ—¶ï¼Œå¦‚æœé‡åˆ°äº†å‡½æ•°è°ƒç”¨é‚£ä¹ˆè¿›è¡Œåˆ¤æ–­\nif (exp.size() \u003e 3) { //å®å‚åˆ—è¡¨æœ‰ä¸œè¥¿ analyseFuncRParams(new ArrayList\u003c\u003e(exp.subList(2, exp.size() - 1)), Ident, TypeOfParas); } else { //å®å‚åˆ—è¡¨æ²¡ä¸œè¥¿ if (TypeOfParas != null) { if (TypeOfParas.size() != 0) { Error(\"d\", Ident.getLineNum()); } } } f g å¦‚æœå½“å‰å‡½æ•°éœ€è¦è¿”å›ï¼Œä¼šæœ‰ä¸€ä¸ªå…¨å±€å˜é‡ ReturnFlagæ¥æ˜¾ç¤ºï¼Œåˆå§‹åŒ–ä¸ºfalseã€‚å…¶åœ¨analyseFuncDef()ä»¥åŠanalyseMainFuncDef()ä¸­ï¼Œå¾—åˆ°èµ‹å€¼ã€‚\nå¯¹äºf\nåœ¨åˆ†æStmtä¸­çš„RETURNTKæ—¶å€™ï¼Œè‹¥ ReturnFlagä¸ºfalse,é‚£ä¹ˆå°±äº§ç”Ÿ**f**é”™è¯¯\nå¯¹äºg\nå®šä¹‰äº†hasReturnå˜é‡ï¼Œå…¶åœ¨analyseBlockâ†’BlockItem/Stmtâ†’Stmtè¿™æ¡è·¯å¾„ä¸Šè¿›è¡Œè°ƒç”¨ä¼ é€’ï¼Œå¹¶ä½œä¸ºè¿”å›å€¼è¿”å›\nç„¶ååœ¨analyseFuncDef()ä»¥åŠanalyseMainFuncDef()ä¸­å¯¹ReturnFlag \u0026\u0026 !hasReturnè¿›è¡Œåˆ¤æ–­ï¼Œè‹¥æ˜¯çœŸåˆ™äº§ç”Ÿ**g**é”™è¯¯\nh åˆ¤æ–­æ˜¯å¦ä¸ºå¸¸æ•°å³å¯\nif (isConst(word)) { Error(\"h\", word.getLineNum()); } i j k å®šä¹‰å‡½æ•°æ¥æ£€æŸ¥ï¼Œä»¥ï¼‰ä¸ºä¾‹\n//æ£€æŸ¥å³å°æ‹¬å· public void checkRightParent() { if (getNowWord().getClassCode().equals(\"RPARENT\")) { getWordMove(); } else { Error(\"j\", curTokenWord.getLineNum()); } } l åˆ†æStmté‡åˆ°PRINTFTKæ—¶ï¼Œåˆ¤æ–­ä¸€ä¸‹printfé‡Œé¢é€—å·çš„æ•°é‡å’ŒSTRCONä¸­çš„è¦æ±‚è¾“å‡ºæ•°æ˜¯å¦ä¸€è‡´å³å¯\nm å¦‚æœä»£ç å—åœ¨Whileå¾ªç¯ä¸­ï¼Œåˆ™æœ‰ä¸€ä¸ªå…¨å±€å˜é‡WhileFlagè¡¨ç¤º,å…¶å€¼ä¸ä¸º0ã€‚åœ¨é‡åˆ°breakæˆ–æ˜¯continueçš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹å³å¯\nå…­. ç”Ÿæˆä»£ç è®¾è®¡ åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘é€‰æ‹©ç”Ÿæˆpcodeä»£ç ã€‚æˆ‘è®¾è®¡äº†ä¸€ç§åŸºäºé€†æ³¢å…°è¡¨è¾¾å¼å †æ ˆå’Œç¬¦å·è¡¨çš„è™šæ‹ŸPcodeä»£ç ,åœ¨è¿›è¡Œè¯­æ³•åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œéšä¹‹ç”ŸæˆPcodeä»£ç ã€‚ åŒæ—¶ï¼Œæˆ‘è®¾è®¡äº†æ‰§è¡Œå®ƒä»¬çš„è™šæ‹Ÿæœºã€‚Pcodeè™šæ‹Ÿæœºæ˜¯ç”¨äºè¿è¡ŒPcodeå‘½ä»¤çš„è™šæ„æœºå™¨ã€‚ å®ƒç”±ä¸€ä¸ªä»£ç åŒº(pcodes)ã€ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆ(EIP)ã€ä¸€ä¸ªmainå‡½æ•°æŒ‡é’ˆ(mainAddressï¼‰ã€ä¸€ä¸ªå †æ ˆï¼ˆå­˜æ”¾å„ç§æ•°å€¼ï¼‰ã€å­˜æ”¾è¿”å›ä¿¡æ¯çš„æ•°ç»„ã€ä¸€ä¸ªå˜é‡è¡¨var_table,ä¸€ä¸ªå‡½æ•°è¡¨func_tableå’Œä¸€ä¸ªæ ‡ç­¾è¡¨label_tableç»„æˆã€‚\nåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†é¦–å…ˆä»‹ç»å¦‚ä½•ç”Ÿæˆpcodeï¼Œç„¶åä»‹ç»pcodeå¦‚ä½•æ‰§è¡Œã€‚\nç¼–ç å‰è®¾è®¡ å¦‚ä½•ç”ŸæˆPcode æ–°å¢çš„ç±» åœ¨PcodeGenerationåŒ…ä¸­ï¼Œæˆ‘æ–°å¢äº†\nFunctionç±»â€”â€”â€”â€”è®°å½•å‡½æ•°å£°æ˜åœ¨Pcodesä»£ç ä¸­çš„ä½ç½®ä»¥åŠå…¶å‚æ•°æ•°é‡\npublic Function(int index, int argsNum) { this.StackOffset = index; this.ParamsNum = argsNum; } LabelCreatorç±»â€”â€”â€”â€”ç”¨äºäº§ç”Ÿæ ‡ç­¾\nVarietyç±»â€”â€”â€”â€”è®°å½•å˜é‡åœ¨æ ˆä¸Šçš„ä½ç½®ï¼Œç»´åº¦æ•°ï¼Œå„ç»´æ•°çš„æ•°é‡\nRetInfoç±»â€”â€”â€”â€”è®°å½•å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆè°ƒç”¨å‡½æ•°æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„EIPï¼‰ï¼Œè°ƒç”¨å‡½æ•°å‰æ ˆä¸Šçš„æœ«å°¾ä½ç½®ï¼ˆstack.size() - 1ï¼‰ï¼Œè™šæ‹Ÿæœºä¸­å½“å‰çš„å˜é‡è¡¨ï¼ˆvar_tableï¼‰ï¼Œå‡½æ•°çš„å‚æ•°æ•°é‡ï¼Œå‡½æ•°æ‰€éœ€è°ƒç”¨çš„å‚æ•°æ•°é‡ï¼Œç›®å‰å·²æœ‰çš„å‚æ•°æ•°é‡\npublic RetInfo(int eip, int stackPtr, HashMap\u003cString, Variety\u003e varTable, int paramsNum, int callArgsNum, int nowArgsNum) { this.eip = eip; this.stackPtr = stackPtr; this.varTable = varTable; this.paramsNum = paramsNum; this.callParamsNum = callArgsNum; this.nowParamsNum = nowArgsNum; } Pcodeç±»â€”â€”â€”â€”è®°å½•ä¸€ä¸ªPcodeæŒ‡ä»¤çš„åç§°key,FirstValue,LastValue(å¦‚æœ‰)ï¼ŒåŒæ—¶è§„å®šäº†Pcodeçš„è§„èŒƒåŒ–è¾“å‡ºï¼ˆlabel,func,call,printè¿›è¡Œç‰¹æ®Šè€ƒè™‘)\n@Override public String toString() { String first = \"\"; String second = \"\"; if (key.equals(PcodeKey.label)) { return FirstValue.toString() + \": \"; } if (key.equals(PcodeKey.func)) { return \"FUNC @\" + FirstValue.toString() + \":\"; } if (key.equals(PcodeKey.call)) { return \"$\" + FirstValue.toString(); } if (key.equals(PcodeKey.print)) { return key + \" \" + FirstValue; } if (FirstValue == null) { first = \"\"; } else { first = FirstValue.toString(); } if (SecondValue == null) { second = \"\"; } else { second = \", \" + SecondValue.toString(); } return key + \" \" + first + second; } PcodeKeyæšä¸¾ç±»ï¼Œå­˜æ”¾Pcodeçš„åŸºæœ¬æŒ‡ä»¤åç§°,åé¢ä¼šè¯¦ç»†ä»‹ç»\nå˜é‡å£°æ˜ å¦‚ä½•åŒºåˆ†ä¸åŒçš„å˜é‡ æ ¹æ®å”¯ä¸€çš„ä½œç”¨åŸŸå·åŒºåˆ†ä¸åŒä½œç”¨åŸŸçš„å˜é‡ï¼Œå¦‚ï¼šCurLayerId + \"_\" + Ident.getToken()ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤äº†é€’å½’å‡½æ•°è°ƒç”¨ä»¥å¤–ï¼Œä»£ç ä¸­ä¸ä¼šå¤šæ¬¡é‡å¤å‡ºç°è¯¥å˜é‡ï¼Œå¯ä»¥é€šè¿‡å°†varTableåˆ°å †æ ˆæ¥è§£å†³ã€‚\nä¸åŒºåˆ†constå’Œvarã€‚\néæ•°ç»„å˜é‡ï¼šæ–°å»ºä¸€ä¸ªå˜é‡varå¹¶è®©å®ƒæŒ‡å‘å †æ ˆé¡¶éƒ¨ã€‚å¦‚æœå®ƒæœ‰åˆå§‹åŒ–ï¼Œpushåˆå§‹åŒ–çš„å€¼è¿›å…¥å †æ ˆï¼ˆå¦‚æœint x=qè¿™ç§åˆå§‹åŒ–ï¼Œé‚£ä¹ˆéœ€è¦push qï¼Œç„¶åå†getvalueï¼‰ã€‚å¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªdefaultvalueå‘½ä»¤æ¥å°†å˜é‡çš„é»˜è®¤åˆå§‹å€¼(æˆ‘å°†å…¶æ¨å…¥0)æ¨é€åˆ°å †æ ˆã€‚ æ•°ç»„å˜é‡ï¼šæ–°å»ºä¸€ä¸ªå˜é‡varå¹¶è®©å®ƒæŒ‡å‘å †æ ˆé¡¶éƒ¨ã€‚ç„¶åpushå…¶å„ç»´çš„ç»´æ•°ï¼Œç„¶åç”¨dimarrayvarå‘½ä»¤è¡¨ç¤ºä»–æ˜¯æ•°ç»„,å¦‚æœå®ƒæœ‰åˆå§‹åŒ–ï¼Œä¾æ¬¡pushåˆå§‹åŒ–çš„å€¼è¿›å…¥å †æ ˆã€‚å¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªdefaultvalueå‘½ä»¤æ¥å°†å˜é‡çš„é»˜è®¤åˆå§‹å€¼(æˆ‘å°†å…¶æ¨å…¥0)æ¨é€åˆ°å †æ ˆã€‚ å¦‚æœæ˜¯getintï¼Œé‚£ä¹ˆåŠ å…¥getint egï¼šint x[1][3];\nvar 1_x push 1 push 3 dimarrayvar 1_x, 2 defaultvalue 1_x, 2 èµ‹å€¼è¯­å¥ é¦–å…ˆpushå¾…èµ‹å€¼çš„å˜é‡ï¼ˆè‹¥æ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦pushåç§»é‡ï¼‰ï¼Œç„¶ååˆ©ç”¨getaddressè®¡ç®—å¹¶å°†å˜é‡çš„åœ°å€æ¨é€åˆ°å †æ ˆé¡¶éƒ¨ã€‚ç„¶ååˆ†æèµ‹å€¼è¯­å¥å³ä¾§çš„è¡¨è¾¾å¼ï¼Œå¯¹äºæ•°å€¼ï¼Œç›´æ¥push,å¯¹äºè¡¨è¾¾å¼ï¼Œåˆ©ç”¨getvalueè·å–è¡¨è¾¾å¼çš„å€¼ã€‚ï¼ˆè‹¥æ˜¯ç®—æœ¯è¿ç®—è¡¨è¾¾å¼ï¼Œå°±å…ˆæ‰§è¡Œï¼‰åœ¨æ­¤ä¹‹åï¼Œå †æ ˆä¸­æœ‰ä¸¤ä¸ªæ•°å­—ï¼Œå³åœ°å€å’Œå€¼ã€‚åˆ©ç”¨popå°†è¯¥å€¼åˆ†é…ç»™è¯¥åœ°å€ã€‚\nå˜é‡å–å€¼ ä¾‹å¦‚è¦å–å¾—x[0][2]çš„å€¼\npush 2_x push 0 push 2 getvalue 2_x, 0 å‡½æ•°å®šä¹‰ ç›´æ¥Pcodes.add(new Pcode(PcodeKey.func, curTokenWord.getToken()));ï¼ˆmainfuncç‰¹æ®Šå®šä¹‰ï¼‰\nå‡½æ•°å½¢å‚ fparam+åå­—+ç»´æ•°\næ³¨æ„ï¼šè‹¥æ˜¯æ•°ç»„ï¼Œéœ€è¦å…ˆpushè¿›å»å„ç»´æ•°é‡ï¼ˆäºŒç»´å½¢å‚ï¼Œåªéœ€è¦pushç¬¬äºŒç»´æ•°é‡ï¼‰\nå‡½æ•°è°ƒç”¨ å®å‚ç±»å‹\næ•°å€¼ï¼šå…ˆpushå‡½æ•°å®å‚ï¼Œå†rparam+å‡½æ•°å®å‚åå­—+ç»´æ•°,å†callç›¸åº”å‡½æ•°å\nå˜é‡ï¼šå…ˆpushå˜é‡å\nè‹¥æ˜¯æ•°ç»„ï¼Œå°±getaddressåŠ ç»´æ•°\nè‹¥æ˜¯æ™®é€šå˜é‡ï¼Œå°±getvalue+ç»´æ•°ï¼›è‹¥æ˜¯a[1][3]è¿™ç§ï¼Œå°±å…ˆpushè¿›å»1,3ï¼Œå†getvalue\nå‰©ä¸‹çš„æ“ä½œåŒä¸Š\nå‡½æ•°è¿”å› ret 0ä»£è¡¨æ— è¿”å›å€¼\nret 1ä»£è¡¨æœ‰è¿”å›å€¼ï¼Œåœ¨retä¹‹å‰ä¼šæœ‰pushï¼ˆç”±åˆ†æè¡¨è¾¾å¼äº§ç”Ÿï¼‰ä¹‹ç±»çš„ï¼Œä»£è¡¨è¿”å›æŒ‡çš„å…·ä½“æ•°å€¼\næ‰“å°è¯­å¥ Pcodes.add(new Pcode(PcodeKey.print, STRCON.getToken(), OutputNum)); æ³¨æ„ï¼šæ‰“å°å˜é‡ï¼Œåˆ™æŒ‰ç…§è€å¥—è·¯ï¼Œå…ˆpushå˜é‡ï¼Œå†getvalueä¾‹å¦‚printf(\"%d\",x);ï¼Œåˆ™æ˜¯push 2_x , getvalue 2_x, 0 print \"%d\"\næ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥ é¦–å…ˆï¼Œæˆ‘å®šä¹‰äº†ä¸‰ä¸ªArrayList,åˆ†åˆ«å­˜æ”¾ç€å¯¹åº”æ ‡ç­¾çš„HashMap\nprivate ArrayList\u003cHashMap\u003cString, String\u003e\u003e If_Labels = new ArrayList\u003c\u003e(); private ArrayList\u003cHashMap\u003cString, String\u003e\u003e While_Labels = new ArrayList\u003c\u003e(); private ArrayList\u003cHashMap\u003cInteger, String\u003e\u003e Cond_Labels = new ArrayList\u003c\u003e(); æ¯å½“é‡åˆ°IFTKæˆ–å…¶ä»–åˆ¤æ–­è¯­å¥æ—¶ï¼Œç”Ÿæˆç›¸åº”æ ‡ç­¾\npublic void getNewIfLabel() { HashMap\u003cString, String\u003e tmpIfLabel = new HashMap\u003c\u003e(); tmpIfLabel.put(\"if\", LabelCreator.CreateLabel(\"if\")); tmpIfLabel.put(\"else\", LabelCreator.CreateLabel(\"else\")); tmpIfLabel.put(\"endif\", LabelCreator.CreateLabel(\"endif\")); tmpIfLabel.put(\"ifblock\", LabelCreator.CreateLabel(\"ifblock\")); If_Labels.add(tmpIfLabel); } ä»¥ifä¸ºä¾‹å­\nif (word.ClassCodeOf(\"IFTK\")) { getNewIfLabel(); Pcodes.add(new Pcode(PcodeKey.label, If_Labels.get(If_Labels.size() - 1).get(\"if\"))); getWordMove();//if getWordMove();//( analyseCond(\"if\"); checkRightParent(); Pcodes.add(new Pcode(PcodeKey.jz, If_Labels.get(If_Labels.size() - 1).get(\"else\"))); Pcodes.add(new Pcode(PcodeKey.label, If_Labels.get(If_Labels.size() - 1).get(\"ifblock\"))); analyseStmt(); word = getNowWord(); Pcodes.add(new Pcode(PcodeKey.jmp, If_Labels.get(If_Labels.size() - 1).get(\"endif\"))); Pcodes.add(new Pcode(PcodeKey.label, If_Labels.get(If_Labels.size() - 1).get(\"else\"))); if (word.ClassCodeOf(\"ELSETK\")) { getWordMove(); //else analyseStmt(); } Pcodes.add(new Pcode(PcodeKey.label, If_Labels.get(If_Labels.size() - 1).get(\"endif\"))); If_Labels.remove(If_Labels.size() - 1); } while\nif (word.ClassCodeOf(\"WHILETK\")) { getNewWhileLabel(); Pcodes.add(new Pcode(PcodeKey.label, While_Labels.get(While_Labels.size() - 1).get(\"while\"))); getWordMove();//while IndexWhile++; getWordMove();//( analyseCond(\"while\"); checkRightParent(); Pcodes.add(new Pcode(PcodeKey.jz, While_Labels.get(While_Labels.size() - 1).get(\"endwhile\"))); Pcodes.add(new Pcode(PcodeKey.label, While_Labels.get(While_Labels.size() - 1).get(\"whileblock\"))); analyseStmt(); IndexWhile--; Pcodes.add(new Pcode(PcodeKey.jmp, While_Labels.get(While_Labels.size() - 1).get(\"while\"))); Pcodes.add(new Pcode(PcodeKey.label, While_Labels.get(While_Labels.size() - 1).get(\"endwhile\"))); While_Labels.remove(While_Labels.size() - 1); }//break else if (word.ClassCodeOf(\"BREAKTK\")) { getWordMove();//break if (IndexWhile == 0) { Error(\"m\", curTokenWord.getLineNum()); } checkSemicn(); Pcodes.add(new Pcode(PcodeKey.jmp, While_Labels.get(While_Labels.size() - 1).get(\"endwhile\"))); }//continue else if (word.ClassCodeOf(\"CONTINUETK\")) { getWordMove();//continue if (IndexWhile == 0) { Error(\"m\", curTokenWord.getLineNum()); } checkSemicn(); Pcodes.add(new Pcode(PcodeKey.jmp, While_Labels.get(While_Labels.size() - 1).get(\"while\"))); } åŠ å‡ã€ä¹˜é™¤ï¼Œæ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼ ä»¥æ¯”è¾ƒä¸ºä¾‹\npublic void analyseRelExp(ArrayList\u003cTokenWord\u003e exp) { Expressions exps = divideExp(exp, new ArrayList\u003c\u003e(Arrays.asList(\"LSS\", \"LEQ\", \"GRE\", \"GEQ\"))); int j = 0; for (ArrayList\u003cTokenWord\u003e tmpExp : exps.getExpressions()) { analyseAddExp(tmpExp); if (j \u003e 0 \u0026\u0026 j \u003c= exps.getExpressions().size()) { if (exps.getSymbols().get(j - 1).ClassCodeOf(\"LSS\")) { Pcodes.add(new Pcode(PcodeKey.cmplt)); } else if (exps.getSymbols().get(j - 1).ClassCodeOf(\"LEQ\")) { Pcodes.add(new Pcode(PcodeKey.cmple)); } else if (exps.getSymbols().get(j - 1).ClassCodeOf(\"GRE\")) { Pcodes.add(new Pcode(PcodeKey.cmpgt)); } else if (exps.getSymbols().get(j - 1).ClassCodeOf(\"GEQ\")) { Pcodes.add(new Pcode(PcodeKey.cmpge)); } } GrammarString.add(\"\"); if (j \u003c exps.getSymbols().size()) { GrammarString.add(exps.getSymbols().get(j++).toString()); } } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºé‡‡ç”¨é€†æ³¢å…°è¡¨è¾¾å¼ï¼Œå½“åˆ†æåˆ°ç¬¬äºŒä¸ªè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå…¶å®jå·²ç»è·³åˆ°ç¬¬äºŒä¸ªè¡¨è¾¾å¼åé¢äº†ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­çš„æ˜¯j-1ä½ç½®å¤„\nå¦‚ä½•è¿è¡ŒPcode Pcodeè™šæ‹Ÿæœºæ˜¯ç”¨äºè¿è¡ŒPcodeå‘½ä»¤çš„è™šæ„æœºå™¨ã€‚ å®ƒç”±ä¸€ä¸ªä»£ç åŒº(pcodes)ã€ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆ(EIP)ã€ä¸€ä¸ªmainå‡½æ•°æŒ‡é’ˆ(mainAddressï¼‰ã€ä¸€ä¸ªå †æ ˆï¼ˆå­˜æ”¾å„ç§æ•°å€¼ï¼‰ã€å­˜æ”¾è¿”å›ä¿¡æ¯çš„æ•°ç»„ã€ä¸€ä¸ªå˜é‡è¡¨var_table,ä¸€ä¸ªå‡½æ•°è¡¨func_tableå’Œä¸€ä¸ªæ ‡ç­¾è¡¨label_tableç»„æˆã€‚\næˆ‘å®šä¹‰äº†ä¸€ä¸ªPcodeExecutorç±»ï¼Œå¯¹åº”ç€æˆ‘çš„Pcodeè™šæ‹Ÿæœº\nprivate int eip = 0; //mainAddressæ ‡è®°mainå‡½æ•°çš„åœ°å€ private int mainAddress; private Scanner scanner; private ArrayList\u003cPcode\u003e pcodes; private ArrayList\u003cRetInfo\u003e retInfos = new ArrayList\u003c\u003e(); //æ¨¡æ‹Ÿå­˜æ”¾å„ç§æ•°å€¼çš„æ ˆ private ArrayList\u003cInteger\u003e stack = new ArrayList\u003c\u003e(); private HashMap\u003cString, Variety\u003e varTable = new HashMap\u003c\u003e(); private HashMap\u003cString, Function\u003e funcTable = new HashMap\u003c\u003e(); //labelå¯¹åº”çš„ä»£ç è¡Œæ•°(eip) private HashMap\u003cString, Integer\u003e labelTable = new HashMap\u003c\u003e(); åˆå§‹åŒ– å°†scannerå’Œpcodeä»£ç åˆå§‹åŒ–ï¼ŒåŒæ—¶æ‰«æPcodeä»£ç ,å°†æ‰«æåˆ°çš„æ ‡ç­¾(åç§°ï¼Œä½ç½®ï¼‰åŠ å…¥æ ‡ç­¾è¡¨ï¼Œå‡½æ•°ï¼ˆåç§°ï¼Œfunctionï¼‰åŠ å…¥å‡½æ•°è¡¨ï¼Œ\npublic PcodeExecutor(ArrayList\u003cPcode\u003e pcodes, Scanner sc) { this.pcodes = pcodes; this.scanner = sc; int index = 0; while (index \u003c pcodes.size()) { Pcode pcode = pcodes.get(index); switch (pcode.getKey()) { case label: labelTable.put(pcode.getFirstValue().toString(), index); break; case func: funcTable.put(pcode.getFirstValue().toString(), new Function(index, (int) pcode.getSecondValue())); break; case mainfunc: mainAddress = index; break; } index++; } } åŸºæœ¬æ“ä½œ è·å–å˜é‡ å¦‚æœå½“å‰å˜é‡è¡¨ä¸­å­˜åœ¨è¯¥å˜é‡ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™åœ¨å…¨å±€å˜é‡ä¸­å¯»æ‰¾\nprivate Variety getVar(String varName) { if (varTable.containsKey(varName)) { return varTable.get(varName); } else { //å…¨å±€å˜é‡ return retInfos.get(0).getVarTable().get(varName); } } pushã€pop private void push(int value) { stack.add(value); } //å¼¹å‡ºå¹¶è¿”å› private int pop() { int value = stack.get(stack.size() - 1); stack.remove(stack.size() - 1); return value; } è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€ æ³¨æ„è¿™é‡Œçš„ç»´æ•°æ˜¯ç›¸å¯¹çš„ for example, to int a[3][2] ,a[0][0] is 0, a[0] is 1, a is 2 a[3][2],SecondDim:2;FirstDim:3\nprivate int getAddress(Variety var, int Dimension) { int Address = 0; int n = var.getDimension() - Dimension; if (n == 0) { Address = var.getOffset(); } if (n == 1) { int i = pop(); if (var.getDimension() == 1) { Address = var.getOffset() + i; } else { Address = var.getOffset() + i * var.getSecondDimNum(); } } if (n == 2) { int i = pop(); int j = pop(); Address = var.getOffset() + j * var.getSecondDimNum() + i; } return Address; } è¿è¡Œä»£ç  é¦–å…ˆå®šä¹‰å‡ ä¸ªå˜é‡\n//å·²ç»å­˜åœ¨çš„å‚æ•°æ•°é‡ int ExistParamsNum = 0; //è°ƒç”¨æ‰€éœ€çš„å‚æ•°æ•°é‡ int CallParamsNum = 0; boolean MainFuncFlag = false; //å‡½æ•°å®å‚å¯¹åº”çš„æ ˆä¸Šçš„åœ°å€åˆ—è¡¨ ArrayList\u003cInteger\u003e rparams = new ArrayList\u003c\u003e(); var äº§ç”Ÿæ–°çš„å˜é‡ï¼Œç½®äºstackæœ«å°¾ï¼Œæ”¾è¿›å˜é‡è¡¨\ncase var: { Variety var = new Variety(stack.size()); varTable.put((String) pcode.getFirstValue(), var); } push //å¯¹äºæ•°å­—çš„è¯ï¼Œpushè¿›æ ˆé‡Œ case push: { if (pcode.getFirstValue() instanceof Integer) { push((int) pcode.getFirstValue()); } } pop popæ“ä½œ:*value1 = value2 åœ¨æˆ‘çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä¼šåœ¨å˜é‡èµ‹å€¼ä»¥å‰ä¾æ¬¡å°†å…¶åœ¨æ ˆä¸­å¯¹åº”çš„åœ°å€ä»¥åŠæ‰€èµ‹çš„å€¼å‹è¿›æ ˆä¸­\ncase pop: { int value = pop(); int address = pop(); stack.set(address, value); } è®¡ç®— Calculation Type\nTwo operators:\nint b = pop(); int a = pop(); push(cal(a,b)); Single operator:\npush(cal(pop())); æ•°ç»„ç»´æ•° å£°æ˜å˜é‡ç»´æ•°,ç´§è·Ÿç€çš„æ˜¯ç»´æ•°\ncase dimarrayvar: { Variety var = getVar((String) pcode.getFirstValue()); int dimension = (int) pcode.getSecondValue(); var.setDimension(dimension); if (dimension == 2) { var.setSecondDimNum(pop()); var.setFirstDimNum(pop()); } if (dimension == 1) { var.setFirstDimNum(pop()); } } å ä½ç¬¦ case defaultvalue: { Variety var = getVar((String) pcode.getFirstValue()); int dimension = (int) pcode.getSecondValue(); if (dimension == 0) { push(0); } if (dimension == 1) { for (int i = 0; i \u003c var.getFirstDimNum(); i++) { push(0); } } if (dimension == 2) { for (int i = 0; i \u003c var.getFirstDimNum() * var.getSecondDimNum(); i++) { push(0); } } } getint è¯»å–int\ncase getint: { int value = scanner.nextInt(); push(value); } è·³è½¬ å¦‚æœæ˜¯æ¡ä»¶è·³è½¬ï¼Œå–å‡ºstackä¸­æœ€åä¸€ä¸ªå€¼åˆ¤æ–­\nå‡½æ•°å®šä¹‰ mainå‡½æ•°\ncase mainfunc: { MainFuncFlag = true; //retInfos[0] storage å…¨å±€å˜é‡(varTable) retInfos.add(new RetInfo(pcodes.size(), stack.size() - 1, varTable, 0, 0, 0)); varTable = new HashMap\u003c\u003e(); } è‡ªå®šä¹‰å‡½æ•°\né‡è§funcå®šä¹‰çš„è¯ï¼Œå‡å…ˆè¿›å…¥åˆ°mainå‡½æ•°ä¸­ï¼Œç­‰åˆ°è°ƒç”¨çš„æ—¶å€™å†è·³è½¬\ncase func: { int flag = MainFuncFlag ? 1 : 0; if (flag == 0) { eip = mainAddress - 1; } } å‡½æ•°è°ƒç”¨ æ€»ä½“ä¸Šæ¥è¯´ï¼Œå°±æ˜¯é‡åˆ°å‡½æ•°è°ƒç”¨-\u003eå­˜å®å‚æ•°ï¼ˆå€¼/åœ°å€ï¼‰-\u003eå­˜ä¸‹retInfoï¼Œäº§ç”Ÿæ–°å˜é‡è¡¨ï¼ˆç”¨äºå‡½æ•°ï¼‰ï¼Œè·³è½¬åˆ°å®šä¹‰å¤„-\u003eé‡åˆ°å½¢å‚ï¼Œä¾æ¬¡å­˜å…¥æ–°å˜é‡è¡¨-\u003eé‡åˆ°retï¼Œè¿›è¡Œè¿”å›ï¼Œå°†åŸretinfoè¿˜åŸ\nFirst, before function call, there will be some parameters to be pushed into the stack. Each will be followed by a rparam command, which memorize the address of the previous variety.\næ³¨æ„ï¼šå¯¹äºä¼ å€¼å®å‚ï¼Œè‹¥æ˜¯æ•°ç»„å…·ä½“åˆ°æŸä¸ªæ•°ï¼ˆæœ¬è´¨æ˜¯ä¼ å…·ä½“å€¼ï¼‰ï¼Œå¯¹åº”æ“ä½œå…ˆpushå„ç»´åº¦ï¼Œå†getvalueï¼Œè‹¥æ˜¯å…·ä½“æ•°å€¼ï¼Œå°±æ˜¯pushæ•°å€¼ï¼Œå› æ­¤ç›´æ¥rparams.add(stack.size() - 1)ã€‚å¯¹äºä¼ åœ°å€å‚æ•°ï¼Œåˆ™æ˜¯å…ˆpushæ•°ç»„åï¼Œå†getaddressï¼Œå› æ­¤éœ€è¦å°†å…¶åœ°å€å‹å…¥\ncase rparam: { int dimension = (int) pcode.getSecondValue(); if (dimension == 0) { //å¯¹äºéæ•°ç»„çš„å‚æ•°ï¼Œç›´æ¥å°†å…¶å€¼å‹å…¥æ ˆä¸­ //å› æ­¤å…¶åœ°å€æ˜¯æ ˆé¡¶çš„åœ°å€ rparams.add(stack.size() - 1); } else { //å¯¹äºæ•°ç»„çš„å‚æ•°ï¼Œå°†å…¶åœ°å€å‹å…¥æ ˆä¸­ rparams.add(stack.get(stack.size() - 1)); } } Second, function CALL.\nMemorize the eip, stack top address, and information about the function(In fact, they will be pushed into stack too). Then update the varTable and eip. Ready for execute function.\ncase call: { Function func = funcTable.get((String) pcode.getFirstValue()); retInfos.add(new RetInfo(eip, stack.size() - 1, varTable, func.getParamsNum(), func.getParamsNum(), ExistParamsNum)); //è·³è½¬è‡³å‡½æ•°å®šä¹‰å¤„ eip = func.getOffset(); varTable = new HashMap\u003c\u003e(); CallParamsNum = func.getParamsNum(); ExistParamsNum = 0; } Finally, return when itâ€™s RET\nRestore eip, varTable from RetInfo, clear the new information pushed when function in the stack.\ncase ret: { int type = (int) pcode.getFirstValue(); RetInfo retInfo = retInfos.remove(retInfos.size() - 1); eip = retInfo.getEip(); varTable = retInfo.getVarTable(); CallParamsNum = retInfo.getCallParamsNum(); ExistParamsNum = retInfo.getNowParamsNum(); if (type == 1) { //æœ‰è¿”å›å€¼çš„è¯ï¼Œç”±äºä¹‹å‰å°†è¿”å›å€¼å‹å…¥æ ˆä¸­ï¼Œæ•…éœ€è¦ä¿ç•™æ ˆé¡¶å…ƒç´  stack.subList(retInfo.getStackPtr() + 1 - retInfo.getParamsNum(), stack.size() - 1).clear(); } else { stack.subList(retInfo.getStackPtr() + 1 - retInfo.getParamsNum(), stack.size()).clear(); } } Additionalï¼š\nå‚¨å­˜å®Œå®å‚ï¼Œè°ƒç”¨å‡½æ•°ä»¥åè·³è½¬åˆ°å‡½æ•°å®šä¹‰çš„åœ°æ–¹\nfparam:Firstvalue:Ident_name Secondvalue:Type/Dimension\ncase fparam: { //å‡½æ•°ç°åœ¨éœ€è¦çš„å½¢å‚çš„index int nowfparamIndex = rparams.size() - CallParamsNum + ExistParamsNum; int addressOnStack = rparams.get(nowfparamIndex); Variety fparam = new Variety(addressOnStack); int dimension = (int) pcode.getSecondValue(); fparam.setDimension(dimension); //äºŒç»´æ•°ç»„éœ€è¦å°†ç¬¬äºŒç»´å¤§å°ä½œä¸ºå‚æ•°ä¼ å…¥ if (dimension == 2) { fparam.setSecondDimNum(pop()); } varTable.put((String) pcode.getFirstValue(), fparam); ExistParamsNum++; //å¦‚æœå½¢å‚å·²ç»å…¨éƒ¨ç”Ÿæˆï¼Œå°±æ¸…ç©ºrparamsæ•°ç»„é‡Œå¯¹åº”çš„å…¶å½¢å‚ if (ExistParamsNum == CallParamsNum) { rparams.subList(rparams.size() - CallParamsNum, rparams.size()).clear(); } } break; æ‰“å°è¾“å‡º print:Firstvalue:String Secondvalue:output num quantity\ncase print: { String str = (String) pcode.getFirstValue(); int num = (int) pcode.getSecondValue(); int q = num - 1; StringBuilder sb = new StringBuilder(); ArrayList\u003cInteger\u003e OutParams = new ArrayList\u003c\u003e(); for (int i = 0; i \u003c num; i++) { OutParams.add(pop()); } for (int j = 0; j \u003c str.length(); j++) { if (j \u003c str.length() - 1) { if (str.charAt(j) == '%' \u0026\u0026 str.charAt(j + 1) == 'd') { sb.append(OutParams.get(q--).toString()); j++; continue; } } sb.append(str.charAt(j)); } //é™¤å»å¼•å· OutputString.add(sb.substring(1, sb.length() - 1)); } break; è·å–å˜é‡çš„å€¼ï¼Œåœ°å€ Firstvalue:Ident_name Secondvalue:Dimension\ncase getvalue: { Variety var = getVar((String) pcode.getFirstValue()); int dimension = (int) pcode.getSecondValue(); int address = getAddress(var, dimension); push(stack.get(address)); } break; //è·å¾—å˜é‡åœ¨æ ˆä¸Šçš„åœ°å€ï¼Œç»™å®šå˜é‡åå’Œç»´åº¦ case getaddress: { Variety var = getVar((String) pcode.getFirstValue()); int dimension = (int) pcode.getSecondValue(); int address = getAddress(var, dimension); push(address); } break; ç¼–ç åè®¾è®¡ å°ç»†èŠ‚é—®é¢˜ åœ¨GrammarAnalysisä¸­ï¼Œæ–°å¢CurLayerIdå˜é‡ï¼Œæ³¨æ„å’ŒlayeråŒºåˆ†\nå‰è€…ä¸ºäº†åŒºåˆ†ç¬¦å·è¡¨å†…å˜é‡æ‰€å¤„å±‚çº§ï¼Œå› æ­¤ä¸è€ƒè™‘å‡ºåŒºå—å‡ä¸€ï¼Œè€Œåè€…ç”¨æ¥æ„é€ ç¬¦å·è¡¨çš„HashMapï¼Œæœ‰å¹¶åˆ—å…³ç³»ï¼Œæ‰€ä»¥å‡ºäº†åŒºå—å°±è¦å‡ä¸€\nä¸¤è€…æ¯æ¬¡æ–°è¿›å…¥ä¸€ä¸ªåŒºå—ä¹‹åï¼Œéƒ½ä¼šåŠ ä¸€\nä½†æ˜¯é€€å‡ºä¸€ä¸ªåŒºå—çš„æ—¶å€™ï¼Œå‰è€…ä¸ä¼šå‡ä¸€ï¼Œè€Œåè€…ä¾æ—§å‡ä¸€\npublic void addSymbol(TokenWord tokenWord, String type, int Dimension, int CurLayerId) { SymbolTables.get(layer).SymbolInsert(type, Dimension, tokenWord, CurLayerId); } Pcodeä»£ç å¯¹åº”è¡¨ Common Type CodeType Value1 Value2 Operation label label_name set a label var ident_name declare a variety push ident_name/digit push(value1) pop ident_name åœ¨popå‘½ä»¤ä»¥å‰pushè¿›æ¥çš„èµ‹å€¼è¯­å¥å³é¢çš„å¼å­çš„å€¼ *value1 = value2ï¼ˆè¿™ä¸ªvalue2æŒ‡çš„æ˜¯åœ¨popå‘½ä»¤ä»¥å‰pushè¿›æ¥çš„èµ‹å€¼è¯­å¥å³é¢çš„å¼å­çš„å€¼ï¼‰ jz label_name jump if stack top is zero jnz label_name jump if stack top is not zero jmp label_name jump unconditionally main main function label func function label endfunc end of function label fparam ident_name dimension/type å‡½æ•°å½¢å‚parameters ret return value or notï¼ˆ0ï¼švoidï¼›1ï¼šintï¼‰ function returnï¼ˆret 0æ— è¿”å›å€¼ï¼Œ1æœ‰è¿”å›å€¼ï¼‰ call function name function call rparam ident_name dimension å‡½æ•°å®å‚get parameters ready for function call getint get a integer and put it into stack top print string para num pop values and print. dimarrayvar ident_name type/dimension set dimension info for array variety getvalue ident_name type/dimension å¯¹äºæ™®é€šå˜é‡ï¼Œget the variety value getaddress ident_name type/dimension å¯¹äºæ•°ç»„ï¼Œget the variety address defaultvalue ident_name type/dimension push something to hold places exit exit è¿ç®—æ¯”è¾ƒ CodeType Value1 Value2 Operation add + sub - mul * div / mod % cmpeq == cmpne != cmpgt \u003e cmplt \u003c cmpge \u003e= cmple \u003c= and \u0026\u0026 or || not ! neg - pos + çŸ­è·¯æ±‚å€¼é—®é¢˜ There are two situations I need to use short circuit calculation :\n1. if(a\u0026\u0026b) // a is false 2. if(a||b) // a is true My method is as follows:\nFirst, when I analyze analyseLOrExp, every analyseLAndExp will be followed by a JNZ, which is used for detect if the cond is true. If it is, jump to the if body label. At the same time, I generated cond label, which is ready for the analyseLAndExp.\nprivate void analyseLOrExp(ArrayList\u003cWord\u003e exp, String from) { ... for (...) { ... String label = labelGenerator.getLabel(\"cond_\" + i); analyseLAndExp(exp1, from, label); codes.add(new PCode(CodeType.LABEL, label)); if (...) { codes.add(new PCode(CodeType.OR)); } if (...) { if (...) { codes.add(new PCode(CodeType.JNZ, ifLabels.get(ifLabels.size() - 1).get(\"if_block\"))); } ... } ... } } In the analyseLAndExp, every analyseEqExp will be followed by a JZ, which is used for detect if the cond is true. If it is not, jump to the cond label I set just now.\nprivate void analyseLAndExp(ArrayList\u003cWord\u003e exp, String from, String label) { ... for (...) { ... analyseEqExp(exp1); if (...) { codes.add(new PCode(CodeType.AND)); } if (...) { if (...) { codes.add(new PCode(CodeType.JZ, label)); } ... } } } By these means, short circuit calculation is solved.\nä¸ƒ. ä»£ç ç¤ºä¾‹ int y=3; int b[1][3]={{1,2,3}}; int func(int x[][3]) { return x[0][2]+y; } int func2(int a) { int s=a+b; return a; } int main(){ int q=3; int x=q; int z; int y=func(b); z=func2(3); printf(\"%d\",3); return 0; } var 0_y push 3 var 0_b push 1 push 3 dimarrayvar 0_b, 2 push 1 push 2 push 3 FUNC @func: push 3 fparam 1_x, 2 push 1_x push 0 push 2 getvalue 1_x, 0 push 0_y getvalue 0_y, 0 add ret 1 endfunc FUNC @func2: fparam 2_a, 0 var 2_s push 2_a getvalue 2_a, 0 push 0_b getaddress 0_b, 2 add push 2_a getvalue 2_a, 0 ret 1 endfunc mainfunc main var 3_q push 3 var 3_x push 3_q getvalue 3_q, 0 var 3_z defaultvalue 3_z, 0 var 3_y push 0_b getaddress 0_b, 2 rparam b, 2 $func push 3_z getaddress 3_z, 0 push 3 rparam 3, 0 $func2 pop 3_z push 3 print \"%d\" push 0 ret 1 exit ",
  "wordCount" : "11138",
  "inLanguage": "en",
  "image":"https://mksasx.github.io/posts/tech/os/great.png","datePublished": "2022-12-30T12:31:30+08:00",
  "dateModified": "2022-12-30T12:31:30+08:00",
  "author":[{
    "@type": "Person",
    "name": "AustinMa"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://mksasx.github.io/posts/tech/compile/summary/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AustinMa's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://mksasx.github.io/img/1.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>



<script async src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>


<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://mksasx.github.io/" accesskey="h" title="AustinMa&#39;s Blog (Alt + H)">
            <img src="https://mksasx.github.io/img/Avator.jpg" alt="logo" aria-label="logo"
                 height="35">AustinMa&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://mksasx.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/archives/" title="â± æ—¶é—´è½´">
                <span>â± æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://mksasx.github.io/links" title="ğŸ¤ å‹é“¾">
                <span>ğŸ¤ å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs" style="margin-bottom: 5px;"><a href="https://mksasx.github.io/">ğŸ ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://mksasx.github.io/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="https://mksasx.github.io/posts/tech/">ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a>&nbsp;Â»&nbsp;<a href="https://mksasx.github.io/posts/tech/compile/">âš›ï¸ ç¼–è¯‘</a></div>
            <h1 class="post-title">
                ç¼–è¯‘æœŸæœ«æ€»ç»“æ–‡æ¡£
            </h1>
            <div class="post-description">
                è¿™æ˜¯æˆ‘çš„ç¼–è¯‘è¯¾ç¨‹æœŸæœ«æ€»ç»“æ–‡æ¡£
            </div>
            <div class="post-meta">åˆ›å»º:&nbsp;<span title='2022-12-30 12:31:30 +0800 CST'>2022-12-30</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2022-12-30&nbsp;|&nbsp;å­—æ•°:&nbsp;11138å­—&nbsp;|&nbsp;æ—¶é•¿:&nbsp;23åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;AustinMa



                &nbsp;|&nbsp;æ ‡ç­¾: &nbsp;
                <ul class="post-tags-meta">
                    <a href="https://mksasx.github.io/tags/compiler/">Compiler</a>
                </ul>

                
                <span id="busuanzi_container_page_pv">
                &nbsp;| è®¿é—®: <span id="busuanzi_value_page_pv"></span>
            </span>

</div>
        </header> 
<figure class="entry-cover1"><img loading="lazy" src="https://mksasx.github.io/posts/tech/os/great.png" alt="">
        
</figure>
        <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%bc%96%e8%af%91%e8%ae%be%e8%ae%a1%e6%96%87%e6%a1%a3" aria-label="ç¼–è¯‘è®¾è®¡æ–‡æ¡£">ç¼–è¯‘è®¾è®¡æ–‡æ¡£</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80-%e5%8f%82%e8%80%83%e7%bc%96%e8%af%91%e5%99%a8%e4%bb%8b%e7%bb%8d" aria-label="ä¸€. å‚è€ƒç¼–è¯‘å™¨ä»‹ç»">ä¸€. å‚è€ƒç¼–è¯‘å™¨ä»‹ç»</a></li>
                <li>
                    <a href="#%e4%ba%8c-%e7%bc%96%e8%af%91%e5%99%a8%e6%80%bb%e4%bd%93%e8%ae%be%e8%ae%a1" aria-label="äºŒ. ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡">äºŒ. ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡</a><ul>
                        
                <li>
                    <a href="#%e6%80%bb%e4%bd%93%e7%bb%93%e6%9e%84" aria-label="æ€»ä½“ç»“æ„">æ€»ä½“ç»“æ„</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e7%bb%84%e7%bb%87" aria-label="æ–‡ä»¶ç»„ç»‡">æ–‡ä»¶ç»„ç»‡</a></li>
                <li>
                    <a href="#%e7%b1%bb%e5%9b%be" aria-label="ç±»å›¾">ç±»å›¾</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89-%e8%af%8d%e6%b3%95%e5%88%86%e6%9e%90%e8%ae%be%e8%ae%a1" aria-label="ä¸‰. è¯æ³•åˆ†æè®¾è®¡">ä¸‰. è¯æ³•åˆ†æè®¾è®¡</a><ul>
                        
                <li>
                    <a href="#1-%e6%80%bb%e8%bf%b0" aria-label="1 æ€»è¿°">1 æ€»è¿°</a></li>
                <li>
                    <a href="#2-%e5%ae%9e%e7%8e%b0" aria-label="2 å®ç°">2 å®ç°</a><ul>
                        
                <li>
                    <a href="#21-%e6%96%87%e4%bb%b6%e8%af%bb%e5%86%99" aria-label="2.1 æ–‡ä»¶è¯»å†™">2.1 æ–‡ä»¶è¯»å†™</a></li>
                <li>
                    <a href="#22-%e8%af%8d%e6%b3%95%e5%88%86%e6%9e%90%e8%bf%87%e7%a8%8b" aria-label="2.2 è¯æ³•åˆ†æè¿‡ç¨‹">2.2 è¯æ³•åˆ†æè¿‡ç¨‹</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" aria-label="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</a></li>
                <li>
                    <a href="#%e5%85%b7%e4%bd%93%e5%88%86%e6%9e%90" aria-label="å…·ä½“åˆ†æ">å…·ä½“åˆ†æ</a><ul>
                        
                <li>
                    <a href="#%e9%80%90%e4%b8%aa%e5%ad%97%e7%ac%a6%e8%af%bb%e5%85%a5" aria-label="é€ä¸ªå­—ç¬¦è¯»å…¥">é€ä¸ªå­—ç¬¦è¯»å…¥</a></li>
                <li>
                    <a href="#%e8%b7%b3%e8%bf%87%e6%8d%a2%e8%a1%8c%e7%a9%ba%e6%a0%bctr" aria-label="è·³è¿‡æ¢è¡Œã€ç©ºæ ¼ã€\tã€\r">è·³è¿‡æ¢è¡Œã€ç©ºæ ¼ã€<code>\t</code>ã€<code>\r</code></a></li>
                <li>
                    <a href="#%e6%a0%87%e8%af%86%e7%ac%a6" aria-label="æ ‡è¯†ç¬¦">æ ‡è¯†ç¬¦</a></li>
                <li>
                    <a href="#intcon" aria-label="INTCON">INTCON</a></li>
                <li>
                    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</a></li>
                <li>
                    <a href="#%e5%8d%95%e4%b8%aa%e5%ad%97%e7%ac%a6%e6%88%96%e8%80%85%e5%bf%85%e9%a1%bb%e4%b8%a4%e4%b8%aa%e5%ad%97%e7%ac%a6%e7%9a%84tokenword" aria-label="å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„TokenWord">å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„<code>TokenWord</code></a></li>
                <li>
                    <a href="#%e5%8f%af%e8%83%bd%e6%98%af%e5%8d%95%e4%b8%aa%e4%b9%9f%e5%8f%af%e8%83%bd%e4%b8%a4%e4%b8%aa%e5%ad%97%e7%ac%a6%e7%9a%84tokenword" aria-label="å¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„TokenWord">å¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„<code>TokenWord</code></a></li>
                <li>
                    <a href="#%e6%b3%a8%e9%87%8a" aria-label="æ³¨é‡Š">æ³¨é‡Š</a></li></ul>
                </li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%9b%9b-%e8%af%ad%e6%b3%95%e5%88%86%e6%9e%90%e8%ae%be%e8%ae%a1" aria-label="å››. è¯­æ³•åˆ†æè®¾è®¡">å››. è¯­æ³•åˆ†æè®¾è®¡</a><ul>
                        
                <li>
                    <a href="#1-%e6%80%bb%e8%bf%b0-1" aria-label="1 æ€»è¿°">1 æ€»è¿°</a></li>
                <li>
                    <a href="#2-%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0" aria-label="2 å…·ä½“å®ç°">2 å…·ä½“å®ç°</a><ul>
                        
                <li>
                    <a href="#21-%e8%8e%b7%e5%8f%96%e8%a1%a8%e8%be%be%e5%bc%8f--getexpression" aria-label="2.1 è·å–è¡¨è¾¾å¼&amp;ndash;getExpression">2.1 è·å–è¡¨è¾¾å¼&ndash;<code>getExpression</code></a></li>
                <li>
                    <a href="#22-%e9%80%92%e5%bd%92%e4%b8%8b%e9%99%8d" aria-label="2.2 é€’å½’ä¸‹é™">2.2 é€’å½’ä¸‹é™</a></li>
                <li>
                    <a href="#23-%e5%b7%a6%e9%80%92%e5%bd%92%e6%b6%88%e9%99%a4" aria-label="2.3 å·¦é€’å½’æ¶ˆé™¤">2.3 å·¦é€’å½’æ¶ˆé™¤</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%ba%94-%e9%94%99%e8%af%af%e5%a4%84%e7%90%86%e8%ae%be%e8%ae%a1" aria-label="äº”. é”™è¯¯å¤„ç†è®¾è®¡">äº”. é”™è¯¯å¤„ç†è®¾è®¡</a><ul>
                        
                <li>
                    <a href="#1-%e6%80%bb%e4%bd%93%e8%ae%be%e8%ae%a1" aria-label="1 æ€»ä½“è®¾è®¡">1 æ€»ä½“è®¾è®¡</a></li>
                <li>
                    <a href="#2-%e5%85%b7%e4%bd%93%e5%88%86%e6%9e%90-errors" aria-label="2 å…·ä½“åˆ†æ Errors">2 å…·ä½“åˆ†æ Errors</a><ul>
                        
                <li>
                    <a href="#a" aria-label="a">a</a></li>
                <li>
                    <a href="#b-c" aria-label="b c">b c</a></li>
                <li>
                    <a href="#d-e" aria-label="d e">d e</a></li>
                <li>
                    <a href="#f-g" aria-label="f g">f g</a></li>
                <li>
                    <a href="#h" aria-label="h">h</a></li>
                <li>
                    <a href="#i-j-k" aria-label="i j k"><strong>i j k</strong></a></li>
                <li>
                    <a href="#l" aria-label="l">l</a></li>
                <li>
                    <a href="#m" aria-label="m">m</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%85%ad-%e7%94%9f%e6%88%90%e4%bb%a3%e7%a0%81%e8%ae%be%e8%ae%a1" aria-label="å…­. ç”Ÿæˆä»£ç è®¾è®¡">å…­. ç”Ÿæˆä»£ç è®¾è®¡</a><ul>
                        
                <li>
                    <a href="#%e7%bc%96%e7%a0%81%e5%89%8d%e8%ae%be%e8%ae%a1" aria-label="ç¼–ç å‰è®¾è®¡">ç¼–ç å‰è®¾è®¡</a><ul>
                        
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e7%94%9f%e6%88%90pcode" aria-label="å¦‚ä½•ç”ŸæˆPcode">å¦‚ä½•ç”ŸæˆPcode</a><ul>
                        
                <li>
                    <a href="#%e6%96%b0%e5%a2%9e%e7%9a%84%e7%b1%bb" aria-label="æ–°å¢çš„ç±»">æ–°å¢çš„ç±»</a></li>
                <li>
                    <a href="#%e5%8f%98%e9%87%8f%e5%a3%b0%e6%98%8e" aria-label="å˜é‡å£°æ˜">å˜é‡å£°æ˜</a></li>
                <li>
                    <a href="#%e8%b5%8b%e5%80%bc%e8%af%ad%e5%8f%a5" aria-label="èµ‹å€¼è¯­å¥">èµ‹å€¼è¯­å¥</a></li>
                <li>
                    <a href="#%e5%8f%98%e9%87%8f%e5%8f%96%e5%80%bc" aria-label="å˜é‡å–å€¼">å˜é‡å–å€¼</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e5%ae%9a%e4%b9%89" aria-label="å‡½æ•°å®šä¹‰"><strong>å‡½æ•°å®šä¹‰</strong></a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e5%bd%a2%e5%8f%82" aria-label="å‡½æ•°å½¢å‚">å‡½æ•°å½¢å‚</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8" aria-label="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e8%bf%94%e5%9b%9e" aria-label="å‡½æ•°è¿”å›">å‡½æ•°è¿”å›</a></li>
                <li>
                    <a href="#%e6%89%93%e5%8d%b0%e8%af%ad%e5%8f%a5" aria-label="æ‰“å°è¯­å¥">æ‰“å°è¯­å¥</a></li>
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e8%b7%b3%e8%bd%ac%e6%8e%a7%e5%88%b6%e8%af%ad%e5%8f%a5" aria-label="æ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥">æ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥</a></li>
                <li>
                    <a href="#%e5%8a%a0%e5%87%8f%e4%b9%98%e9%99%a4%e6%af%94%e8%be%83%e8%bf%90%e7%ae%97%e8%a1%a8%e8%be%be%e5%bc%8f" aria-label="åŠ å‡ã€ä¹˜é™¤ï¼Œæ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼">åŠ å‡ã€ä¹˜é™¤ï¼Œæ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e8%bf%90%e8%a1%8cpcode" aria-label="å¦‚ä½•è¿è¡ŒPcode">å¦‚ä½•è¿è¡ŒPcode</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96" aria-label="åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
                <li>
                    <a href="#%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c" aria-label="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</a><ul>
                        
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e5%8f%98%e9%87%8f" aria-label="è·å–å˜é‡">è·å–å˜é‡</a></li>
                <li>
                    <a href="#pushpop" aria-label="pushã€pop">pushã€pop</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e5%8f%98%e9%87%8f%e5%9c%a8%e6%a0%88%e4%b8%8a%e7%9a%84%e7%bb%9d%e5%af%b9%e5%9c%b0%e5%9d%80" aria-label="è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€">è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%bf%90%e8%a1%8c%e4%bb%a3%e7%a0%81" aria-label="è¿è¡Œä»£ç ">è¿è¡Œä»£ç </a><ul>
                        
                <li>
                    <a href="#var" aria-label="var">var</a></li>
                <li>
                    <a href="#push" aria-label="push">push</a></li>
                <li>
                    <a href="#pop" aria-label="pop">pop</a></li>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97" aria-label="è®¡ç®—">è®¡ç®—</a></li>
                <li>
                    <a href="#%e6%95%b0%e7%bb%84%e7%bb%b4%e6%95%b0" aria-label="æ•°ç»„ç»´æ•°">æ•°ç»„ç»´æ•°</a></li>
                <li>
                    <a href="#%e5%8d%a0%e4%bd%8d%e7%ac%a6" aria-label="å ä½ç¬¦">å ä½ç¬¦</a></li>
                <li>
                    <a href="#getint" aria-label="getint">getint</a></li>
                <li>
                    <a href="#%e8%b7%b3%e8%bd%ac" aria-label="è·³è½¬">è·³è½¬</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e5%ae%9a%e4%b9%89-1" aria-label="å‡½æ•°å®šä¹‰">å‡½æ•°å®šä¹‰</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8-1" aria-label="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨</a></li>
                <li>
                    <a href="#%e6%89%93%e5%8d%b0%e8%be%93%e5%87%ba" aria-label="æ‰“å°è¾“å‡º">æ‰“å°è¾“å‡º</a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e5%8f%98%e9%87%8f%e7%9a%84%e5%80%bc%e5%9c%b0%e5%9d%80" aria-label="è·å–å˜é‡çš„å€¼ï¼Œåœ°å€">è·å–å˜é‡çš„å€¼ï¼Œåœ°å€</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e7%bc%96%e7%a0%81%e5%90%8e%e8%ae%be%e8%ae%a1" aria-label="ç¼–ç åè®¾è®¡">ç¼–ç åè®¾è®¡</a><ul>
                        
                <li>
                    <a href="#%e5%b0%8f%e7%bb%86%e8%8a%82%e9%97%ae%e9%a2%98" aria-label="å°ç»†èŠ‚é—®é¢˜">å°ç»†èŠ‚é—®é¢˜</a></li>
                <li>
                    <a href="#pcode%e4%bb%a3%e7%a0%81%e5%af%b9%e5%ba%94%e8%a1%a8" aria-label="Pcodeä»£ç å¯¹åº”è¡¨">Pcodeä»£ç å¯¹åº”è¡¨</a><ul>
                        
                <li>
                    <a href="#common-type" aria-label="Common Type">Common Type</a></li>
                <li>
                    <a href="#%e8%bf%90%e7%ae%97%e6%af%94%e8%be%83" aria-label="è¿ç®—æ¯”è¾ƒ">è¿ç®—æ¯”è¾ƒ</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%9f%ad%e8%b7%af%e6%b1%82%e5%80%bc%e9%97%ae%e9%a2%98" aria-label="çŸ­è·¯æ±‚å€¼é—®é¢˜">çŸ­è·¯æ±‚å€¼é—®é¢˜</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%83-%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b" aria-label="ä¸ƒ. ä»£ç ç¤ºä¾‹">ä¸ƒ. ä»£ç ç¤ºä¾‹</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        
        <div class="post-content"><h1 id="ç¼–è¯‘è®¾è®¡æ–‡æ¡£">ç¼–è¯‘è®¾è®¡æ–‡æ¡£<a hidden class="anchor" aria-hidden="true" href="#ç¼–è¯‘è®¾è®¡æ–‡æ¡£">#</a></h1>
<blockquote>
<p>å§“åï¼šé©¬æ³½è¿œ</p>
<p>å­¦å·ï¼š20373793</p>
</blockquote>
<h2 id="ä¸€-å‚è€ƒç¼–è¯‘å™¨ä»‹ç»">ä¸€. å‚è€ƒç¼–è¯‘å™¨ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#ä¸€-å‚è€ƒç¼–è¯‘å™¨ä»‹ç»">#</a></h2>
<p>Pcodeä»£ç ç”Ÿæˆéƒ¨åˆ†ï¼ˆåŒ…æ‹¬Pcodeä»£ç æ‰§è¡Œï¼‰éƒ¨åˆ†å‚è€ƒäº†<a href="https://pandolia.net/tinyc/index.html">ã€Šè‡ªå·±åŠ¨æ‰‹å†™ç¼–è¯‘å™¨ã€‹</a>ã€‚</p>
<p>å…¶ä½™éƒ¨åˆ†å‚è€ƒäº†å¾€å¹´çš„ç¼–è¯‘æŒ‡å¯¼æ–‡æ¡£ï¼ŒåŒ…æ‹¬ä¸€äº›å¾€å±Šå­¦é•¿çš„ç¼–è¯‘å™¨è®¾è®¡æ¶æ„</p>
<h2 id="äºŒ-ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡">äºŒ. ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#äºŒ-ç¼–è¯‘å™¨æ€»ä½“è®¾è®¡">#</a></h2>
<h3 id="æ€»ä½“ç»“æ„">æ€»ä½“ç»“æ„<a hidden class="anchor" aria-hidden="true" href="#æ€»ä½“ç»“æ„">#</a></h3>
<p>æˆ‘çš„ç¼–è¯‘å™¨æ€»ä½“ç»“æ„æŒ‰ç…§ç¼–è¯‘çš„é¡ºåºï¼Œå³<strong>è¯æ³•åˆ†æ</strong>ã€<strong>è¯­æ³•åˆ†æ</strong>ã€<strong>è¯­ä¹‰åˆ†æ</strong>ã€<strong>ä»£ç ç”Ÿæˆ</strong>ï¼Œåˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ã€‚</p>
<ul>
<li>
<p>æœ‰å‡ ä¸ªç±»ç”¨æ¥å®šä¹‰åŸºæœ¬çš„ä¸€äº›éœ€è¦ç”¨åˆ°çš„å˜é‡ï¼Œæ¯”å¦‚**<code>TokenWord</code>ç±»<strong>å¯¹åº”ç€</strong>å•è¯ç±»**ï¼Œå…¶å±æ€§åŒ…æ‹¬<strong>å•è¯å†…å®¹ï¼Œç±»åˆ«ç ï¼Œæ‰€åœ¨è¡Œæ•°</strong>ã€‚ç±»ä¼¼çš„ï¼Œè¿˜æœ‰**<code>Symbol</code>ç±»<strong>å¯¹åº”ç€</strong>ç¬¦å·ç±»**,<strong><code>Expressions</code>ç±»</strong>å¯¹åº”ç€<strong>è¡¨è¾¾å¼ç±»</strong>,<strong>ç”¨äºè¡¨ç¤ºä¸€ä¸ªå…·æœ‰å¤šä¸ªè¡¨è¾¾å¼çš„å¤§è¡¨è¾¾å¼</strong>ï¼Œä»¥åŠ**<code>SymbolTable</code>ç±»<strong>å¯¹åº”ç€</strong>ç¬¦å·è¡¨ç±»**ï¼Œ<strong><code>Func</code>ç±»</strong>å¯¹åº”ç€<strong>å‡½æ•°ç±»</strong>ï¼Œè¿˜æœ‰**<code>Error</code>ç±»**ã€‚</p>
</li>
<li>
<p>å¦å¤–çš„å‡ ä¸ªç±»ï¼Œåˆ™æ˜¯åˆ†åˆ«å¯¹åº”ç€ç›¸åº”çš„å‡ ä¸ªç¼–è¯‘å™¨<strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼Œ<strong><code>LexicalAanlysis</code>ç±»</strong>å¯¹åº”<strong>è¯æ³•åˆ†æ</strong>ï¼Œ<strong><code>GrammarAanlysis</code>ç±»</strong>ç»¼åˆäº†<strong>è¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æã€é”™è¯¯å¤„ç†ï¼Œä»¥åŠç”Ÿæˆä¸­é—´ä»£ç ï¼ˆPcodeç ï¼‰</strong></p>
</li>
<li>
<p>è€Œå¯¹äº<code>Pcode</code>çš„<code>å®šä¹‰ï¼Œæ‰§è¡Œ</code>åˆ™æ˜¯å•ç‹¬è®¾ç½®äº†ä¸€ä¸ªæ–‡ä»¶åŒ…**<code>PcodeGeneration</code><strong>,å…¶ä¸­åŒ…å«å¯¹</strong><code>Pcode</code><strong>çš„</strong><code>Function</code><strong>ã€</strong><code>Execute</code><strong>ï¼Œ</strong><code>retinfo</code><strong>ï¼Œ</strong><code>variety</code>**ä»¥åŠå…¶æœ¬èº«ã€‚</p>
</li>
<li>
<p><strong><code>Compiler</code>ç±»</strong>å¯¹åº”ç€ç¼–è¯‘å™¨çš„æ€»å…¥å£ã€‚åœ¨å…¶ä¸­ï¼Œä¾æ¬¡è°ƒç”¨**<code>LexicalAanlysis</code><strong>ï¼Œ</strong><code>GrammarAanlysis</code><strong>ï¼Œ</strong><code>PcodeExecutor</code><strong>ç±»ï¼Œå³å¯å®Œæˆ</strong>è¯æ³•åˆ†æ<strong>åˆ°</strong>è¯­æ³•åˆ†æ<strong>åˆ°</strong>è¯­ä¹‰åˆ†æ<strong>åˆ°</strong>ä»£ç ç”Ÿæˆ<strong>çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå½¢æˆäº†ç±»ä¼¼ä¸€ä¸ª</strong>å•å‘é“¾**ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ª<strong>å•ç‹¬çš„æ¨¡å—</strong>ã€‚</p>
</li>
</ul>
<h3 id="æ–‡ä»¶ç»„ç»‡">æ–‡ä»¶ç»„ç»‡<a hidden class="anchor" aria-hidden="true" href="#æ–‡ä»¶ç»„ç»‡">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>src 
</span></span><span style="display:flex;"><span>â”‚  Compiler.java <span style="color:#75715e">#å…¥å£ç¨‹åº</span>
</span></span><span style="display:flex;"><span>â”‚  Error.java <span style="color:#75715e">#é”™è¯¯ç±»</span>
</span></span><span style="display:flex;"><span>â”‚  Expressions.java <span style="color:#75715e">#è¡¨è¾¾å¼ç±»</span>
</span></span><span style="display:flex;"><span>â”‚  Func.java <span style="color:#75715e">#å‡½æ•°ç±»</span>
</span></span><span style="display:flex;"><span>â”‚  GrammarAnalysis.java <span style="color:#75715e">#è¯­æ³•åˆ†æã€é”™è¯¯å¤„ç†ã€ä»£ç ç”Ÿæˆç±»</span>
</span></span><span style="display:flex;"><span>â”‚  lexicalAnalysis.java <span style="color:#75715e">#è¯æ³•åˆ†æç±»</span>
</span></span><span style="display:flex;"><span>â”‚  Symbol.java <span style="color:#75715e">#ç¬¦å·ç±»</span>
</span></span><span style="display:flex;"><span>â”‚  SymbolTable.java <span style="color:#75715e">#ç¬¦å·è¡¨ç±»</span>
</span></span><span style="display:flex;"><span>â”‚  TokenWord.java <span style="color:#75715e">#å•è¯ç±»</span>
</span></span><span style="display:flex;"><span>â””â”€PcodeGeneration
</span></span><span style="display:flex;"><span>        Function.java <span style="color:#75715e">#Pcodeä¸­çš„å‡½æ•°ç±»</span>
</span></span><span style="display:flex;"><span>        LabelCreator.java <span style="color:#75715e">#æ ‡ç­¾åˆ¶é€ </span>
</span></span><span style="display:flex;"><span>        Pcode.java <span style="color:#75715e">#Pcodeä»£ç ç±»</span>
</span></span><span style="display:flex;"><span>        PcodeExecutor.java <span style="color:#75715e">#Pcodeè¿è¡Œè™šæ‹Ÿæœºç±»</span>
</span></span><span style="display:flex;"><span>        PcodeKey.java <span style="color:#75715e">#æšä¸¾Pcodeä¸­çš„å…³é”®è¯</span>
</span></span><span style="display:flex;"><span>        RetInfo.java <span style="color:#75715e">#è¿”å›ä¿¡æ¯ç±»</span>
</span></span><span style="display:flex;"><span>        Variety.java <span style="color:#75715e">#å˜é‡ç±»</span>
</span></span></code></pre></div><h3 id="ç±»å›¾">ç±»å›¾<a hidden class="anchor" aria-hidden="true" href="#ç±»å›¾">#</a></h3>
<p><img loading="lazy" src="https://s2.51cto.com/images/blog/202107/21/b457fccfffcc3bccbf2a0025475ea7f8.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=/format,webp/resize,m_fixed,w_1184" alt="image-20221129093419595(1)"  />
</p>
<h2 id="ä¸‰-è¯æ³•åˆ†æè®¾è®¡">ä¸‰. è¯æ³•åˆ†æè®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#ä¸‰-è¯æ³•åˆ†æè®¾è®¡">#</a></h2>
<h3 id="1-æ€»è¿°">1 æ€»è¿°<a hidden class="anchor" aria-hidden="true" href="#1-æ€»è¿°">#</a></h3>
<p>è¯æ³•åˆ†æçš„æ€»ä»»åŠ¡æ˜¯ä»æºç¨‹åºä¸­è¯†åˆ«å‡ºå•è¯ï¼Œè®°å½•å•è¯ç±»åˆ«å’Œå•è¯å€¼ã€‚åœ¨è¯æ³•åˆ†æçš„è®¾è®¡ä¸­ç»™äº†ä¸€å¼ è¡¨ï¼Œå…¶ä¸­æœ‰ä¸‰é¡¹æ˜¯åŠ ç²—è¯´æ˜çš„ï¼Œåˆ†åˆ«æ˜¯ <strong><code>å˜é‡åï¼ˆIdentï¼‰</code></strong>ï¼Œ<strong><code>æ•´å¸¸æ•°ï¼ˆIntConstï¼‰</code></strong> å’Œ <strong><code>æ ¼å¼å­—ç¬¦ä¸²ï¼ˆFormatStringï¼‰</code></strong> è€Œå‰©ä¸‹éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ <strong><code>ç‰¹æ®Šå­—ç¬¦</code></strong>ã€‚</p>
<p>è¯æ³•åˆ†æçš„ä½œä¸šæœ¬è´¨ä¸Šå°±æ˜¯æŠŠæ–‡ä»¶è½¬æ¢æˆä¸€ä¸ªä¸ªçš„è¯ï¼Œåœ¨ä¹‹åçš„æ–‡ç« ä¸­æˆ‘ä»¬ç§°ä¹‹ä¸º <strong><code>TokenWord</code></strong>ã€‚ç„¶åå†æŠŠåˆ†å‡ºæ¥çš„**<code>TokenWord</code>**è¿›è¡Œç±»åˆ«çš„åˆ¤æ–­ï¼Œæœ€åè¾“å‡ºã€‚</p>
<h3 id="2-å®ç°">2 å®ç°<a hidden class="anchor" aria-hidden="true" href="#2-å®ç°">#</a></h3>
<h4 id="21-æ–‡ä»¶è¯»å†™">2.1 æ–‡ä»¶è¯»å†™<a hidden class="anchor" aria-hidden="true" href="#21-æ–‡ä»¶è¯»å†™">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>InputStreamReader Reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testfile.txt&#34;</span><span style="color:#f92672">),</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>BufferedReader bufferedReader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span>Reader<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>OutputStreamWriter Writer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> OutputStreamWriter<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FileOutputStream<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output.txt&#34;</span><span style="color:#f92672">),</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>BufferedWriter bufferedWriter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedWriter<span style="color:#f92672">(</span>Writer<span style="color:#f92672">);</span>
</span></span></code></pre></div><p>åˆ©ç”¨<code>bufferedReader</code>é€è¡Œè¯»å…¥æ–‡ä»¶ï¼Œæ³¨æ„éœ€è¦æ‰‹åŠ¨åŠ å…¥æ¢è¡Œç¬¦ï¼ˆæœ€åæ·»åŠ çš„ä¸€ä¸ªè¦åˆ æ‰ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>line <span style="color:#f92672">=</span> bufferedReader<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">())</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    str<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>line<span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">,</span> str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span></code></pre></div><p>å°†<code>lexicalAnalysis</code>ä¸­åˆ†æå¾—åˆ°çš„<code>tokenWords</code>å†™å‡º</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>TokenWord tokenWord <span style="color:#f92672">:</span>lexicalAnalysis<span style="color:#f92672">.</span><span style="color:#a6e22e">tokenWords</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    bufferedWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>tokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassCode</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">+</span> tokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getToken</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="22-è¯æ³•åˆ†æè¿‡ç¨‹">2.2 è¯æ³•åˆ†æè¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#22-è¯æ³•åˆ†æè¿‡ç¨‹">#</a></h4>
<h5 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡å·¥ä½œ">#</a></h5>
<p><strong>æ ‡è¯†ç¬¦å®šä¹‰</strong>é‡‡ç”¨enumæšä¸¾ClassCodeçš„æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">enum</span> ClassCode <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    IDENFR<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    INTCON<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    STRCON<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">......</span>
</span></span></code></pre></div><p>åŒæ—¶é‡‡ç”¨<code>HashMap</code>æ„é€ ä¸€äº›ç‰¹å®šæ ‡è¯†ç¬¦çš„å¯¹åº”å…³ç³»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> ResCode <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hasResCode</span><span style="color:#f92672">(</span>String token<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ResCode<span style="color:#f92672">.</span><span style="color:#a6e22e">containsKey</span><span style="color:#f92672">(</span>token<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ResCode<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;main&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MAINTK&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    ResCode<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;const&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;CONSTTK&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">......</span>
</span></span></code></pre></div><h5 id="å…·ä½“åˆ†æ">å…·ä½“åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#å…·ä½“åˆ†æ">#</a></h5>
<p><strong>æ€»ä½“é‡‡å–é€ä¸ªå­—ç¬¦è¯»å…¥çš„æ–¹å¼ï¼ŒåŒæ—¶ä¸€äº›ç‰¹å®šå­—ç¬¦é‡‡å–é¢„è¯»å–æ¥åˆ¤æ–­ã€‚</strong></p>
<h6 id="é€ä¸ªå­—ç¬¦è¯»å…¥">é€ä¸ªå­—ç¬¦è¯»å…¥<a hidden class="anchor" aria-hidden="true" href="#é€ä¸ªå­—ç¬¦è¯»å…¥">#</a></h6>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getCh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ch <span style="color:#f92672">=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>cursor<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="è·³è¿‡æ¢è¡Œç©ºæ ¼tr">è·³è¿‡æ¢è¡Œã€ç©ºæ ¼ã€<code>\t</code>ã€<code>\r</code><a hidden class="anchor" aria-hidden="true" href="#è·³è¿‡æ¢è¡Œç©ºæ ¼tr">#</a></h6>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\n&#39;</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\t&#39;</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\r&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\n&#39;</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\r&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        LineNum<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="æ ‡è¯†ç¬¦">æ ‡è¯†ç¬¦<a hidden class="anchor" aria-hidden="true" href="#æ ‡è¯†ç¬¦">#</a></h6>
<p>å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å¼€å¤´ï¼Œå…ˆä»<code>ResCode</code>çœ‹æ˜¯å¦æ˜¯ä¿ç•™å­—,å¦åˆ™æŒ‰ç…§<code>IDNEFR</code>å¤„ç†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isLetter<span style="color:#f92672">(</span>ch<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>isLetter<span style="color:#f92672">(</span>ch<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> isDigit_with_0<span style="color:#f92672">(</span>ch<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;_&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//reback
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        cursor<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>hasResCode<span style="color:#f92672">(</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>ResCode<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>        tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">IDENFR</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="intcon">INTCON<a hidden class="anchor" aria-hidden="true" href="#intcon">#</a></h6>
<p>å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯0</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isDigit_with_0<span style="color:#f92672">(</span>ch<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;0&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>isDigit_with_0<span style="color:#f92672">(</span>ch<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        cursor<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">INTCON</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²<a hidden class="anchor" aria-hidden="true" href="#å­—ç¬¦ä¸²">#</a></h6>
<p>é‡åˆ°<code>&quot;</code>å¼€å§‹ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª<code>&quot;</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#34;&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1 <span style="color:#f92672">&amp;&amp;</span> ch <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;&#34;&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">STRCON</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„tokenword">å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„<code>TokenWord</code><a hidden class="anchor" aria-hidden="true" href="#å•ä¸ªå­—ç¬¦æˆ–è€…å¿…é¡»ä¸¤ä¸ªå­—ç¬¦çš„tokenword">#</a></h6>
<p>æ¯”å¦‚<code>[</code>ï¼Œ<code>]</code>ï¼Œ<code>+</code>ï¼Œ<code>&amp;&amp;</code>ç­‰ï¼Œç›´æ¥è¯»å°±å¯ä»¥</p>
<h6 id="å¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„tokenword">å¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„<code>TokenWord</code><a hidden class="anchor" aria-hidden="true" href="#å¯èƒ½æ˜¯å•ä¸ªä¹Ÿå¯èƒ½ä¸¤ä¸ªå­—ç¬¦çš„tokenword">#</a></h6>
<p>æ¯”å¦‚<code>&gt;=</code>ï¼Œ<code>!=</code>ä¹‹ç±»çš„</p>
<p>é‡‡ç”¨é¢„è¯»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;=&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;=&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">EQL</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">ASSIGN</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                cursor<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">ASSIGN</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="æ³¨é‡Š">æ³¨é‡Š<a hidden class="anchor" aria-hidden="true" href="#æ³¨é‡Š">#</a></h6>
<p>é‡åˆ°<code>/</code>çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨é¢„è¯»</p>
<p><code>//</code>ï¼šå¹¶ä¸”ä¸€ç›´è¯»åˆ°é‡åˆ°æ¢è¡Œç¬¦</p>
<p><code>/*</code>ï¼šåˆ©ç”¨<code>BackStr = allFile.substring(cursor);</code>æå–å‡ºç¬¬ä¸€ä¸ª<code>*</code>åé¢çš„å­—ç¬¦ä¸²<code>BackStr</code>ï¼›ç„¶ååˆ¤æ–­å…¶ä¸­æœ‰æ²¡æœ‰<code>*/</code>ï¼Œè‹¥æ˜¯æ²¡æœ‰ï¼Œå°±å°†åé¢çš„å†…å®¹å…¨éƒ¨æ³¨é‡Šæ‰ï¼Œè‹¥æ˜¯æœ‰å°±å°†cursorç§»åŠ¨åˆ°å…¶åé¢ï¼Œä½†æ˜¯æ³¨æ„è¦é‡åˆ°æ¢è¡Œç¬¦æ—¶åŠ è¡Œæ•°ã€‚</p>
<p>å¦åˆ™<code>/</code>ï¼šç›´æ¥æŒ‰ç…§<code>DIV</code>è¾“å‡º</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Token<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&lt;=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                    getCh<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    noteFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>noteFlag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                LineNum<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            noteFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ch <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;*&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String BackStr<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">boolean</span> flagnote<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> cursortmp <span style="color:#f92672">=</span> cursor<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            BackStr <span style="color:#f92672">=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>cursor<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>BackStr<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;*/&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                cursor <span style="color:#f92672">=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                cursor <span style="color:#f92672">=</span> cursor <span style="color:#f92672">+</span> BackStr<span style="color:#f92672">.</span><span style="color:#a6e22e">indexOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;*/&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> 2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> originLength <span style="color:#f92672">=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>cursortmp<span style="color:#f92672">,</span> cursor<span style="color:#f92672">).</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> replaceLength <span style="color:#f92672">=</span> allFile<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>cursortmp<span style="color:#f92672">,</span> cursor<span style="color:#f92672">).</span><span style="color:#a6e22e">replace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                LineNum <span style="color:#f92672">+=</span> originLength <span style="color:#f92672">-</span> replaceLength<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">DIV</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cursor <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                cursor<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        classCode <span style="color:#f92672">=</span> ClassCode<span style="color:#f92672">.</span><span style="color:#a6e22e">DIV</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TokenWord<span style="color:#f92672">(</span>classCode<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>Token<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>LineNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="å››-è¯­æ³•åˆ†æè®¾è®¡">å››. è¯­æ³•åˆ†æè®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#å››-è¯­æ³•åˆ†æè®¾è®¡">#</a></h2>
<h3 id="1-æ€»è¿°-1">1 æ€»è¿°<a hidden class="anchor" aria-hidden="true" href="#1-æ€»è¿°-1">#</a></h3>
<p>åœ¨è¯­æ³•åˆ†æé˜¶æ®µï¼Œæ ¹æ®è¯æ³•åˆ†æç¨‹åºè¯†åˆ«å‡ºçš„Tokenå•è¯ï¼Œæ ¹æ®<code>SysY</code>è¯­æ³•è§„åˆ™è¯†åˆ«å‡ºå„ç§è¯­æ³•å…ƒç´ ã€‚é‡‡ç”¨é€’å½’ä¸‹é™æ³•å¯¹è¯­æ³•ä¸­å®šä¹‰çš„è¯­æ³•æˆåˆ†è¿›è¡Œåˆ†æã€‚<strong>æ³¨æ„è¦æ¶ˆé™¤å·¦é€’å½’ï¼Œä»¥åŠé¢å¯¹å¯èƒ½çš„å›æº¯é—®é¢˜è¿›è¡Œé¢„è¯»ã€‚</strong></p>
<p>ä»**<code>CompUnit</code>**å¼€å§‹é€å±‚å¾€ä¸‹è¿›è¡Œåˆ†æã€‚</p>
<h3 id="2-å…·ä½“å®ç°">2 å…·ä½“å®ç°<a hidden class="anchor" aria-hidden="true" href="#2-å…·ä½“å®ç°">#</a></h3>
<ul>
<li>
<p>è®¾ç½®<code>getWordMove()</code>,<code>getNowWord()</code>,<code>getNextWord()</code>,<code>getThirdWord()</code>å·¥å…·å‡½æ•°ç”¨äºè¯»å…¥<code>tokenWord</code>,åŒæ—¶è®¾ç½®<code>GrammarString</code>,<code>curTokenWord</code>ç­‰å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨è·å¾—çš„è¯­æ³•åˆ†ææˆåˆ†ï¼Œä»¥åŠå½“å‰æ‰€è¯»åˆ°çš„<code>tokenWord</code>ã€‚</p>
</li>
<li>
<p>å¯¹äºæ™®é€šçš„è¯­æ³•æˆåˆ†ï¼Œæˆ‘é€ä¸ªè¯»å…¥<code>tokenWord</code>ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå¸¸è§„çš„åˆ†æã€‚</p>
<p>å¯¹äºè¡¨è¾¾å¼<code>Expression</code>ï¼Œæˆ‘é¦–å…ˆæ‰«æå‡ºæ•´ä¸ªçš„<code>Expression</code>,ç„¶åå¯¹äºå…·æœ‰å·¦é€’å½’æ€§çš„è¯­æ³•è§„åˆ™ï¼Œå†ä¾æ®ç‰¹å®šçš„<strong>åˆ†éš”ç¬¦</strong>ï¼Œå¯¹æ•´ä¸ªå¤§çš„<code>Expression</code>è¿›è¡Œ<strong>åˆ†å‰²</strong>æˆè‹¥å¹²ä¸ªè¾ƒçŸ­çš„<code>Expression</code>ï¼Œç„¶åä¾æ¬¡<strong>è°ƒç”¨å¯¹åº”å­è¡¨è¾¾å¼çš„åˆ†ææ–¹æ³•</strong>ï¼Œè¿›è¡Œ<strong>é€’å½’ä¸‹é™æ³•</strong>è¿›è¡Œåˆ†æã€‚</p>
</li>
<li>
<p>æ„å»ºäº†ä¸€ä¸ªæ–°çš„<code>Expressions</code>ç±»ï¼Œ<strong>ç”¨äºå­˜æ”¾åˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼,å…¶ä¸­è®°å½•æœ‰åˆ†éš”ç¬¦ï¼Œåˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Expressions</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> symbols<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;&gt;</span> expressions<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ArrayList<span style="color:#f92672">&lt;</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">getExpressions</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> expressions<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> symbols<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Expressions</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> symbols<span style="color:#f92672">,</span> ArrayList<span style="color:#f92672">&lt;</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;&gt;</span> expressions<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">symbols</span> <span style="color:#f92672">=</span> symbols<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">expressions</span> <span style="color:#f92672">=</span> expressions<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h4 id="21-è·å–è¡¨è¾¾å¼--getexpression">2.1 è·å–è¡¨è¾¾å¼&ndash;<code>getExpression</code><a hidden class="anchor" aria-hidden="true" href="#21-è·å–è¡¨è¾¾å¼--getexpression">#</a></h4>
<p>é€šè¿‡ä¸€äº›ç‰¹å®šçš„åˆ¤æ–­æ¡ä»¶ï¼Œç»“åˆ<strong>å½“å‰å­—ç¬¦ä»¥åŠå‰ä¸€ä¸ªå­—ç¬¦çš„å€¼</strong>è¿›è¡Œåˆ¤æ–­ï¼Œä»¥åŠ<strong>æ˜¯å¦ä½äºå‡½æ•°</strong>çš„åˆ¤æ–­ç­‰ï¼Œè¿›è¡Œè¡¨è¾¾å¼çš„è·å–ï¼ˆåç»­æ”¹å†™çš„æ—¶å€™æ¯”è¾ƒç¹çï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getExpression</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        TokenWord preWord <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        TokenWord word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">boolean</span> inFunc <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> FuncFlag <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> FlagSmall <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> FlagBig <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SEMICN&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ASSIGN&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RBRACE&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOfTrueStmt</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//ä¸åœ¨å‡½æ•°å£°æ˜æˆ–è€…å¼•ç”¨å†…ï¼Œä¸”é‡åˆ°&#39;,&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;COMMA&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>inFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//å•è¯ä¸åœ¨è¡¨è¾¾å¼å†…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>preWord <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">((</span>preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RPARENT&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RBRACK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>FlagSmall <span style="color:#f92672">==</span> 0 <span style="color:#f92672">&amp;&amp;</span> FlagBig <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LBRACK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>preWord<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LBRACE&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOfNotInExp</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//åœ¨å‡½æ•°å†…éƒ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>getNextWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LPARENT&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    inFunc <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//(),[]è¯†åˆ«
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LPARENT&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                FlagSmall<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>inFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    FuncFlag<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RPARENT&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                FlagSmall<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>inFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    FuncFlag<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>FuncFlag <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        inFunc <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">switch</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassCode</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;LBRACK&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagBig<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;RBRACK&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagBig<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>FlagSmall <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>FlagBig <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            curTokenWord <span style="color:#f92672">=</span> tokenWords<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>cursor<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>            exp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>curTokenWord<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            preWord <span style="color:#f92672">=</span> word<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> exp<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="22-é€’å½’ä¸‹é™">2.2 é€’å½’ä¸‹é™<a hidden class="anchor" aria-hidden="true" href="#22-é€’å½’ä¸‹é™">#</a></h4>
<p>å¯¹äºä¸€æ¡è¯­æ³•æ¨å¯¼è§„åˆ™ï¼Œè‹¥å…¶æ¨å¯¼å‡ºçš„å¼å­ä¸­å«æœ‰$V_{N}$,é‚£ä¹ˆè€ƒè™‘é‡‡ç”¨<code>é€’å½’ä¸‹é™åˆ†ææ³•</code></p>
<p>åœ¨æˆ‘çš„å®ç°ä¸­ï¼Œæˆ‘æ¯è¯»ä¸€ä¸ª<code>tokenWord</code>ï¼Œæ£€æŸ¥å®ƒå±äºå“ªä¸€ä¸ª$V_{N}$ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªç›¸åº”çš„åˆ†æå‡½æ•°ã€‚</p>
<p><strong>ä¾‹å¦‚<code>CompUnit</code>:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>CompUnit <span style="color:#960050;background-color:#1e0010">â†’</span> <span style="color:#f92672">{</span>Decl<span style="color:#f92672">}</span> <span style="color:#f92672">{</span>FuncDef<span style="color:#f92672">}</span> MainFuncDef <span style="color:#75715e">// 1.æ˜¯å¦å­˜åœ¨Decl 2.æ˜¯å¦å­˜åœ¨ FuncDef
</span></span></span></code></pre></div><p><strong>å…·ä½“å®ç°</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseCompUnit</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        TokenWord word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CONSTTK&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTTK&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> getNextWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>getThirdWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LPARENT&#34;</span><span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            analyseDecl<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;VOIDTK&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">((</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTTK&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>getNextWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MAINTK&#34;</span><span style="color:#f92672">))))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            analyseFuncDef<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTTK&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> getNextWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MAINTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            analyseMainFuncDef<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Error<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;CompUnit&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>åˆæ¯”å¦‚<code>Stmt</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>è¯­å¥ Stmt <span style="color:#960050;background-color:#1e0010">â†’</span> LVal <span style="color:#e6db74">&#39;=&#39;</span> Exp <span style="color:#e6db74">&#39;;&#39;</span> <span style="color:#75715e">// æ¯ç§ç±»å‹çš„è¯­å¥éƒ½è¦è¦†ç›–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		  <span style="color:#f92672">|</span> <span style="color:#f92672">[</span>Exp<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;;&#39;</span> <span style="color:#75715e">//æœ‰æ— Expä¸¤ç§æƒ…å†µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		  <span style="color:#f92672">|</span> Block
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span> Cond <span style="color:#e6db74">&#39;)&#39;</span> Stmt <span style="color:#f92672">[</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">else</span><span style="color:#960050;background-color:#1e0010">&#39;</span> Stmt <span style="color:#f92672">]</span> <span style="color:#75715e">// 1.æœ‰else 2.æ— else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		  <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">while</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span> Cond <span style="color:#e6db74">&#39;)&#39;</span> Stmt
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">break</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">;</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">continue</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">;</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">return</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">[</span>Exp<span style="color:#f92672">]</span> <span style="color:#e6db74">&#39;;&#39;</span> <span style="color:#75715e">// 1.æœ‰Exp 2.æ— Exp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		  <span style="color:#f92672">|</span> LVal <span style="color:#e6db74">&#39;=&#39;</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>getint<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#e6db74">&#39;(&#39;&#39;)&#39;&#39;;&#39;</span>
</span></span><span style="display:flex;"><span>		  <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>printf<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#e6db74">&#39;(&#39;</span>FormatString<span style="color:#f92672">{</span><span style="color:#e6db74">&#39;,&#39;</span>Exp<span style="color:#f92672">}</span><span style="color:#e6db74">&#39;)&#39;&#39;;&#39;</span> <span style="color:#75715e">// 1.æœ‰Exp 2.æ— Exp
</span></span></span></code></pre></div><p><strong>å…·ä½“å®ç°</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseStmt</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        TokenWord word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp <span style="color:#f92672">=</span> getExpression<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>getNowWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SEMICN&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                analyseLVal<span style="color:#f92672">(</span>exp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//=
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>getNowWord<span style="color:#f92672">().</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;GETINTTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//getint
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    analyseExp<span style="color:#f92672">(</span>getExpression<span style="color:#f92672">());</span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    getWordMove<span style="color:#f92672">();</span> <span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                analyseExp<span style="color:#f92672">(</span>exp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOfBeginOfExp</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            analyseExp<span style="color:#f92672">(</span>getExpression<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LBRACE&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            analyseBlock<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IFTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            analyseCond<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ELSETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                getWordMove<span style="color:#f92672">();</span> <span style="color:#75715e">//else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WHILETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            analyseCond<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;BREAKTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//break
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CONTINUETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//continue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RETURNTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOfBeginOfExp</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                analyseExp<span style="color:#f92672">(</span>getExpression<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PRINTFTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//printf
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//STRCON
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;COMMA&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                analyseExp<span style="color:#f92672">(</span>getExpression<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SEMICN&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;Stmt&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>åœ¨ä»¥ä¸Šçš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯</p>
<ul>
<li>ä¸€äº›è¯­æ³•æˆåˆ†å†…éƒ¨åˆ†æè¿‡ç¨‹çš„ç»†èŠ‚æ€§æ³¨æ„ï¼ˆæ‹¬å·åŒ¹é…ç­‰é—®é¢˜ï¼‰</li>
<li>é¢å¯¹$V_{N}$ï¼Œéœ€è¦<code>getNowWord()</code>é¢„è¯»ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥åŠ å…¥<code>GrammarString</code>ä¸­ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ¤æ–­å±äºå“ªä¸ª$V_{N}$</li>
</ul>
<h4 id="23-å·¦é€’å½’æ¶ˆé™¤">2.3 å·¦é€’å½’æ¶ˆé™¤<a hidden class="anchor" aria-hidden="true" href="#23-å·¦é€’å½’æ¶ˆé™¤">#</a></h4>
<p>é‡‡ç”¨è½¬æ¢ä¸º<code>BNFèŒƒå¼</code>çš„æ–¹æ³•æ¶ˆé™¤å·¦é€’å½’</p>
<p>ä¾‹å¦‚<strong>åŠ å‡è¡¨è¾¾å¼</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>AddExp <span style="color:#960050;background-color:#1e0010">â†’</span> MulExp <span style="color:#f92672">|</span> AddExp (<span style="color:#e6db74">&#39;+&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;âˆ’&#39;</span>) MulExp <span style="color:#75715e">// 1.MulExp 2.+ éœ€è¦†ç›– 3.- éœ€è¦†ç›–
</span></span></span></code></pre></div><p>æ”¹å†™ä¸º</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>AddExp <span style="color:#960050;background-color:#1e0010">â†’</span> MulExp (<span style="color:#e6db74">&#39;+&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;âˆ’&#39;</span>) MulExp  (<span style="color:#e6db74">&#39;+&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;âˆ’&#39;</span>) MulExp ...
</span></span></code></pre></div><p>æ”¹å†™å®Œä»¥åï¼Œæ„é€ **<code>divideExp()</code>**æ–¹æ³•ï¼Œå°†æ•´ä¸ªå¤§çš„è¡¨è¾¾å¼è¿›è¡Œåˆ†å‰²ï¼Œå†ä¾æ¬¡è°ƒç”¨å­ç¨‹åºè¿›è¡Œåˆ†æ</p>
<p><strong><code>private Expressions (divideExp(ArrayList&lt;TokenWord&gt; exp, ArrayList&lt;String&gt; symbol)</code></strong>:</p>
<ul>
<li>
<p>è¾“å…¥ï¼šè¡¨è¾¾å¼<code>exp</code>,åˆ†éš”ç¬¦åˆ—è¡¨</p>
<p>è¿”å›ï¼šåˆ†å‰²å‡ºçš„å­è¡¨è¾¾å¼ï¼Œåˆ†å‰²ç¬¦å·åˆ—è¡¨ â€”â€”â€”â€” <code>return new Expressions(symbols, exps)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> Expressions <span style="color:#a6e22e">divideExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">,</span> ArrayList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> symbol<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        ArrayList<span style="color:#f92672">&lt;</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;&gt;</span> exps <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> tmpExp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> symbols <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">boolean</span> unaryFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> FlagSmall <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> FlagBig <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TokenWord word <span style="color:#f92672">:</span> exp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">switch</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassCode</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;LPARENT&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagSmall<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;RPARENT&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagSmall<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;LBRACK&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagBig<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;RBRACK&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                    FlagBig<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//é‡åˆ°æŒ‡å®šåˆ†éš”ç¬¦ï¼Œå¹¶ä¸”(),[]å¾—åˆ°åŒ¹é…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>symbol<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassCode</span><span style="color:#f92672">())</span> <span style="color:#f92672">&amp;&amp;</span> FlagSmall <span style="color:#f92672">==</span> 0 <span style="color:#f92672">&amp;&amp;</span> FlagBig <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//å¦‚æœåˆ†éš”ç¬¦æ˜¯å•ç›®è¿ç®—ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOfUnary</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//å¦‚æœä¸Šä¸€ä¸ªwordä¸æ˜¯è¯†åˆ«ç¬¦,),],intå¸¸æ•°ï¼Œé‚£ä¹ˆä¸åœ¨æ­¤å¤„åˆ†å‰²ï¼Œä»…å°†å½“å‰wordåŠ å…¥exp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>unaryFlag<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        tmpExp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//å¦‚æœä¸Šä¸€ä¸ªwordä¸æ˜¯è¯†åˆ«ç¬¦,),],intå¸¸æ•°ï¼Œå‘expsä¸­åŠ å…¥å½“å‰è¡¨è¾¾å¼ï¼Œå¹¶ä¸”é‡ç½®è¡¨è¾¾å¼ï¼Œå‘åˆ†éš”ç¬¦åˆ—è¡¨ä¸­åŠ å…¥å½“å‰word
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                exps<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                symbols<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                tmpExp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                tmpExp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            unaryFlag <span style="color:#f92672">=</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IDENFR&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RPARENT&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;INTCON&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">||</span> word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RBRACK&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        exps<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Expressions<span style="color:#f92672">(</span>symbols<span style="color:#f92672">,</span> exps<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<p>æœ€ç»ˆä¾‹å¦‚<strong>åŠ å‡è¡¨è¾¾å¼</strong>,åˆ†æä»£ç å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseAddExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      Expressions exps <span style="color:#f92672">=</span> divideExp<span style="color:#f92672">(</span>exp<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PLUS&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MINU&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> tmpExp <span style="color:#f92672">:</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getExpressions</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         analyseMulExp<span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;AddExp&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">&lt;</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>              GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j<span style="color:#f92672">++).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="äº”-é”™è¯¯å¤„ç†è®¾è®¡">äº”. é”™è¯¯å¤„ç†è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#äº”-é”™è¯¯å¤„ç†è®¾è®¡">#</a></h2>
<h3 id="1-æ€»ä½“è®¾è®¡">1 æ€»ä½“è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#1-æ€»ä½“è®¾è®¡">#</a></h3>
<ul>
<li>
<p><strong>æ–°å®šä¹‰ç±»</strong></p>
<ul>
<li>å®šä¹‰<code>Error</code>ç±»ï¼Œå­˜æ”¾é”™è¯¯çš„ç±»å‹ï¼Œæ‰€åœ¨è¡Œæ•°</li>
<li>å®šä¹‰<code>Symbol</code>ç±»ï¼Œ<code>type</code>æ˜¯æŒ‡ç¬¦å·çš„ç±»å‹,ä¾‹å¦‚<code>const</code>,<code>var</code>,<code>para</code>ã€‚<code>Dimension</code>æ˜¯ä¸€ä¸ªæ•´æ•°,æŒ‡å‡ºäº†ç¬¦å·çš„ç»´æ•°ã€‚å¦‚æœä¸º0ï¼Œåˆ™ç¬¦å·ä¸ºintã€‚å¦‚æœä¸º1ï¼Œåˆ™ç¬¦å·ä¸ºint[]ï¼›å¦‚æœä¸º2ï¼Œåˆ™ç¬¦å·ä¸ºint[][]&hellip;ã€‚<code>token</code>æ˜¯æŒ‡<code>Symbol</code>çš„å†…å®¹ã€‚<code>layer</code>å°±æ˜¯è¿™ä¸ª<code>ç¬¦å·</code>æ‰€åœ¨çš„å±‚çº§ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Symbol</span><span style="color:#f92672">(</span>String type<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> Dimension<span style="color:#f92672">,</span> TokenWord tokenWord<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> layer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> type<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Dimension</span> <span style="color:#f92672">=</span> Dimension<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">token</span> <span style="color:#f92672">=</span> tokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getToken</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">layer</span> <span style="color:#f92672">=</span> layer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>å®šä¹‰<code>SymbolTable</code>ç±»æ¥å­˜æ”¾ç¬¦å·è¡¨ï¼Œåœ¨å…¶ä¸­ç”¨<code>HashMap&lt;String, Symbol&gt; mapSymbol</code>æ¥å­˜æ”¾ç¬¦å·ï¼ŒåŒæ—¶åœ¨å…¶ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€çš„æ–¹æ³•</p>
</li>
<li>
<p>å®šä¹‰<code>Func</code>ç±»ï¼Œåˆ†åˆ«è®°å½•å‡½æ•°åã€å‡½æ•°è¿”å›ç±»å‹ï¼ˆvoidï¼Œintï¼‰ã€ä»¥åŠå‡½æ•°çš„å‚æ•°ç±»å‹</p>
<p>ç”¨<code>ArrayList&lt;Integer&gt; TypeOfParas</code>æ¥è®°å½•å‡½æ•°çš„å‚æ•°ç±»å‹ï¼Œ0ã€1ã€2åˆ†åˆ«ä»£è¡¨ç€int,int[],int[][]</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
<th>Integer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Void</td>
<td>ï¼ˆå‡½æ•°è¿”å›å€¼ä¸ºç©ºï¼‰</td>
<td>-1</td>
</tr>
<tr>
<td>Int</td>
<td>a</td>
<td>0</td>
</tr>
<tr>
<td>Int[]</td>
<td>a[]</td>
<td>1</td>
</tr>
<tr>
<td>Int[] []</td>
<td>a[] [3]</td>
<td>2</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p>åœ¨<code>GrammarAnalysis</code>ç±»ä¸­ï¼Œæˆ‘å®šä¹‰äº†å¦‚ä¸‹å‡ ä¸ªæ–°çš„å˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ArrayList<span style="color:#f92672">&lt;</span>Error<span style="color:#f92672">&gt;</span> errors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å‡½æ•°åHashmap
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Func<span style="color:#f92672">&gt;</span> funcs <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å±‚çº§layerå¯¹åº”ç¬¦å·è¡¨,æ¯å½“è¿›å…¥ä¸€ä¸ªæ–°å±‚çº§ï¼Œå°±å°†layer++ï¼Œæ–°æ„é€ ä¸€ä¸ªSymbolTables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> HashMap<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">,</span> SymbolTable<span style="color:#f92672">&gt;</span> SymbolTables <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> layer <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> ReturnFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span><span style="color:#75715e">//è¡¨ç¤ºå½“å‰å‡½æ•°æ˜¯å¦éœ€è¦è¿”å›ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> IndexWhile <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> <span style="color:#75715e">//è¡¨ç¤ºå½“å‰ä»£ç å—æ˜¯å¦åœ¨whileä¸­ã€‚
</span></span></span></code></pre></div></li>
<li>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<blockquote>
<p><strong>åœ¨<code>AnalyseBlock</code>ä¸­å¯¹äºä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼Œä¸å‡½æ•°çš„å‚æ•°æ˜¯åŒä¸€ä¸ª<code>Layer</code>çš„ï¼ˆå¦åˆ™æ— æ³•åˆ¤æ–­å‡½æ•°å†…éƒ¨é‡å¤å®šä¹‰å‡½æ•°å‚æ•°ç­‰é”™è¯¯ï¼‰è€Œå¯¹äºmainå‡½æ•°ï¼Œè¿›å…¥åˆ°Blockçš„æ—¶å€™ï¼Œ<code>Layer</code>è¦åŠ 1ï¼ˆmainå‡½æ•°å†…éƒ¨å¯ä»¥é‡å¤å®šä¹‰å…¨å±€å˜é‡ï¼‰</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">analyseBlock</span><span style="color:#f92672">(</span><span style="color:#66d9ef">boolean</span> fromFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>fromFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            IncreaseLayer<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>fromFunc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            DecreaseLayer<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></blockquote>
</li>
</ul>
<h3 id="2-å…·ä½“åˆ†æ-errors">2 å…·ä½“åˆ†æ Errors<a hidden class="anchor" aria-hidden="true" href="#2-å…·ä½“åˆ†æ-errors">#</a></h3>
<h4 id="a">a<a hidden class="anchor" aria-hidden="true" href="#a">#</a></h4>
<p>æ£€æŸ¥æ ¼å¼å°±å¥½</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">IllegalFormatString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>i <span style="color:#f92672">&lt;=</span> content<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>NormalChar<span style="color:#f92672">(</span>content<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>content<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;\\&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>content<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i <span style="color:#f92672">+</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;n&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            i<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>content<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">&amp;&amp;</span> content<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i <span style="color:#f92672">+</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;d&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                i<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="b-c">b c<a hidden class="anchor" aria-hidden="true" href="#b-c">#</a></h4>
<p>b: <code>å¯¹äºå˜é‡ã€å‡½æ•°å‚æ•°æ¥è¯´</code>ï¼Œæ¯æ¬¡æˆ‘å¾—åˆ°ä¸€ä¸ª<code>Ident</code>è¯†åˆ«ç¬¦ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„ç¬¦å·è¢«å®šä¹‰åœ¨åŒä¸€å±‚çº§ã€‚<code>å¯¹äºå‡½æ•°æ¥è¯´</code>ï¼Œç›´æ¥æŸ¥çœ‹<code>funcs.containsKey(curTokenWord.getToken())</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//åˆ¤æ–­å½“å‰åŒºå—æ˜¯å¦æœ‰å½“å‰ç¬¦å· b
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">existSymbolInThisArea</span><span style="color:#f92672">(</span>TokenWord tokenWord<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> SymbolTables<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>layer<span style="color:#f92672">).</span><span style="color:#a6e22e">SymbolExist</span><span style="color:#f92672">(</span>tokenWord<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>c: æ£€æŸ¥æ‰€æœ‰å±‚çº§çš„ç¬¦å·è¡¨ï¼Œæ­¤å‡½æ•°ç¬¦å·æ˜¯å¦å·²å®šä¹‰ã€‚å‡½æ•°ç›´æ¥æŸ¥çœ‹<code>funcs</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">hasSymbol</span><span style="color:#f92672">(</span>Word word<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Symbols s <span style="color:#f92672">:</span> symbols<span style="color:#f92672">.</span><span style="color:#a6e22e">values</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">hasSymbol</span><span style="color:#f92672">(</span>word<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="d-e">d e<a hidden class="anchor" aria-hidden="true" href="#d-e">#</a></h4>
<p>é¦–å…ˆï¼Œä¸ºäº†è·å–æ¯ä¸€ä¸ªå‡½æ•°å‚æ•°ï¼ˆå¯èƒ½ä¸ºè¡¨è¾¾å¼ï¼‰çš„çœŸå®ç»´æ•°ï¼Œæˆ‘åœ¨è¯­æ³•åˆ†æå™¨çš„é€’å½’ä¸‹é™è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ç…§<code>Exp-&gt;Add-&gt;Mul-&gt;Unary-&gt;Primary/Func-&gt;Lval/Exp</code>è¿™ä¸ªè·¯å¾„ï¼Œæ¯ä¸ªåˆ†æå‡½æ•°åˆ†åˆ«è¿”å›ç»´æ•°ï¼ˆè°ƒç”¨ä¸‹ä¸€å±‚è·å¾—ï¼‰ï¼Œç›´åˆ°<code>Lval</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">analyseExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> Dimension <span style="color:#f92672">=</span> analyseAddExp<span style="color:#f92672">(</span>exp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;Exp&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Dimension<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>åœ¨<code>Lval</code>ä¸­ï¼Œç»“æŸé€’å½’è°ƒç”¨ï¼Œè¿”å›æœ€ç»ˆç»“æœ</p>
<p><strong>æ³¨æ„</strong></p>
<blockquote>
<p>ä¾‹å¦‚a[3][5],lvalå¯¹åº”a[3],é‚£ä¹ˆå®é™…æ•°ç»„ç»´æ•°æ˜¯1
è€ƒè™‘åˆ°a[b[3]]</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">analyseLVal</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>Word<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span> 	    TokenWord Ident <span style="color:#f92672">=</span> exp<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>existSymbol<span style="color:#f92672">(</span>Ident<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span> Ident<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Ident<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span><span style="color:#75715e">//Ident
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//è‹¥æ˜¯æ•°ç»„	
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exp<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> tmpExp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> flag <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//é€ä¸ªæ‰«æ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> exp<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                TokenWord word <span style="color:#f92672">=</span> exp<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LBRACK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        Dimension<span style="color:#f92672">++;</span>  <span style="color:#75715e">//a[]è¿™ç§ï¼Œè€Œä¸æ˜¯a[[]](ä¸èƒ½åŠ ç»´æ•°)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                    flag<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                        tmpExp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        tmpExp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RBRACK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    flag<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        analyseExp<span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                        tmpExp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    tmpExp<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>word<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                analyseExp<span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;k&#34;</span><span style="color:#f92672">,</span> exp<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>exp<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span> <span style="color:#75715e">// not sure
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;LVal&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#75715e">//å¦‚ä¸Šæ³¨æ„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>existSymbol<span style="color:#f92672">(</span>Ident<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> getSymbol<span style="color:#f92672">(</span>Ident<span style="color:#f92672">).</span><span style="color:#a6e22e">getDimension</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> Dimension<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>å®šä¹‰<code>checkFuncParas</code>å‡½æ•°æ¥è¿›è¡Œå‚æ•°æ•°ç›®ï¼Œå‚æ•°ç»´æ•°åˆ¤æ–­,åœ¨åˆ†æ<code>analyseFuncRParams</code>æ—¶è¿›è¡Œè°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//æ£€æŸ¥å‡½æ•°å‚æ•°åŒ¹é…é—®é¢˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkFuncParas</span><span style="color:#f92672">(</span>TokenWord funcName<span style="color:#f92672">,</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> standardTypeOfParas<span style="color:#f92672">,</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> nowTypeOfParas<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>standardTypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> nowTypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;d&#34;</span><span style="color:#f92672">,</span> funcName<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> standardTypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>standardTypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">),</span> nowTypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;e&#34;</span><span style="color:#f92672">,</span> funcName<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseFuncRParams</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">,</span> TokenWord Ident<span style="color:#f92672">,</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> TypeOfParas<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> nowParas <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    Expressions exps <span style="color:#f92672">=</span> divideExp<span style="color:#f92672">(</span>exp<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">singletonList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;COMMA&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> tmpExp <span style="color:#f92672">:</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getExpressions</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> Dimension <span style="color:#f92672">=</span> analyseExp<span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        nowParas<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Dimension<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">&lt;</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j<span style="color:#f92672">++).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>TypeOfParas <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        checkFuncParas<span style="color:#f92672">(</span>Ident<span style="color:#f92672">,</span> TypeOfParas<span style="color:#f92672">,</span> nowParas<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;FuncRParams&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ç„¶ååœ¨<code>analyseFuncRParams</code>æ—¶ï¼Œå¦‚æœé‡åˆ°äº†å‡½æ•°è°ƒç”¨é‚£ä¹ˆè¿›è¡Œåˆ¤æ–­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exp<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 3<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å®å‚åˆ—è¡¨æœ‰ä¸œè¥¿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    analyseFuncRParams<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>exp<span style="color:#f92672">.</span><span style="color:#a6e22e">subList</span><span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> exp<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)),</span> Ident<span style="color:#f92672">,</span> TypeOfParas<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å®å‚åˆ—è¡¨æ²¡ä¸œè¥¿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>TypeOfParas <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>TypeOfParas<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;d&#34;</span><span style="color:#f92672">,</span> Ident<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="f-g">f g<a hidden class="anchor" aria-hidden="true" href="#f-g">#</a></h4>
<p>å¦‚æœå½“å‰å‡½æ•°éœ€è¦è¿”å›ï¼Œä¼šæœ‰ä¸€ä¸ªå…¨å±€å˜é‡<code> ReturnFlag</code>æ¥æ˜¾ç¤ºï¼Œåˆå§‹åŒ–ä¸ºfalseã€‚å…¶åœ¨<code>analyseFuncDef()</code>ä»¥åŠ<code>analyseMainFuncDef()</code>ä¸­ï¼Œå¾—åˆ°èµ‹å€¼ã€‚</p>
<ul>
<li>
<p>å¯¹äº<strong>f</strong></p>
<p>åœ¨åˆ†æ<code>Stmt</code>ä¸­çš„<code>RETURNTK</code>æ—¶å€™ï¼Œè‹¥<code> ReturnFlag</code>ä¸º<code>false</code>,é‚£ä¹ˆå°±äº§ç”Ÿ**<code>f</code>**é”™è¯¯</p>
</li>
<li>
<p>å¯¹äº<strong>g</strong></p>
<p>å®šä¹‰äº†<code>hasReturn</code>å˜é‡ï¼Œå…¶åœ¨<code>analyseBlockâ†’BlockItem/Stmtâ†’Stmt</code>è¿™æ¡è·¯å¾„ä¸Šè¿›è¡Œè°ƒç”¨ä¼ é€’ï¼Œå¹¶ä½œä¸ºè¿”å›å€¼è¿”å›</p>
<p>ç„¶ååœ¨<code>analyseFuncDef()</code>ä»¥åŠ<code>analyseMainFuncDef()</code>ä¸­å¯¹<code>ReturnFlag &amp;&amp; !hasReturn</code>è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥æ˜¯çœŸåˆ™äº§ç”Ÿ**<code>g</code>**é”™è¯¯</p>
</li>
</ul>
<h4 id="h">h<a hidden class="anchor" aria-hidden="true" href="#h">#</a></h4>
<p>åˆ¤æ–­æ˜¯å¦ä¸ºå¸¸æ•°å³å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>if (isConst(word)) {
</span></span><span style="display:flex;"><span>    Error(&#34;h&#34;, word.getLineNum());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="i-j-k"><strong>i j k</strong><a hidden class="anchor" aria-hidden="true" href="#i-j-k">#</a></h4>
<p>å®šä¹‰å‡½æ•°æ¥æ£€æŸ¥ï¼Œä»¥<code>ï¼‰</code>ä¸ºä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//æ£€æŸ¥å³å°æ‹¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">checkRightParent</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>getNowWord<span style="color:#f92672">().</span><span style="color:#a6e22e">getClassCode</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RPARENT&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        getWordMove<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;j&#34;</span><span style="color:#f92672">,</span> curTokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="l">l<a hidden class="anchor" aria-hidden="true" href="#l">#</a></h4>
<p>åˆ†æ<code>Stmt</code>é‡åˆ°<code>PRINTFTK</code>æ—¶ï¼Œåˆ¤æ–­ä¸€ä¸‹<code>printf</code>é‡Œé¢é€—å·çš„æ•°é‡å’Œ<code>STRCON</code>ä¸­çš„è¦æ±‚è¾“å‡ºæ•°æ˜¯å¦ä¸€è‡´å³å¯</p>
<h4 id="m">m<a hidden class="anchor" aria-hidden="true" href="#m">#</a></h4>
<p>å¦‚æœä»£ç å—åœ¨<code>While</code>å¾ªç¯ä¸­ï¼Œåˆ™æœ‰ä¸€ä¸ªå…¨å±€å˜é‡<code>WhileFlag</code>è¡¨ç¤º,å…¶å€¼ä¸ä¸º0ã€‚åœ¨é‡åˆ°<code>break</code>æˆ–æ˜¯<code>continue</code>çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹å³å¯</p>
<h2 id="å…­-ç”Ÿæˆä»£ç è®¾è®¡">å…­. ç”Ÿæˆä»£ç è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#å…­-ç”Ÿæˆä»£ç è®¾è®¡">#</a></h2>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘é€‰æ‹©ç”Ÿæˆpcodeä»£ç ã€‚æˆ‘è®¾è®¡äº†ä¸€ç§åŸºäº<strong>é€†æ³¢å…°è¡¨è¾¾å¼</strong>å †æ ˆå’Œç¬¦å·è¡¨çš„è™šæ‹ŸPcodeä»£ç ,åœ¨è¿›è¡Œè¯­æ³•åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œéšä¹‹ç”ŸæˆPcodeä»£ç ã€‚
<strong>åŒæ—¶ï¼Œæˆ‘è®¾è®¡äº†æ‰§è¡Œå®ƒä»¬çš„è™šæ‹Ÿæœºã€‚Pcodeè™šæ‹Ÿæœºæ˜¯ç”¨äºè¿è¡ŒPcodeå‘½ä»¤çš„è™šæ„æœºå™¨ã€‚</strong>
<strong>å®ƒç”±ä¸€ä¸ªä»£ç åŒº(pcodes)ã€ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆ(EIP)ã€ä¸€ä¸ªmainå‡½æ•°æŒ‡é’ˆ(mainAddressï¼‰ã€ä¸€ä¸ªå †æ ˆï¼ˆå­˜æ”¾å„ç§æ•°å€¼ï¼‰ã€å­˜æ”¾è¿”å›ä¿¡æ¯çš„æ•°ç»„ã€ä¸€ä¸ªå˜é‡è¡¨var_table,ä¸€ä¸ªå‡½æ•°è¡¨func_tableå’Œä¸€ä¸ªæ ‡ç­¾è¡¨label_tableç»„æˆã€‚</strong></p>
<p>åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†é¦–å…ˆä»‹ç»å¦‚ä½•ç”Ÿæˆpcodeï¼Œç„¶åä»‹ç»pcodeå¦‚ä½•æ‰§è¡Œã€‚</p>
<h3 id="ç¼–ç å‰è®¾è®¡">ç¼–ç å‰è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#ç¼–ç å‰è®¾è®¡">#</a></h3>
<h4 id="å¦‚ä½•ç”Ÿæˆpcode">å¦‚ä½•ç”ŸæˆPcode<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•ç”Ÿæˆpcode">#</a></h4>
<h5 id="æ–°å¢çš„ç±»">æ–°å¢çš„ç±»<a hidden class="anchor" aria-hidden="true" href="#æ–°å¢çš„ç±»">#</a></h5>
<p>åœ¨<code>PcodeGeneration</code>åŒ…ä¸­ï¼Œæˆ‘æ–°å¢äº†</p>
<ul>
<li>
<p><code>Function</code>ç±»â€”â€”â€”â€”è®°å½•å‡½æ•°å£°æ˜åœ¨Pcodesä»£ç ä¸­çš„ä½ç½®ä»¥åŠå…¶å‚æ•°æ•°é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Function</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> index<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> argsNum<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">StackOffset</span> <span style="color:#f92672">=</span> index<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ParamsNum</span> <span style="color:#f92672">=</span> argsNum<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>LabelCreator</code>ç±»â€”â€”â€”â€”ç”¨äºäº§ç”Ÿæ ‡ç­¾</p>
</li>
<li>
<p><code>Variety</code>ç±»â€”â€”â€”â€”è®°å½•å˜é‡åœ¨æ ˆä¸Šçš„ä½ç½®ï¼Œç»´åº¦æ•°ï¼Œå„ç»´æ•°çš„æ•°é‡</p>
</li>
<li>
<p><code>RetInfo</code>ç±»â€”â€”â€”â€”è®°å½•å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆè°ƒç”¨å‡½æ•°æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„EIPï¼‰ï¼Œè°ƒç”¨å‡½æ•°å‰æ ˆä¸Šçš„æœ«å°¾ä½ç½®ï¼ˆ<code>stack.size() - 1</code>ï¼‰ï¼Œè™šæ‹Ÿæœºä¸­å½“å‰çš„å˜é‡è¡¨ï¼ˆvar_tableï¼‰ï¼Œå‡½æ•°çš„å‚æ•°æ•°é‡ï¼Œå‡½æ•°æ‰€éœ€è°ƒç”¨çš„å‚æ•°æ•°é‡ï¼Œç›®å‰å·²æœ‰çš„å‚æ•°æ•°é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RetInfo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> eip<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> stackPtr<span style="color:#f92672">,</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Variety<span style="color:#f92672">&gt;</span> varTable<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> paramsNum<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> callArgsNum<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> nowArgsNum<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">eip</span> <span style="color:#f92672">=</span> eip<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">stackPtr</span> <span style="color:#f92672">=</span> stackPtr<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">varTable</span> <span style="color:#f92672">=</span> varTable<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">paramsNum</span> <span style="color:#f92672">=</span> paramsNum<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">callParamsNum</span> <span style="color:#f92672">=</span> callArgsNum<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">nowParamsNum</span> <span style="color:#f92672">=</span> nowArgsNum<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>Pcode</code>ç±»â€”â€”â€”â€”è®°å½•ä¸€ä¸ª<code>Pcode</code>æŒ‡ä»¤çš„åç§°<code>key</code>,<code>FirstValue</code>,<code>LastValue</code>(å¦‚æœ‰)ï¼ŒåŒæ—¶è§„å®šäº†<code>Pcode</code>çš„è§„èŒƒåŒ–è¾“å‡ºï¼ˆ<code>label,func,call,print</code>è¿›è¡Œç‰¹æ®Šè€ƒè™‘)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    String first <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    String second <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> FirstValue<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">func</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;FUNC @&#34;</span> <span style="color:#f92672">+</span> FirstValue<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">call</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;$&#34;</span> <span style="color:#f92672">+</span> FirstValue<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> FirstValue<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>FirstValue <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        first <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        first <span style="color:#f92672">=</span> FirstValue<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>SecondValue <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        second <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        second <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;, &#34;</span> <span style="color:#f92672">+</span> SecondValue<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span> first <span style="color:#f92672">+</span> second<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p><code>PcodeKey</code>æšä¸¾ç±»ï¼Œå­˜æ”¾<code>Pcode</code>çš„åŸºæœ¬æŒ‡ä»¤åç§°,åé¢ä¼šè¯¦ç»†ä»‹ç»</p>
</li>
</ul>
<h5 id="å˜é‡å£°æ˜">å˜é‡å£°æ˜<a hidden class="anchor" aria-hidden="true" href="#å˜é‡å£°æ˜">#</a></h5>
<p><strong>å¦‚ä½•åŒºåˆ†ä¸åŒçš„å˜é‡</strong>
æ ¹æ®å”¯ä¸€çš„ä½œç”¨åŸŸå·åŒºåˆ†ä¸åŒä½œç”¨åŸŸçš„å˜é‡ï¼Œå¦‚ï¼š<code>CurLayerId + &quot;_&quot; + Ident.getToken()</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤äº†é€’å½’å‡½æ•°è°ƒç”¨ä»¥å¤–ï¼Œä»£ç ä¸­ä¸ä¼šå¤šæ¬¡é‡å¤å‡ºç°è¯¥å˜é‡ï¼Œå¯ä»¥é€šè¿‡å°†<code>varTable</code>åˆ°å †æ ˆæ¥è§£å†³ã€‚</p>
<p><strong>ä¸åŒºåˆ†constå’Œvarã€‚</strong></p>
<ul>
<li><strong>éæ•°ç»„å˜é‡</strong>ï¼šæ–°å»ºä¸€ä¸ªå˜é‡<code>var</code>å¹¶è®©å®ƒæŒ‡å‘å †æ ˆé¡¶éƒ¨ã€‚å¦‚æœå®ƒæœ‰åˆå§‹åŒ–ï¼Œ<code>push</code>åˆå§‹åŒ–çš„å€¼è¿›å…¥å †æ ˆï¼ˆå¦‚æœ<code>int x=q</code>è¿™ç§åˆå§‹åŒ–ï¼Œé‚£ä¹ˆéœ€è¦<code>push q</code>ï¼Œç„¶åå†<code>getvalue</code>ï¼‰ã€‚å¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™æ·»åŠ ä¸€ä¸ª<code>defaultvalue</code>å‘½ä»¤æ¥å°†å˜é‡çš„é»˜è®¤åˆå§‹å€¼(æˆ‘å°†å…¶æ¨å…¥0)æ¨é€åˆ°å †æ ˆã€‚</li>
<li><strong>æ•°ç»„å˜é‡</strong>ï¼šæ–°å»ºä¸€ä¸ªå˜é‡<code>var</code>å¹¶è®©å®ƒæŒ‡å‘å †æ ˆé¡¶éƒ¨ã€‚ç„¶å<code>push</code>å…¶å„ç»´çš„ç»´æ•°ï¼Œç„¶åç”¨<code>dimarrayvar</code>å‘½ä»¤è¡¨ç¤ºä»–æ˜¯æ•°ç»„,å¦‚æœå®ƒæœ‰åˆå§‹åŒ–ï¼Œä¾æ¬¡<code>push</code>åˆå§‹åŒ–çš„å€¼è¿›å…¥å †æ ˆã€‚å¦‚æœæœªåˆå§‹åŒ–ï¼Œåˆ™æ·»åŠ ä¸€ä¸ª<code>defaultvalue</code>å‘½ä»¤æ¥å°†å˜é‡çš„é»˜è®¤åˆå§‹å€¼(æˆ‘å°†å…¶æ¨å…¥0)æ¨é€åˆ°å †æ ˆã€‚</li>
<li>å¦‚æœæ˜¯<code>getint</code>ï¼Œé‚£ä¹ˆåŠ å…¥<code>getint</code></li>
</ul>
<p>egï¼šint x[1][3];</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span>var 1_x
</span></span><span style="display:flex;"><span>push 1
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>dimarrayvar 1_x<span style="color:#f92672">,</span> 2
</span></span><span style="display:flex;"><span>defaultvalue 1_x<span style="color:#f92672">,</span> 2
</span></span></code></pre></div><h5 id="èµ‹å€¼è¯­å¥">èµ‹å€¼è¯­å¥<a hidden class="anchor" aria-hidden="true" href="#èµ‹å€¼è¯­å¥">#</a></h5>
<p>é¦–å…ˆ<code>push</code>å¾…èµ‹å€¼çš„å˜é‡ï¼ˆè‹¥æ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦<code>push</code>åç§»é‡ï¼‰ï¼Œç„¶ååˆ©ç”¨<code>getaddress</code>è®¡ç®—å¹¶å°†å˜é‡çš„åœ°å€æ¨é€åˆ°å †æ ˆé¡¶éƒ¨ã€‚ç„¶ååˆ†æèµ‹å€¼è¯­å¥å³ä¾§çš„è¡¨è¾¾å¼ï¼Œå¯¹äºæ•°å€¼ï¼Œç›´æ¥<code>push</code>,å¯¹äºè¡¨è¾¾å¼ï¼Œåˆ©ç”¨<code>getvalue</code>è·å–è¡¨è¾¾å¼çš„å€¼ã€‚ï¼ˆè‹¥æ˜¯ç®—æœ¯è¿ç®—è¡¨è¾¾å¼ï¼Œå°±å…ˆæ‰§è¡Œï¼‰åœ¨æ­¤ä¹‹åï¼Œå †æ ˆä¸­æœ‰ä¸¤ä¸ªæ•°å­—ï¼Œå³åœ°å€å’Œå€¼ã€‚åˆ©ç”¨<code>pop</code>å°†è¯¥å€¼åˆ†é…ç»™è¯¥åœ°å€ã€‚</p>
<h5 id="å˜é‡å–å€¼">å˜é‡å–å€¼<a hidden class="anchor" aria-hidden="true" href="#å˜é‡å–å€¼">#</a></h5>
<blockquote>
<p>ä¾‹å¦‚è¦å–å¾—x[0][2]çš„å€¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>push <span style="color:#ae81ff">2</span>_x
</span></span><span style="display:flex;"><span>push <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>push <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>getvalue <span style="color:#ae81ff">2</span>_x, <span style="color:#ae81ff">0</span>
</span></span></code></pre></div></blockquote>
<h5 id="å‡½æ•°å®šä¹‰"><strong>å‡½æ•°å®šä¹‰</strong><a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°å®šä¹‰">#</a></h5>
<p>ç›´æ¥<code>Pcodes.add(new Pcode(PcodeKey.func, curTokenWord.getToken()));</code>ï¼ˆmainfuncç‰¹æ®Šå®šä¹‰ï¼‰</p>
<h5 id="å‡½æ•°å½¢å‚">å‡½æ•°å½¢å‚<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°å½¢å‚">#</a></h5>
<p><code>fparam</code>+åå­—+ç»´æ•°</p>
<p><strong>æ³¨æ„</strong>ï¼šè‹¥æ˜¯æ•°ç»„ï¼Œéœ€è¦å…ˆ<code>push</code>è¿›å»å„ç»´æ•°é‡ï¼ˆäºŒç»´å½¢å‚ï¼Œåªéœ€è¦<code>push</code>ç¬¬äºŒç»´æ•°é‡ï¼‰</p>
<h5 id="å‡½æ•°è°ƒç”¨">å‡½æ•°è°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°è°ƒç”¨">#</a></h5>
<p><strong>å®å‚ç±»å‹</strong></p>
<ul>
<li>
<p>æ•°å€¼ï¼šå…ˆ<code>push</code>å‡½æ•°å®å‚ï¼Œå†<code>rparam</code>+å‡½æ•°å®å‚åå­—+ç»´æ•°,å†<code>call</code>ç›¸åº”å‡½æ•°å</p>
</li>
<li>
<p>å˜é‡ï¼šå…ˆ<code>push</code>å˜é‡å</p>
<ul>
<li>
<p>è‹¥æ˜¯æ•°ç»„ï¼Œå°±<code>getaddress</code>åŠ ç»´æ•°</p>
</li>
<li>
<p>è‹¥æ˜¯æ™®é€šå˜é‡ï¼Œå°±<code>getvalue</code>+ç»´æ•°ï¼›è‹¥æ˜¯<code>a[1][3]</code>è¿™ç§ï¼Œå°±å…ˆ<code>push</code>è¿›å»1,3ï¼Œå†<code>getvalue</code></p>
<p><strong>å‰©ä¸‹çš„æ“ä½œåŒä¸Š</strong></p>
</li>
</ul>
</li>
</ul>
<h5 id="å‡½æ•°è¿”å›">å‡½æ•°è¿”å›<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°è¿”å›">#</a></h5>
<p><code>ret 0</code>ä»£è¡¨æ— è¿”å›å€¼</p>
<p><code>ret 1</code>ä»£è¡¨æœ‰è¿”å›å€¼ï¼Œåœ¨<code>ret</code>ä¹‹å‰ä¼šæœ‰<code>push</code>ï¼ˆç”±åˆ†æè¡¨è¾¾å¼äº§ç”Ÿï¼‰ä¹‹ç±»çš„ï¼Œä»£è¡¨è¿”å›æŒ‡çš„å…·ä½“æ•°å€¼</p>
<h5 id="æ‰“å°è¯­å¥">æ‰“å°è¯­å¥<a hidden class="anchor" aria-hidden="true" href="#æ‰“å°è¯­å¥">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">,</span> STRCON<span style="color:#f92672">.</span><span style="color:#a6e22e">getToken</span><span style="color:#f92672">(),</span> OutputNum<span style="color:#f92672">));</span>
</span></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šæ‰“å°å˜é‡ï¼Œåˆ™æŒ‰ç…§è€å¥—è·¯ï¼Œå…ˆ<code>push</code>å˜é‡ï¼Œå†<code>getvalue</code>ä¾‹å¦‚<code>printf(&quot;%d&quot;,x);</code>ï¼Œåˆ™æ˜¯<code>push 2_x , getvalue 2_x, 0 print &quot;%d&quot;</code></p>
<h5 id="æ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥">æ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥<a hidden class="anchor" aria-hidden="true" href="#æ¡ä»¶è·³è½¬æ§åˆ¶è¯­å¥">#</a></h5>
<p>é¦–å…ˆï¼Œæˆ‘å®šä¹‰äº†ä¸‰ä¸ª<code>ArrayList</code>,åˆ†åˆ«å­˜æ”¾ç€å¯¹åº”æ ‡ç­¾çš„<code>HashMap</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;&gt;</span> If_Labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;&gt;</span> While_Labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>HashMap<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;&gt;</span> Cond_Labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span></code></pre></div><p>æ¯å½“é‡åˆ°<code>IFTK</code>æˆ–å…¶ä»–åˆ¤æ–­è¯­å¥æ—¶ï¼Œç”Ÿæˆç›¸åº”æ ‡ç­¾</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getNewIfLabel</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> tmpIfLabel <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    tmpIfLabel<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;if&#34;</span><span style="color:#f92672">,</span> LabelCreator<span style="color:#f92672">.</span><span style="color:#a6e22e">CreateLabel</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;if&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    tmpIfLabel<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;else&#34;</span><span style="color:#f92672">,</span> LabelCreator<span style="color:#f92672">.</span><span style="color:#a6e22e">CreateLabel</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;else&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    tmpIfLabel<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endif&#34;</span><span style="color:#f92672">,</span> LabelCreator<span style="color:#f92672">.</span><span style="color:#a6e22e">CreateLabel</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endif&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    tmpIfLabel<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ifblock&#34;</span><span style="color:#f92672">,</span> LabelCreator<span style="color:#f92672">.</span><span style="color:#a6e22e">CreateLabel</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ifblock&#34;</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tmpIfLabel<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä»¥<code>if</code>ä¸ºä¾‹å­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;IFTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   getNewIfLabel<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;if&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   analyseCond<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;if&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>   checkRightParent<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jz</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;else&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ifblock&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>   word <span style="color:#f92672">=</span> getNowWord<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jmp</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endif&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;else&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ELSETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       getWordMove<span style="color:#f92672">();</span> <span style="color:#75715e">//else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endif&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>   If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>If_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><code>while</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;WHILETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    getNewWhileLabel<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;while&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    IndexWhile<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//(
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    analyseCond<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;while&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    checkRightParent<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jz</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endwhile&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;whileblock&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    analyseStmt<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    IndexWhile<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jmp</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;while&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">label</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endwhile&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span><span style="color:#75715e">//break
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;BREAKTK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//break
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>IndexWhile <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;m&#34;</span><span style="color:#f92672">,</span> curTokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    checkSemicn<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jmp</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;endwhile&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span><span style="color:#75715e">//continue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>word<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CONTINUETK&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    getWordMove<span style="color:#f92672">();</span><span style="color:#75715e">//continue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>IndexWhile <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;m&#34;</span><span style="color:#f92672">,</span> curTokenWord<span style="color:#f92672">.</span><span style="color:#a6e22e">getLineNum</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    checkSemicn<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">jmp</span><span style="color:#f92672">,</span> While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>While_Labels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;while&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h5 id="åŠ å‡ä¹˜é™¤æ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼">åŠ å‡ã€ä¹˜é™¤ï¼Œæ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼<a hidden class="anchor" aria-hidden="true" href="#åŠ å‡ä¹˜é™¤æ¯”è¾ƒè¿ç®—è¡¨è¾¾å¼">#</a></h5>
<p>ä»¥æ¯”è¾ƒä¸ºä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseRelExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Expressions exps <span style="color:#f92672">=</span> divideExp<span style="color:#f92672">(</span>exp<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LSS&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;LEQ&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;GRE&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;GEQ&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>TokenWord<span style="color:#f92672">&gt;</span> tmpExp <span style="color:#f92672">:</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getExpressions</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        analyseAddExp<span style="color:#f92672">(</span>tmpExp<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">&gt;</span> 0 <span style="color:#f92672">&amp;&amp;</span> j <span style="color:#f92672">&lt;=</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getExpressions</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LSS&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">cmplt</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;LEQ&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">cmple</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;GRE&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">cmpgt</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">ClassCodeOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;GEQ&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                Pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Pcode<span style="color:#f92672">(</span>PcodeKey<span style="color:#f92672">.</span><span style="color:#a6e22e">cmpge</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&lt;RelExp&gt;&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">&lt;</span> exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            GrammarString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>exps<span style="color:#f92672">.</span><span style="color:#a6e22e">getSymbols</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>j<span style="color:#f92672">++).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºé‡‡ç”¨é€†æ³¢å…°è¡¨è¾¾å¼ï¼Œå½“åˆ†æåˆ°ç¬¬äºŒä¸ªè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå…¶å®<code>j</code>å·²ç»è·³åˆ°ç¬¬äºŒä¸ªè¡¨è¾¾å¼åé¢äº†ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­çš„æ˜¯<code>j-1</code>ä½ç½®å¤„</strong></p>
<h4 id="å¦‚ä½•è¿è¡Œpcode">å¦‚ä½•è¿è¡ŒPcode<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•è¿è¡Œpcode">#</a></h4>
<p><strong>Pcodeè™šæ‹Ÿæœºæ˜¯ç”¨äºè¿è¡ŒPcodeå‘½ä»¤çš„è™šæ„æœºå™¨ã€‚</strong>
<strong>å®ƒç”±ä¸€ä¸ªä»£ç åŒº(pcodes)ã€ä¸€ä¸ªæŒ‡ä»¤æŒ‡é’ˆ(EIP)ã€ä¸€ä¸ªmainå‡½æ•°æŒ‡é’ˆ(mainAddressï¼‰ã€ä¸€ä¸ªå †æ ˆï¼ˆå­˜æ”¾å„ç§æ•°å€¼ï¼‰ã€å­˜æ”¾è¿”å›ä¿¡æ¯çš„æ•°ç»„ã€ä¸€ä¸ªå˜é‡è¡¨var_table,ä¸€ä¸ªå‡½æ•°è¡¨func_tableå’Œä¸€ä¸ªæ ‡ç­¾è¡¨label_tableç»„æˆã€‚</strong></p>
<p><strong>æˆ‘å®šä¹‰äº†ä¸€ä¸ª<code>PcodeExecutor</code>ç±»ï¼Œå¯¹åº”ç€æˆ‘çš„Pcodeè™šæ‹Ÿæœº</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> eip <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//mainAddressæ ‡è®°mainå‡½æ•°çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> mainAddress<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Scanner scanner<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>Pcode<span style="color:#f92672">&gt;</span> pcodes<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>RetInfo<span style="color:#f92672">&gt;</span> retInfos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//æ¨¡æ‹Ÿå­˜æ”¾å„ç§æ•°å€¼çš„æ ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> stack <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Variety<span style="color:#f92672">&gt;</span> varTable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Function<span style="color:#f92672">&gt;</span> funcTable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//labelå¯¹åº”çš„ä»£ç è¡Œæ•°(eip)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Integer<span style="color:#f92672">&gt;</span> labelTable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span></code></pre></div><h5 id="åˆå§‹åŒ–">åˆå§‹åŒ–<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–">#</a></h5>
<p>å°†<code>scanner</code>å’Œ<code>pcode</code>ä»£ç åˆå§‹åŒ–ï¼ŒåŒæ—¶æ‰«æ<code>Pcode</code>ä»£ç ,å°†æ‰«æåˆ°çš„æ ‡ç­¾(åç§°ï¼Œä½ç½®ï¼‰åŠ å…¥æ ‡ç­¾è¡¨ï¼Œå‡½æ•°ï¼ˆåç§°ï¼Œfunctionï¼‰åŠ å…¥å‡½æ•°è¡¨ï¼Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PcodeExecutor</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>Pcode<span style="color:#f92672">&gt;</span> pcodes<span style="color:#f92672">,</span> Scanner sc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pcodes</span> <span style="color:#f92672">=</span> pcodes<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">scanner</span> <span style="color:#f92672">=</span> sc<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>index <span style="color:#f92672">&lt;</span> pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Pcode pcode <span style="color:#f92672">=</span> pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span> <span style="color:#f92672">(</span>pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getKey</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> label<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                labelTable<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span> index<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> func<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                funcTable<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span> <span style="color:#66d9ef">new</span> Function<span style="color:#f92672">(</span>index<span style="color:#f92672">,</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">()));</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> mainfunc<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                mainAddress <span style="color:#f92672">=</span> index<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        index<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h5 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#åŸºæœ¬æ“ä½œ">#</a></h5>
<h6 id="è·å–å˜é‡">è·å–å˜é‡<a hidden class="anchor" aria-hidden="true" href="#è·å–å˜é‡">#</a></h6>
<p>å¦‚æœå½“å‰å˜é‡è¡¨ä¸­å­˜åœ¨è¯¥å˜é‡ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™åœ¨å…¨å±€å˜é‡ä¸­å¯»æ‰¾</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Variety <span style="color:#a6e22e">getVar</span><span style="color:#f92672">(</span>String varName<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>varTable<span style="color:#f92672">.</span><span style="color:#a6e22e">containsKey</span><span style="color:#f92672">(</span>varName<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> varTable<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>varName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å…¨å±€å˜é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> retInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getVarTable</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>varName<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="pushpop">pushã€pop<a hidden class="anchor" aria-hidden="true" href="#pushpop">#</a></h6>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">push</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    stack<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å¼¹å‡ºå¹¶è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">pop</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value <span style="color:#f92672">=</span> stack<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    stack<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€">è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€<a hidden class="anchor" aria-hidden="true" href="#è·å–å˜é‡åœ¨æ ˆä¸Šçš„ç»å¯¹åœ°å€">#</a></h6>
<p>æ³¨æ„è¿™é‡Œçš„ç»´æ•°æ˜¯ç›¸å¯¹çš„
for example, to int a[3][2] ,a[0][0] is 0, a[0] is 1, a is 2
a[3][2],SecondDim:2;FirstDim:3</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getAddress</span><span style="color:#f92672">(</span>Variety var<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> Dimension<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> Address <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getDimension</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> Dimension<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        Address <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getOffset</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>var<span style="color:#f92672">.</span><span style="color:#a6e22e">getDimension</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Address <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getOffset</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            Address <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getOffset</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondDimNum</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">==</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        Address <span style="color:#f92672">=</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getOffset</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> j <span style="color:#f92672">*</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondDimNum</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Address<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h5 id="è¿è¡Œä»£ç ">è¿è¡Œä»£ç <a hidden class="anchor" aria-hidden="true" href="#è¿è¡Œä»£ç ">#</a></h5>
<p>é¦–å…ˆå®šä¹‰å‡ ä¸ªå˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//å·²ç»å­˜åœ¨çš„å‚æ•°æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> ExistParamsNum <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//è°ƒç”¨æ‰€éœ€çš„å‚æ•°æ•°é‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> CallParamsNum <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">boolean</span> MainFuncFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å‡½æ•°å®å‚å¯¹åº”çš„æ ˆä¸Šçš„åœ°å€åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> rparams <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span></code></pre></div><h6 id="var">var<a hidden class="anchor" aria-hidden="true" href="#var">#</a></h6>
<p>äº§ç”Ÿæ–°çš„å˜é‡ï¼Œç½®äºstackæœ«å°¾ï¼Œæ”¾è¿›å˜é‡è¡¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> var<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Variety var <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Variety<span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    varTable<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">(),</span> var<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="push">push<a hidden class="anchor" aria-hidden="true" href="#push">#</a></h6>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">//å¯¹äºæ•°å­—çš„è¯ï¼Œpushè¿›æ ˆé‡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">case</span> push<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">instanceof</span> Integer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        push<span style="color:#f92672">((</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="pop">pop<a hidden class="anchor" aria-hidden="true" href="#pop">#</a></h6>
<p><code>pop</code>æ“ä½œ:<code>*value1 = value2</code>
åœ¨æˆ‘çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä¼šåœ¨å˜é‡èµ‹å€¼ä»¥å‰ä¾æ¬¡å°†å…¶åœ¨æ ˆä¸­å¯¹åº”çš„åœ°å€ä»¥åŠæ‰€èµ‹çš„å€¼å‹è¿›æ ˆä¸­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> pop<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> address <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    stack<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>address<span style="color:#f92672">,</span> value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="è®¡ç®—">è®¡ç®—<a hidden class="anchor" aria-hidden="true" href="#è®¡ç®—">#</a></h6>
<p>Calculation Type</p>
<p>Two operators:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> b <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a <span style="color:#f92672">=</span> pop<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>push<span style="color:#f92672">(</span>cal<span style="color:#f92672">(</span>a<span style="color:#f92672">,</span>b<span style="color:#f92672">));</span>
</span></span></code></pre></div><p>Single operator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>push<span style="color:#f92672">(</span>cal<span style="color:#f92672">(</span>pop<span style="color:#f92672">()));</span>
</span></span></code></pre></div><h6 id="æ•°ç»„ç»´æ•°">æ•°ç»„ç»´æ•°<a hidden class="anchor" aria-hidden="true" href="#æ•°ç»„ç»´æ•°">#</a></h6>
<p>å£°æ˜å˜é‡ç»´æ•°,ç´§è·Ÿç€çš„æ˜¯ç»´æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> dimarrayvar<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Variety var <span style="color:#f92672">=</span> getVar<span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    var<span style="color:#f92672">.</span><span style="color:#a6e22e">setDimension</span><span style="color:#f92672">(</span>dimension<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var<span style="color:#f92672">.</span><span style="color:#a6e22e">setSecondDimNum</span><span style="color:#f92672">(</span>pop<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        var<span style="color:#f92672">.</span><span style="color:#a6e22e">setFirstDimNum</span><span style="color:#f92672">(</span>pop<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var<span style="color:#f92672">.</span><span style="color:#a6e22e">setFirstDimNum</span><span style="color:#f92672">(</span>pop<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="å ä½ç¬¦">å ä½ç¬¦<a hidden class="anchor" aria-hidden="true" href="#å ä½ç¬¦">#</a></h6>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> defaultvalue<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Variety var <span style="color:#f92672">=</span> getVar<span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        push<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstDimNum</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            push<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstDimNum</span><span style="color:#f92672">()</span> <span style="color:#f92672">*</span> var<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondDimNum</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            push<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="getint">getint<a hidden class="anchor" aria-hidden="true" href="#getint">#</a></h6>
<p>è¯»å–int</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> getint<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> value <span style="color:#f92672">=</span> scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    push<span style="color:#f92672">(</span>value<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h6 id="è·³è½¬">è·³è½¬<a hidden class="anchor" aria-hidden="true" href="#è·³è½¬">#</a></h6>
<p>å¦‚æœæ˜¯æ¡ä»¶è·³è½¬ï¼Œå–å‡º<code>stack</code>ä¸­æœ€åä¸€ä¸ªå€¼åˆ¤æ–­</p>
<h6 id="å‡½æ•°å®šä¹‰-1">å‡½æ•°å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°å®šä¹‰-1">#</a></h6>
<ul>
<li>
<p><code>main</code>å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> mainfunc<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    MainFuncFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//retInfos[0] storage å…¨å±€å˜é‡(varTable)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    retInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> RetInfo<span style="color:#f92672">(</span>pcodes<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(),</span> stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">,</span> varTable<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> 0<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    varTable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>è‡ªå®šä¹‰å‡½æ•°</p>
<p>é‡è§funcå®šä¹‰çš„è¯ï¼Œå‡å…ˆè¿›å…¥åˆ°mainå‡½æ•°ä¸­ï¼Œç­‰åˆ°è°ƒç”¨çš„æ—¶å€™å†è·³è½¬</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> func<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> flag <span style="color:#f92672">=</span> MainFuncFlag <span style="color:#f92672">?</span> 1 <span style="color:#f92672">:</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>flag <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">=</span> mainAddress <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
<h6 id="å‡½æ•°è°ƒç”¨-1">å‡½æ•°è°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°è°ƒç”¨-1">#</a></h6>
<p>æ€»ä½“ä¸Šæ¥è¯´ï¼Œå°±æ˜¯<code>é‡åˆ°å‡½æ•°è°ƒç”¨</code>-&gt;<code>å­˜å®å‚æ•°ï¼ˆå€¼/åœ°å€ï¼‰</code>-&gt;<code>å­˜ä¸‹retInfoï¼Œäº§ç”Ÿæ–°å˜é‡è¡¨ï¼ˆç”¨äºå‡½æ•°ï¼‰ï¼Œè·³è½¬åˆ°å®šä¹‰å¤„</code>-&gt;<code>é‡åˆ°å½¢å‚ï¼Œä¾æ¬¡å­˜å…¥æ–°å˜é‡è¡¨</code>-&gt;<code>é‡åˆ°retï¼Œè¿›è¡Œè¿”å›ï¼Œå°†åŸretinfoè¿˜åŸ</code></p>
<p>First, before function call, there will be some parameters to be pushed into the stack. Each will be followed by a <code>rparam</code> command, which memorize the address of the previous variety.</p>
<p><strong>æ³¨æ„ï¼šå¯¹äºä¼ å€¼å®å‚ï¼Œè‹¥æ˜¯æ•°ç»„å…·ä½“åˆ°æŸä¸ªæ•°ï¼ˆæœ¬è´¨æ˜¯ä¼ å…·ä½“å€¼ï¼‰ï¼Œå¯¹åº”æ“ä½œ<code>å…ˆpushå„ç»´åº¦ï¼Œå†getvalue</code>ï¼Œè‹¥æ˜¯å…·ä½“æ•°å€¼ï¼Œå°±æ˜¯pushæ•°å€¼ï¼Œå› æ­¤ç›´æ¥<code>rparams.add(stack.size() - 1)</code>ã€‚å¯¹äºä¼ åœ°å€å‚æ•°ï¼Œåˆ™æ˜¯<code>å…ˆpushæ•°ç»„åï¼Œå†getaddress</code>ï¼Œå› æ­¤éœ€è¦å°†å…¶<code>åœ°å€</code>å‹å…¥</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> rparam<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å¯¹äºéæ•°ç»„çš„å‚æ•°ï¼Œç›´æ¥å°†å…¶å€¼å‹å…¥æ ˆä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//å› æ­¤å…¶åœ°å€æ˜¯æ ˆé¡¶çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å¯¹äºæ•°ç»„çš„å‚æ•°ï¼Œå°†å…¶åœ°å€å‹å…¥æ ˆä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Second, function <code>CALL</code>.</p>
<p>Memorize the eip, stack top address, and information about the function(In fact, they will be pushed into stack too). Then update the <code>varTable</code> and <code>eip</code>.  Ready for execute function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> call<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Function func <span style="color:#f92672">=</span> funcTable<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    retInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> RetInfo<span style="color:#f92672">(</span>eip<span style="color:#f92672">,</span> stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">,</span> varTable<span style="color:#f92672">,</span> func<span style="color:#f92672">.</span><span style="color:#a6e22e">getParamsNum</span><span style="color:#f92672">(),</span> func<span style="color:#f92672">.</span><span style="color:#a6e22e">getParamsNum</span><span style="color:#f92672">(),</span> ExistParamsNum<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//è·³è½¬è‡³å‡½æ•°å®šä¹‰å¤„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    eip <span style="color:#f92672">=</span> func<span style="color:#f92672">.</span><span style="color:#a6e22e">getOffset</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    varTable <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    CallParamsNum <span style="color:#f92672">=</span> func<span style="color:#f92672">.</span><span style="color:#a6e22e">getParamsNum</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    ExistParamsNum <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Finally, return when it&rsquo;s <code>RET</code></p>
<p>Restore <code>eip</code>, <code>varTable</code> from <code>RetInfo</code>, clear the new information pushed when function in the stack.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> ret<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> type <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    RetInfo retInfo <span style="color:#f92672">=</span> retInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>retInfos<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    eip <span style="color:#f92672">=</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getEip</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    varTable <span style="color:#f92672">=</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getVarTable</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    CallParamsNum <span style="color:#f92672">=</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getCallParamsNum</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    ExistParamsNum <span style="color:#f92672">=</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getNowParamsNum</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>type <span style="color:#f92672">==</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æœ‰è¿”å›å€¼çš„è¯ï¼Œç”±äºä¹‹å‰å°†è¿”å›å€¼å‹å…¥æ ˆä¸­ï¼Œæ•…éœ€è¦ä¿ç•™æ ˆé¡¶å…ƒç´ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        stack<span style="color:#f92672">.</span><span style="color:#a6e22e">subList</span><span style="color:#f92672">(</span>retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getStackPtr</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getParamsNum</span><span style="color:#f92672">(),</span> stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        stack<span style="color:#f92672">.</span><span style="color:#a6e22e">subList</span><span style="color:#f92672">(</span>retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getStackPtr</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> retInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getParamsNum</span><span style="color:#f92672">(),</span> stack<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>Additionalï¼š</strong></p>
<p><code>å‚¨å­˜å®Œå®å‚ï¼Œè°ƒç”¨å‡½æ•°ä»¥åè·³è½¬åˆ°å‡½æ•°å®šä¹‰çš„åœ°æ–¹</code></p>
<blockquote>
<p><code>fparam</code>:Firstvalue:Ident_name Secondvalue:Type/Dimension</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> fparam<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å‡½æ•°ç°åœ¨éœ€è¦çš„å½¢å‚çš„index
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> nowfparamIndex <span style="color:#f92672">=</span> rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> CallParamsNum <span style="color:#f92672">+</span> ExistParamsNum<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> addressOnStack <span style="color:#f92672">=</span> rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>nowfparamIndex<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    Variety fparam <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Variety<span style="color:#f92672">(</span>addressOnStack<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    fparam<span style="color:#f92672">.</span><span style="color:#a6e22e">setDimension</span><span style="color:#f92672">(</span>dimension<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//äºŒç»´æ•°ç»„éœ€è¦å°†ç¬¬äºŒç»´å¤§å°ä½œä¸ºå‚æ•°ä¼ å…¥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dimension <span style="color:#f92672">==</span> 2<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        fparam<span style="color:#f92672">.</span><span style="color:#a6e22e">setSecondDimNum</span><span style="color:#f92672">(</span>pop<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    varTable<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">(),</span> fparam<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    ExistParamsNum<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//å¦‚æœå½¢å‚å·²ç»å…¨éƒ¨ç”Ÿæˆï¼Œå°±æ¸…ç©ºrparamsæ•°ç»„é‡Œå¯¹åº”çš„å…¶å½¢å‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ExistParamsNum <span style="color:#f92672">==</span> CallParamsNum<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">subList</span><span style="color:#f92672">(</span>rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> CallParamsNum<span style="color:#f92672">,</span> rparams<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span></code></pre></div><h6 id="æ‰“å°è¾“å‡º">æ‰“å°è¾“å‡º<a hidden class="anchor" aria-hidden="true" href="#æ‰“å°è¾“å‡º">#</a></h6>
<p><code>print</code>:Firstvalue:String Secondvalue:output num quantity</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> print<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    String str <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> q <span style="color:#f92672">=</span> num <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> OutParams <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> num<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        OutParams<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pop<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;</span> str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>j <span style="color:#f92672">&lt;</span> str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>j<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#f92672">&amp;&amp;</span> str<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>j <span style="color:#f92672">+</span> 1<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;d&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>OutParams<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>q<span style="color:#f92672">--).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                j<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>j<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//é™¤å»å¼•å·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    OutputString<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>sb<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> sb<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span></code></pre></div><h6 id="è·å–å˜é‡çš„å€¼åœ°å€">è·å–å˜é‡çš„å€¼ï¼Œåœ°å€<a hidden class="anchor" aria-hidden="true" href="#è·å–å˜é‡çš„å€¼åœ°å€">#</a></h6>
<p>Firstvalue:Ident_name Secondvalue:Dimension</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">case</span> getvalue<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Variety var <span style="color:#f92672">=</span> getVar<span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> address <span style="color:#f92672">=</span> getAddress<span style="color:#f92672">(</span>var<span style="color:#f92672">,</span> dimension<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    push<span style="color:#f92672">(</span>stack<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>address<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//è·å¾—å˜é‡åœ¨æ ˆä¸Šçš„åœ°å€ï¼Œç»™å®šå˜é‡åå’Œç»´åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">case</span> getaddress<span style="color:#f92672">:</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    Variety var <span style="color:#f92672">=</span> getVar<span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirstValue</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> dimension <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> pcode<span style="color:#f92672">.</span><span style="color:#a6e22e">getSecondValue</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> address <span style="color:#f92672">=</span> getAddress<span style="color:#f92672">(</span>var<span style="color:#f92672">,</span> dimension<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    push<span style="color:#f92672">(</span>address<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span></code></pre></div><h3 id="ç¼–ç åè®¾è®¡">ç¼–ç åè®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#ç¼–ç åè®¾è®¡">#</a></h3>
<h4 id="å°ç»†èŠ‚é—®é¢˜">å°ç»†èŠ‚é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#å°ç»†èŠ‚é—®é¢˜">#</a></h4>
<ul>
<li>
<p>åœ¨<code>GrammarAnalysis</code>ä¸­ï¼Œæ–°å¢<code>CurLayerId</code>å˜é‡ï¼Œæ³¨æ„å’Œ<code>layer</code>åŒºåˆ†</p>
<ul>
<li>
<p>å‰è€…ä¸ºäº†åŒºåˆ†ç¬¦å·è¡¨å†…<code>å˜é‡</code>æ‰€å¤„å±‚çº§ï¼Œå› æ­¤ä¸è€ƒè™‘å‡ºåŒºå—å‡ä¸€ï¼Œè€Œåè€…ç”¨æ¥æ„é€ ç¬¦å·è¡¨çš„<code>HashMap</code>ï¼Œæœ‰å¹¶åˆ—å…³ç³»ï¼Œæ‰€ä»¥å‡ºäº†åŒºå—å°±è¦å‡ä¸€</p>
</li>
<li>
<p>ä¸¤è€…æ¯æ¬¡æ–°è¿›å…¥ä¸€ä¸ªåŒºå—ä¹‹åï¼Œéƒ½ä¼šåŠ ä¸€</p>
</li>
<li>
<p>ä½†æ˜¯é€€å‡ºä¸€ä¸ªåŒºå—çš„æ—¶å€™ï¼Œå‰è€…ä¸ä¼šå‡ä¸€ï¼Œè€Œåè€…ä¾æ—§å‡ä¸€</p>
</li>
<li>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addSymbol</span><span style="color:#f92672">(</span>TokenWord tokenWord<span style="color:#f92672">,</span> String type<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> Dimension<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> CurLayerId<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    SymbolTables<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>layer<span style="color:#f92672">).</span><span style="color:#a6e22e">SymbolInsert</span><span style="color:#f92672">(</span>type<span style="color:#f92672">,</span> Dimension<span style="color:#f92672">,</span> tokenWord<span style="color:#f92672">,</span> CurLayerId<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="pcodeä»£ç å¯¹åº”è¡¨">Pcodeä»£ç å¯¹åº”è¡¨<a hidden class="anchor" aria-hidden="true" href="#pcodeä»£ç å¯¹åº”è¡¨">#</a></h4>
<h5 id="common-type">Common Type<a hidden class="anchor" aria-hidden="true" href="#common-type">#</a></h5>
<table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>label</td>
<td>label_name</td>
<td></td>
<td>set  a label</td>
</tr>
<tr>
<td>var</td>
<td>ident_name</td>
<td></td>
<td>declare  a variety</td>
</tr>
<tr>
<td>push</td>
<td>ident_name/digit</td>
<td></td>
<td>push(value1)</td>
</tr>
<tr>
<td>pop</td>
<td>ident_name</td>
<td><strong>åœ¨popå‘½ä»¤ä»¥å‰pushè¿›æ¥çš„èµ‹å€¼è¯­å¥å³é¢çš„å¼å­çš„å€¼</strong></td>
<td>*value1 = value2ï¼ˆ<strong>è¿™ä¸ªvalue2æŒ‡çš„æ˜¯åœ¨popå‘½ä»¤ä»¥å‰pushè¿›æ¥çš„èµ‹å€¼è¯­å¥å³é¢çš„å¼å­çš„å€¼</strong>ï¼‰</td>
</tr>
<tr>
<td>jz</td>
<td>label_name</td>
<td></td>
<td>jump if stack top is zero</td>
</tr>
<tr>
<td>jnz</td>
<td>label_name</td>
<td></td>
<td>jump if stack top is not zero</td>
</tr>
<tr>
<td>jmp</td>
<td>label_name</td>
<td></td>
<td>jump unconditionally</td>
</tr>
<tr>
<td>main</td>
<td></td>
<td></td>
<td>main function label</td>
</tr>
<tr>
<td>func</td>
<td></td>
<td></td>
<td>function label</td>
</tr>
<tr>
<td>endfunc</td>
<td></td>
<td></td>
<td>end of function label</td>
</tr>
<tr>
<td>fparam</td>
<td>ident_name</td>
<td>dimension/type</td>
<td><strong>å‡½æ•°å½¢å‚</strong>parameters</td>
</tr>
<tr>
<td>ret</td>
<td>return value or notï¼ˆ0ï¼švoidï¼›1ï¼šintï¼‰</td>
<td></td>
<td>function returnï¼ˆret 0æ— è¿”å›å€¼ï¼Œ1æœ‰è¿”å›å€¼ï¼‰</td>
</tr>
<tr>
<td>call</td>
<td>function name</td>
<td></td>
<td>function call</td>
</tr>
<tr>
<td>rparam</td>
<td>ident_name</td>
<td>dimension</td>
<td><strong>å‡½æ•°å®å‚</strong>get parameters ready for function call</td>
</tr>
<tr>
<td>getint</td>
<td></td>
<td></td>
<td>get a integer and put it into stack top</td>
</tr>
<tr>
<td>print</td>
<td>string</td>
<td>para num</td>
<td>pop values and print.</td>
</tr>
<tr>
<td>dimarrayvar</td>
<td>ident_name</td>
<td>type/dimension</td>
<td>set dimension info for array variety</td>
</tr>
<tr>
<td>getvalue</td>
<td>ident_name</td>
<td>type/dimension</td>
<td>å¯¹äºæ™®é€šå˜é‡ï¼Œget the variety value</td>
</tr>
<tr>
<td>getaddress</td>
<td>ident_name</td>
<td>type/dimension</td>
<td>å¯¹äºæ•°ç»„ï¼Œget the variety address</td>
</tr>
<tr>
<td>defaultvalue</td>
<td>ident_name</td>
<td>type/dimension</td>
<td>push something to hold places</td>
</tr>
<tr>
<td>exit</td>
<td></td>
<td></td>
<td>exit</td>
</tr>
</tbody>
</table>
<h5 id="è¿ç®—æ¯”è¾ƒ">è¿ç®—æ¯”è¾ƒ<a hidden class="anchor" aria-hidden="true" href="#è¿ç®—æ¯”è¾ƒ">#</a></h5>
<table>
<thead>
<tr>
<th>CodeType</th>
<th>Value1</th>
<th>Value2</th>
<th>Operation</th>
</tr>
</thead>
<tbody>
<tr>
<td>add</td>
<td></td>
<td></td>
<td>+</td>
</tr>
<tr>
<td>sub</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>mul</td>
<td></td>
<td></td>
<td>*</td>
</tr>
<tr>
<td>div</td>
<td></td>
<td></td>
<td>/</td>
</tr>
<tr>
<td>mod</td>
<td></td>
<td></td>
<td>%</td>
</tr>
<tr>
<td>cmpeq</td>
<td></td>
<td></td>
<td>==</td>
</tr>
<tr>
<td>cmpne</td>
<td></td>
<td></td>
<td>!=</td>
</tr>
<tr>
<td>cmpgt</td>
<td></td>
<td></td>
<td>&gt;</td>
</tr>
<tr>
<td>cmplt</td>
<td></td>
<td></td>
<td>&lt;</td>
</tr>
<tr>
<td>cmpge</td>
<td></td>
<td></td>
<td>&gt;=</td>
</tr>
<tr>
<td>cmple</td>
<td></td>
<td></td>
<td>&lt;=</td>
</tr>
<tr>
<td>and</td>
<td></td>
<td></td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>or</td>
<td></td>
<td></td>
<td>||</td>
</tr>
<tr>
<td>not</td>
<td></td>
<td></td>
<td>!</td>
</tr>
<tr>
<td>neg</td>
<td></td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>pos</td>
<td></td>
<td></td>
<td>+</td>
</tr>
</tbody>
</table>
<h4 id="çŸ­è·¯æ±‚å€¼é—®é¢˜">çŸ­è·¯æ±‚å€¼é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#çŸ­è·¯æ±‚å€¼é—®é¢˜">#</a></h4>
<p>There are two situations I need to use short circuit calculation :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ae81ff">1.</span> <span style="color:#66d9ef">if</span>(a<span style="color:#f92672">&amp;&amp;</span>b) <span style="color:#75715e">// a is false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">2.</span> <span style="color:#66d9ef">if</span>(a<span style="color:#f92672">||</span>b) <span style="color:#75715e">// a is true
</span></span></span></code></pre></div><p>My method is as follows:</p>
<p>First, when I analyze <code>analyseLOrExp</code>, every <code>analyseLAndExp</code> will be followed by a <code>JNZ</code>, which is used for detect if the cond is true. If it is, jump to the if body label. At the same time, I generated cond label, which is ready for the <code>analyseLAndExp</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseLOrExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>Word<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">,</span> String from<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        String label <span style="color:#f92672">=</span> labelGenerator<span style="color:#f92672">.</span><span style="color:#a6e22e">getLabel</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cond_&#34;</span> <span style="color:#f92672">+</span> i<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        analyseLAndExp<span style="color:#f92672">(</span>exp1<span style="color:#f92672">,</span> from<span style="color:#f92672">,</span> label<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        codes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PCode<span style="color:#f92672">(</span>CodeType<span style="color:#f92672">.</span><span style="color:#a6e22e">LABEL</span><span style="color:#f92672">,</span> label<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            codes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PCode<span style="color:#f92672">(</span>CodeType<span style="color:#f92672">.</span><span style="color:#a6e22e">OR</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                codes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PCode<span style="color:#f92672">(</span>CodeType<span style="color:#f92672">.</span><span style="color:#a6e22e">JNZ</span><span style="color:#f92672">,</span> ifLabels<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>ifLabels<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">).</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;if_block&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>In the <code>analyseLAndExp</code>, every <code>analyseEqExp</code> will be followed by a <code>JZ</code>, which is used for detect if the cond is true. If it is not, jump to the cond label I set just now.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">analyseLAndExp</span><span style="color:#f92672">(</span>ArrayList<span style="color:#f92672">&lt;</span>Word<span style="color:#f92672">&gt;</span> exp<span style="color:#f92672">,</span> String from<span style="color:#f92672">,</span> String label<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        analyseEqExp<span style="color:#f92672">(</span>exp1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            codes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PCode<span style="color:#f92672">(</span>CodeType<span style="color:#f92672">.</span><span style="color:#a6e22e">AND</span><span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(...)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                codes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PCode<span style="color:#f92672">(</span>CodeType<span style="color:#f92672">.</span><span style="color:#a6e22e">JZ</span><span style="color:#f92672">,</span> label<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>By these means, short circuit calculation is solved.</p>
<h2 id="ä¸ƒ-ä»£ç ç¤ºä¾‹">ä¸ƒ. ä»£ç ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#ä¸ƒ-ä»£ç ç¤ºä¾‹">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> y<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> b[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">3</span>]<span style="color:#f92672">=</span>{{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">func</span>(<span style="color:#66d9ef">int</span> x[][<span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">2</span>]<span style="color:#f92672">+</span>y;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">func2</span>(<span style="color:#66d9ef">int</span> a)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> s<span style="color:#f92672">=</span>a<span style="color:#f92672">+</span>b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> q<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">=</span>q;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> z;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> y<span style="color:#f92672">=</span>func(b);
</span></span><span style="display:flex;"><span>z<span style="color:#f92672">=</span>func2(<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;%d&#34;</span>,<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>var 0_y
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>var 0_b
</span></span><span style="display:flex;"><span>push 1
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>dimarrayvar 0_b, 2
</span></span><span style="display:flex;"><span>push 1
</span></span><span style="display:flex;"><span>push 2
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>FUNC @func:
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>fparam 1_x, 2
</span></span><span style="display:flex;"><span>push 1_x
</span></span><span style="display:flex;"><span>push 0
</span></span><span style="display:flex;"><span>push 2
</span></span><span style="display:flex;"><span>getvalue 1_x, 0
</span></span><span style="display:flex;"><span>push 0_y
</span></span><span style="display:flex;"><span>getvalue 0_y, 0
</span></span><span style="display:flex;"><span>add 
</span></span><span style="display:flex;"><span>ret 1
</span></span><span style="display:flex;"><span>endfunc 
</span></span><span style="display:flex;"><span>FUNC @func2:
</span></span><span style="display:flex;"><span>fparam 2_a, 0
</span></span><span style="display:flex;"><span>var 2_s
</span></span><span style="display:flex;"><span>push 2_a
</span></span><span style="display:flex;"><span>getvalue 2_a, 0
</span></span><span style="display:flex;"><span>push 0_b
</span></span><span style="display:flex;"><span>getaddress 0_b, 2
</span></span><span style="display:flex;"><span>add 
</span></span><span style="display:flex;"><span>push 2_a
</span></span><span style="display:flex;"><span>getvalue 2_a, 0
</span></span><span style="display:flex;"><span>ret 1
</span></span><span style="display:flex;"><span>endfunc 
</span></span><span style="display:flex;"><span>mainfunc main
</span></span><span style="display:flex;"><span>var 3_q
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>var 3_x
</span></span><span style="display:flex;"><span>push 3_q
</span></span><span style="display:flex;"><span>getvalue 3_q, 0
</span></span><span style="display:flex;"><span>var 3_z
</span></span><span style="display:flex;"><span>defaultvalue 3_z, 0
</span></span><span style="display:flex;"><span>var 3_y
</span></span><span style="display:flex;"><span>push 0_b
</span></span><span style="display:flex;"><span>getaddress 0_b, 2
</span></span><span style="display:flex;"><span>rparam b, 2
</span></span><span style="display:flex;"><span>$func
</span></span><span style="display:flex;"><span>push 3_z
</span></span><span style="display:flex;"><span>getaddress 3_z, 0
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>rparam 3, 0
</span></span><span style="display:flex;"><span>$func2
</span></span><span style="display:flex;"><span>pop 3_z
</span></span><span style="display:flex;"><span>push 3
</span></span><span style="display:flex;"><span>print &#34;%d&#34;
</span></span><span style="display:flex;"><span>push 0
</span></span><span style="display:flex;"><span>ret 1
</span></span><span style="display:flex;"><span>exit
</span></span></code></pre></div>

        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="/img/wechat_pay.jpg" alt="wechat_pay"></a>
                        <p>å¾®ä¿¡</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="/img/alipay.jpg" alt="alipay"></a>
                        <p>æ”¯ä»˜å®</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>ğŸ§§ é¼“åŠ±</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://mksasx.github.io/posts/sport/%E7%AF%AE%E7%90%83%E5%9F%BA%E6%9C%AC%E6%88%98%E6%9C%AF%E5%8F%8A%E5%9B%BE%E8%A7%A3/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>ç¯®çƒåŸºæœ¬æˆ˜æœ¯åŠå›¾è§£</span>
  </a>
  <a class="next" href="https://mksasx.github.io/posts/tech/os/great/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>æ“ä½œç³»ç»Ÿç”³ä¼˜æ–‡æ¡£</span>
  </a>
</nav>

        </footer>
    </div>



<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ğŸ’¬è¯„è®º</span>
        <hr />
    </div>

    <div id="tcomment"></div>

    <script src="https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js">
    </script>
    

    

    <script>
        twikoo.init({
            envId: "https://vercal-mogodb-comment.vercel.app/", 
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-guangzhou',
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
            
            
            
            
            
            
            
        });
    </script>

</div>
</article>
</main>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>


<script async src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<meting-js
        id="8109915341"
        lrc-type="0"
        server="tencent"
        order="random"
        type="playlist"
        fixed="true"
        list-olded="true">
</meting-js>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<footer class="footer">
    <span>
        Copyright
        &copy;
        2020-2022 
        <a href="https://mksasx.github.io/" style="color:#939393;">AustinMa&#39;s Blog</a>
         All Rights Reserved
    </span>

    

     <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        æ€»è®¿å®¢æ•°: <i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span>
        æ€»è®¿é—®é‡: <i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span>
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"AustinMa's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"AustinMa's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"AustinMa's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                    '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
